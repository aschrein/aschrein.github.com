{"version":3,"sources":["3rdparty/litegraph.js","app.jsx","index.jsx"],"names":["global","LiteGraph","VERSION","CANVAS_GRID_SIZE","NODE_TITLE_HEIGHT","NODE_TITLE_TEXT_Y","NODE_SLOT_HEIGHT","NODE_WIDGET_HEIGHT","NODE_WIDTH","NODE_MIN_WIDTH","NODE_COLLAPSED_RADIUS","NODE_COLLAPSED_WIDTH","NODE_TITLE_COLOR","NODE_TEXT_SIZE","NODE_TEXT_COLOR","NODE_SUBTEXT_SIZE","NODE_DEFAULT_COLOR","NODE_DEFAULT_BGCOLOR","NODE_DEFAULT_BOXCOLOR","NODE_DEFAULT_SHAPE","DEFAULT_SHADOW_COLOR","DEFAULT_GROUP_FONT","WIDGET_BGCOLOR","WIDGET_OUTLINE_COLOR","WIDGET_TEXT_COLOR","WIDGET_SECONDARY_TEXT_COLOR","LINK_COLOR","EVENT_LINK_COLOR","CONNECTING_LINK_COLOR","MAX_NUMBER_OF_NODES","DEFAULT_POSITION","VALID_SHAPES","BOX_SHAPE","ROUND_SHAPE","CIRCLE_SHAPE","CARD_SHAPE","ARROW_SHAPE","INPUT","OUTPUT","EVENT","ACTION","ALWAYS","ON_EVENT","NEVER","ON_TRIGGER","UP","DOWN","LEFT","RIGHT","CENTER","STRAIGHT_LINK","LINEAR_LINK","SPLINE_LINK","NORMAL_TITLE","NO_TITLE","TRANSPARENT_TITLE","AUTOHIDE_TITLE","proxy","node_images_path","debug","catch_exceptions","throw_errors","allow_scripts","registered_node_types","node_types_by_file_extension","Nodes","searchbox_extras","registerNodeType","type","base_class","prototype","console","log","split","classname","name","pos","lastIndexOf","category","substr","title","i","LGraphNode","Object","hasOwnProperty","defineProperty","set","v","this","_shape","get","enumerable","prev","constructor","onNodeTypeRegistered","onNodeTypeReplaced","onPropertyChange","warn","supported_extensions","toLowerCase","wrapFunctionAsNode","func","param_types","return_type","properties","params","Array","length","code","names","getParameterNames","JSON","stringify","classobj","Function","pop","desc","onExecute","getInputData","r","apply","setOutputData","addNodeMethod","createNode","options","node","err","error","properties_info","flags","size","computeSize","concat","mode","getNodeType","getNodeTypesInCategory","filter","push","getNodeTypesCategories","categories","skip_list","result","reloadNodes","folder_wildcard","tmp","document","getElementsByTagName","script_files","docHeadObj","location","href","src","dynamicScript","createElement","appendChild","removeChild","cloneObject","obj","target","parse","isValidConnection","type_a","type_b","String","indexOf","supported_types_a","supported_types_b","j","registerSearchboxExtra","node_type","description","data","LGraph","o","list_of_graphcanvas","clear","configure","LLink","id","origin_id","origin_slot","target_id","target_slot","_data","_pos","Float32Array","_ctor","LGraphGroup","DragAndScale","element","skip_events","offset","scale","max_scale","min_scale","onredraw","enabled","last_mouse","visible_area","bindEvents","LGraphCanvas","canvas","graph","background_image","querySelector","ds","zoom_modify_alpha","title_text_font","inner_text_font","node_title_color","default_link_color","default_connection_color","input_off","input_on","output_off","output_on","highquality_render","use_gradients","editor_alpha","pause_rendering","clear_background","read_only","render_only_selected","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","allow_reconnect_links","drag_mode","dragging_rectangle","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_curved_connections","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip","links_render_mode","canvas_mouse","onSearchBox","onSearchBoxSelection","onMouse","onDrawBackground","onDrawForeground","onDrawOverlay","onDrawLinkTooltip","onNodeMoved","onSelectionChange","connections_width","round_radius","current_node","node_widget","over_link_center","last_mouse_position","visible_links","attachCanvas","setCanvas","skip_render","startRendering","autoresize","performance","getTime","now","bind","Date","process","t","hrtime","supported_types","getSupportedTypes","STATUS_STOPPED","STATUS_RUNNING","stop","status","last_node_id","last_link_id","_version","_nodes","onRemoved","_nodes_by_id","_nodes_in_order","_nodes_executable","_groups","links","iteration","config","vars","globaltime","runningtime","fixedtime","fixedtime_lapse","elapsed_time","last_update_time","starttime","catch_errors","inputs","outputs","change","sendActionToCanvas","graphcanvas","detachCanvas","splice","start","interval","onPlayEvent","sendEventToAllNodes","that","window","requestAnimationFrame","execution_timer_id","on_frame","runStep","setInterval","onStopEvent","clearInterval","num","do_not_catch_errors","limit","nodes","onExecuteStep","onAfterExecute","errors_in_execution","elapsed","execution_time","updateExecutionOrder","computeExecutionOrder","only_onExecute","set_level","L","S","M","visited_links","remaining_links","l","l2","link","_level","shift","output","link_id","target_node","getNodeById","order","sort","A","B","Ap","priority","Bp","getAncestors","ancestors","pending","visited","current","input","getInputNode","a","b","arrange","margin","columns","col","x","column","max_size","y","setDirtyCanvas","getFixedTime","getElapsedTime","eventname","Subgraph","undefined","action","c","add","skip_compute_order","onAdded","align_to_grid","alignToGrid","onNodeAdded","remove","index","ignore_remove","slot","disconnectInput","disconnectOutput","selected_nodes","node_dragged","onNodeRemoved","findNodesByClass","classObject","findNodesByType","findNodeByTitle","findNodesByTitle","getNodeOnPos","nodes_list","n","isPointInside","getGroupOnPos","g","checkNodeTypes","ctor","newnode","serialize","onAction","param","_input_nodes","GraphInput","trigger","onTrigger","addInput","value","onInputAdded","onInputsOutputsChange","setInputData","renameInput","old_name","onInputRenamed","changeInputType","onInputTypeChanged","removeInput","onInputRemoved","addOutput","onOutputAdded","getOutputData","renameOutput","onOutputRenamed","changeOutputType","onOutputTypeChanged","removeOutput","onOutputRemoved","triggerInput","setCallback","setTrigger","connectionChange","link_info","onConnectionChange","isLive","clearTriggeredSlots","_last_time","on_change","fg","bg","removeLink","nodes_info","link2","groups_info","groups","version","keep_old","link_data","n_info","last_serialization","has_errors","group","load","url","req","XMLHttpRequest","open","send","onload","oEvent","response","onerror","onNodeTrace","msg","color","connections","info","k","onPropertyChanged","onConnectionsChange","widgets","w","property","widgets_values","onConfigure","serialize_widgets","bgcolor","boxcolor","shape","onSerialize","clone","toString","getTitle","setProperty","prev_value","output_info","setOutputDataType","force_update","updateOutputData","getInputDataType","getInputDataByName","slot_name","findInputSlot","isInputConnected","clearInput","getInputInfo","getInputNodeByName","getInputLinkByName","getInputOrProperty","input_info","getOutputInfo","isOutputConnected","isAnyOutputConnected","getOutputNodes","_last_trigger_time","triggerSlot","target_connection","clearTriggeredSlot","addProperty","default_value","extra_info","addOutputs","array","addInputs","removeInputByName","removeOutputByName","addConnection","direction","minHeight","out","rows","Math","max","font_size","slot_start_y","widgets_height","widgets_up","widgets_start_y","title_width","compute_text_size","input_width","output_width","text_width","label","text","onResize","min_height","addWidget","callback","values","addCustomWidget","custom_widget","getBounding","onBounding","skip_title","margin_top","collapsed","isInsideRectangle","_collapsed_width","getSlotInPosition","link_pos","getConnectionPos","findOutputSlot","connect","Number","onConnectInput","onNodeConnectionChange","is_input","slot_number","num_slots","horizontal","round","trace","MAX_CONSOLE","dirty_foreground","dirty_background","loadImage","img","Image","ready","captureInput","list","node_capturing_input","collapse","force","collapsable","pin","pinned","localToScreen","node_colors","pale_blue","groupcolor","_bounding","subarray","_size","bounding","font","move","deltax","deltay","ignore_nodes","recomputeInsideNodes","node_bounding","overlapBounding","_binded_mouse_callback","addEventListener","computeVisibleArea","width","height","startx","starty","endx","endy","e","rect","getBoundingClientRect","clientX","left","clientY","top","canvasx","canvasy","dragging","ignore","onmouse","removeEventListener","body","mouseDrag","eventType","wheel","deltaY","wheelDeltaY","detail","delta","wheelDelta","changeDeltaScale","preventDefault","stopPropagation","toCanvasContext","ctx","translate","convertOffsetToCanvas","convertCanvasToOffset","changeScale","zooming_center","center","abs","new_center","delta_offset","reset","link_type_colors","number","gradients","frame","last_draw_time","render_time","fps","selected_group","visible_nodes","node_over","connecting_node","highlighted_links","dirty_canvas","dirty_bgcanvas","dirty_area","node_in_panel","last_mouseclick","onClear","setGraph","skip_clear","setDirty","openSubgraph","_graph_stack","closeSubgraph","subgraph_node","_subgraph_node","centerOnNode","selectNodes","getCurrentGraph","getElementById","unbindEvents","className","tabindex","bgcanvas","getContext","localName","webgl_enabled","enableWebGL","_mousemove_callback","processMouseMove","_mouseup_callback","processMouseUp","_doNothing","_doReturnTrue","_events_binded","getCanvasWindow","_mousedown_callback","processMouseDown","_mousewheel_callback","processMouseWheel","touchHandler","_key_callback","processKey","_ondrop_callback","processDrop","getFileExtension","question","point","GL","enableWebGLCanvas","gl","webgl","bgctx","fgcanvas","doc","ownerDocument","defaultView","parentWindow","is_rendering","renderFrame","draw","call","stopRendering","adjustMouseEvent","ref_window","active_canvas","canvasX","canvasY","skip_action","is_double_click","focus","closeAllContextMenus","which","ctrlKey","clicking_canvas_bg","bringToFront","resizable","resizing_node","style","cursor","connecting_output","connecting_pos","connecting_slot","shiftKey","onOutputDblClick","onOutputClick","onInputDblClick","onInputClick","block_drag_node","widget","processNodeWidgets","onDblClick","processNodeDblClicked","onMouseDown","processNodeSelected","showLinkMenu","selected_group_resizing","distance","showSearchBox","dragging_canvas","processContextMenu","localX","localY","last_mouse_dragging","activeElement","nodeName","resize","mouse","mouseOver","onMouseLeave","onMouseEnter","onMouseMove","_highlight_input","isOverNodeBox","isOverNodeInput","slot_type","over_link","click_time","diffx","diffy","deselectAllNodes","h","to_select","onMouseUp","title_height","slot_pos","block_default","keyCode","metaKey","copyToClipboard","pasteFromClipboard","deleteSelectedNodes","onKeyDown","onKeyUp","stopImmediatePropagation","clipboard_info","selected_nodes_array","_relative_id","cloned","localStorage","setItem","getItem","node_data","origin_node","onDropItem","event","checkDropItem","onDropFile","onDropData","files","dataTransfer","file","filename","reader","FileReader","readAsText","readAsDataURL","readAsArrayBuffer","ext","nodetype","onShowNodePanel","onNodeDblClicked","selectNode","onNodeSelected","add_to_current_selection","is_selected","onSelected","deselectNode","onDeselected","onNodeDeselected","input_link","output_link","input_node","output_node","deltaX","setZoom","convertEventToCanvasOffset","sendToBack","unshift","temp","computeVisibleNodes","force_canvas","force_bgcanvas","drawBackCanvas","drawFrontCanvas","start2D","restore","setTransform","save","beginPath","clip","clearRect","drawImage","onRender","renderInfo","drawNode","drawExecutionOrder","links_ontop","drawConnections","lineWidth","link_color","renderLink","dir","arc","PI","fill","fillStyle","strokeStyle","strokeRect","drawLinkTooltip","visible_rect","finish2D","fillText","toFixed","textAlign","bg_already_painted","onRenderBackground","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled","globalAlpha","_bg_img","pattern","_pattern","createPattern","_pattern_img","fillRect","drawGroups","onBackgroundRender","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","finish","temp_vec2","low_quality","onDrawCollapsed","min","measureText","clip_area","roundRect","drawNodeShape","render_text","out_slot","max_y","input_slot","output_slot","moveTo","lineTo","closePath","color_on","color_off","stroke","widgets_y","drawNodeWidgets","Boolean","toToolTip","tmp_area","fgcolor","selected","mouse_over","title_mode","render_title","area","old_alpha","onDrawTitleBar","title_color","grad","createLinearGradient","addColorStop","onDrawTitleBox","box_size","onDrawTitleText","title_text_color","measure","onDrawTitle","margin_area","link_bounding","tempA","tempB","sqrt","A_end_x","A_end_y","B_end_x","B_end_y","ContextMenu","parentMenu","lock","current_submenu","MouseEvent","CustomEvent","PointerEvent","root","on_mouse_wheel","parseInt","scroll_speed","minWidth","pointerEvents","setTimeout","button","close","innerHTML","content","addItem","closing_timer","clearTimeout","root_document","fullscreenElement","body_rect","root_rect","transform","CurveEditor","points","nearest","must_update","start_node","start_node_slot","start_node_slotpos","end_node_slotpos","start_slot","end_slot","start_dir","end_dir","f","skip_border","flow","num_sublines","dist","lineJoin","offsety","start_offset_x","start_offset_y","end_offset_x","end_offset_y","bezierCurveTo","start_x","start_y","end_x","end_y","computeConnectionPoint","posA","posB","posC","posD","angleA","angleB","atan2","rotate","p0","p1","p2","p3","c1","c2","c3","c4","posY","active_widget","H","show_text","outline_color","background_color","text_color","secondary_text_color","last_y","disabled","clicked","on","off","range","nvalue","marker","marker_nvalue","precision","clamp","inner_value_change","old_value","step","option","prompt","DEFAULT_GROUP_FONT_SIZE","adjustNodesSize","parent","parentNode","offsetWidth","offsetHeight","switchLiveMode","transition","self","onNodeSelectionChange","first","changedTouches","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","onGroupAdd","entry","mouse_event","onMenuAdd","prev_menu","entries","has_submenu","menu","node_types","inner_create","first_event","getFirstEvent","onMenuCollapseAll","onMenuNodeEdit","showMenuNodeOptionalInputs","optional_inputs","onGetInputs","onMenuNodeInputs","showMenuNodeOptionalOutputs","optional_outputs","onGetOutputs","skip_repeated_outputs","onMenuNodeOutputs","inner_clicked","onShowMenuNodeProperties","decodeHTML","showEditPropertyValue","position","allow_html","str","innerText","onResizeNode","node_left","node_right","onShowPropertyEditor","item","dialog","inner","offsetx","setValue","modified","prompt_box","search_limit","search_box","overflow","timeout_close","helper","timeout","changeSelection","refreshHelper","select","extra","json","forward","classList","nextSibling","previousSibling","childNodes","scrollIntoView","block","behavior","addResult","inner_test_filter","filtered","keys","help","dataset","escape","unescape","layerY","maxHeight","getPropertyInfo","input_html","createDialog","checked","_graph","html","onMenuNodeCollapse","onMenuNodePin","onMenuNodeMode","onMenuNodeColors","onMenuNodeShapes","onMenuNodeRemove","removable","onMenuNodeClone","clonable","red","brown","green","blue","cyan","purple","yellow","black","getCanvasMenuOptions","getMenuOptions","getExtraMenuOptions","getNodeMenuOptions","onGetNodeMenuOptions","getGroupMenuOptions","menu_info","slot_info","active_node","_slot","locked","nameLocked","submenu","CanvasRenderingContext2D","radius","radius_low","quadraticCurveTo","compareObjects","colorToString","growBounding","isInsideBounding","p","bb","hex2num","hex","charAt","slice","toUpperCase","int1","int2","num2hex","triplet","inner_onclick","close_parent","ignore_item_callbacks","autoopen","onclick_callback","ignore_parent_menu","isCursorOverElement","event_name","origin","evt","initCustomEvent","srcElement","__events","getTopMenu","elements","querySelectorAll","extendClass","__lookupGetter__","__defineGetter__","__lookupSetter__","__defineSetter__","sampleCurve","pn","local_f","line_color","inactive","localpos","max_dist","getCloserPoint","s","curvepos","_nearest","is_edge_point","min_dist","closest","vec2","replace","webkitRequestAnimationFrame","mozRequestAnimationFrame","exports","LG","require","isSetsEqual","every","has","assert","condition","Error","global_state","init_litegraph","litegraph","_on_reset_table","on_select","on_deselect","litegraph_canvas","_after_table","_onselect_table","exec_after","cmd_type","fn","exec_on_select","onselect","ondeselect","exec_selected","exec_deselected","exec","cmd","src_name","srcs","viewport","on_reset","exec_reset","reload","get_src","_scr_change_table","on_src_change","set_src","forEach","draw_triangle","vsSource","fsSource","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","triangleArray","createVertexArray","bindVertexArray","positions","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vertexAttribPointer","FLOAT","enableVertexAttribArray","colors","colorBuffer","disable","CULL_FACE","frontFace","CW","DEPTH_TEST","SCISSOR_TEST","depthFunc","LEQUAL","BLEND","blendFunc","ONE","drawArrays","TRIANGLES","deleteBuffer","deleteShader","deleteProgram","render_texture","tex","format","flipy","pipeline","vs","ps","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","uniform1i","getUniformLocation","deleteVertexArray","get_texture_data","targetTextureWidth","floor","targetTextureHeight","targetTexture","createTexture","internalFormat","RGBA","UNSIGNED_BYTE","texImage2D","LINEAR","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","drawBuffers","clearColor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","Uint8Array","readPixels","deleteFramebuffer","deleteTexture","Uint8ClampedArray","ImageData","_dirty_set","Set","_dirty_deferred_set","set_dirty","is_recursive","update","set_to_check","new_set","sorted_list","backlog","loop_counter","has_dirty_input","input_id","delete","notify","periodic_update","toposort","sorted","sorted_set","unsorted_set","unsorted","is_ready","frame_count","sorted_nodes","gl_init","gl_render","from","reverse","gl_release","update_thumbnails","graph_list","LoadGraphButton","props","context","setShow","vis","setState","visible","handleClose","handleShow","handleApply","on_submit","myInput","state","Button","variant","onClick","Modal","show","onHide","Header","closeButton","Title","Footer","DropdownButton","map","Dropdown","Item","key","fetch","then","React","Component","gltf_loader","GLTFLoader","MyLGraphNode","subscribe","subscribers","unsubscribe","clean_inputs","clean_outputs","set_inputs","new_outputs","last_attributes","attr","set_outputs","FrameCountNode","get_value","Mesh","init","attributes","indices","init_gltf","mesh","BufferGeometryUtils","computeTangents","geometry","attr_name","raw_attr","normalized","itemSize","pbr_material","material","images","field","image","get_attrib_data","get_index_data","ModelNode","traverse","meshes","children","child","get_meshes","display","propnode","canvas1","canvas2","div","cssText","controls","camera","scene","alpha","renderer","THREE","render","datgui","domElement","setSize","pmremGenerator","compileEquirectangularShader","RGBELoader","setDataType","setPath","texture","envMap","fromEquirectangular","background","environment","dispose","gltf","setPixelRatio","outputEncoding","boundingBox","setFromObject","getSize","maxDim","z","fov","cameraZ","tan","minZ","cameraToFarEdge","OrbitControls","minDistance","maxDistance","aspect","far","updateProjectionMatrix","fileurl","prop","val","yoffset","GLComponent","exec_graph","getExtension","alert","glcanvas","BackBufferNode","in_node","get_texture","displayWidth","clientWidth","displayHeight","clientHeight","BACK","thumbnail","image_data","tmp_canvas","tmp_canvasContext","putImageData","toDataURL","border","PipelineNode","set_vs","set_ps","is_valid","valid","get_uniform_location","vs_source","ps_source","depthMask","enable","get_attrib_location","getAttribLocation","src_list","datgui_state","select_vs","select_ps","onChange","parse_shaders","get_info","uniforms","uniform_set","glslang","parse_attributes","attrib","uniform","VertexBufferNode","folder","addFolder","buf","parse_src","TextureBufferNode","get_buffer","loc","RGBA32F","UNSIGNED_INT","RGBA32UI","RGBA_INTEGER","Uint32Array","DrawCallNode","update_inputs","sat","pipeline_info","default_uniforms","to_remove","uni_name","mesh_input","arrays","buffers","arr","out_attrib","gl_buffer","comps","draw_size","indexBuffer","ELEMENT_ARRAY_BUFFER","Uint16Array","index_type","UNSIGNED_SHORT","new_rt","add_vec","strs","uni","gl_draw","tu_cnt","getParameter","VIEWPORT","uniform2fv","tu","drawElements","c_type","flag","FeedbackNode","texStorage2D","RGBA8","clone_texture","PassNode","clear_outputs","dc_cnt","update_outputs","rts","depth","push_rt","rt_params","pop_rt","add_depth","d_params","remove_depth","set_width","set_height","draw_buffers","gen_texture","DEPTH_ATTACHMENT","checkFramebufferStatus","DRAW_FRAMEBUFFER","FRAMEBUFFER_COMPLETE","srcTexture","rt","DEPTH_COMPONENT16","DEPTH_COMPONENT32F","clearDepth","thumbnails","depth_thumbnail","vfbs","tmp_rt_state","tmp_d_state","clear_gui","display_node","rt_state","new_d","vp","addDC","local_pos","GraphNodeComponent","dumpJson","_selected_nodes","new_selected","new_deselected","glContainer","postMessage","textArea","padding","outline","boxShadow","execCommand","copyTextToClipboard","CreateSrc","FormControl","placeholder","TextEditorComponent","rebuildGui","dat","autoPlace","select_src","selected_src","remove_src","edit_src","customContainer","lastElementChild","refs","editor","setOptions","fontSize","setAutoScrollEditorIntoView","getSession","tabSize","useSoftTabs","navigateWithinSoftTabs","add_src","newValue","ref","theme","editorProps","$blockScrolling","enableBasicAutocompletion","enableLiveAutocompletion","autoScrollEditorIntoView","wrapEnabled","PropertiesNode","selected_node","deselected_node","GoldenLayoutWrapper","globals","isClosable","component","layout","GoldenLayout","registerComponent","ReactDOM","updateSize"],"mappings":"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","file":"static/js/main.966d38bd.chunk.js","sourcesContent":["/* eslint-disable */\n// https://github.com/jagenjo/litegraph.js\n/*\nCopyright (C) 2013 by Javi Agenjo\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n(function(global) {\n  // *************************************************************\n  //   LiteGraph CLASS                                     *******\n  // *************************************************************\n\n  /**\n   * The Global Scope. It contains all the registered node classes.\n   *\n   * @class LiteGraph\n   * @constructor\n   */\n\n  var LiteGraph = (global.LiteGraph = {\n      VERSION: 0.4,\n\n      CANVAS_GRID_SIZE: 10,\n\n      NODE_TITLE_HEIGHT: 30,\n      NODE_TITLE_TEXT_Y: 20,\n      NODE_SLOT_HEIGHT: 20,\n      NODE_WIDGET_HEIGHT: 20,\n      NODE_WIDTH: 140,\n      NODE_MIN_WIDTH: 50,\n      NODE_COLLAPSED_RADIUS: 10,\n      NODE_COLLAPSED_WIDTH: 80,\n      NODE_TITLE_COLOR: \"#999\",\n      NODE_TEXT_SIZE: 14,\n      NODE_TEXT_COLOR: \"#AAA\",\n      NODE_SUBTEXT_SIZE: 12,\n      NODE_DEFAULT_COLOR: \"#333\",\n      NODE_DEFAULT_BGCOLOR: \"#353535\",\n      NODE_DEFAULT_BOXCOLOR: \"#666\",\n      NODE_DEFAULT_SHAPE: \"box\",\n      DEFAULT_SHADOW_COLOR: \"rgba(0,0,0,0.5)\",\n      DEFAULT_GROUP_FONT: 24,\n\n  WIDGET_BGCOLOR: \"#222\",\n  WIDGET_OUTLINE_COLOR: \"#666\",\n  WIDGET_TEXT_COLOR: \"#DDD\",\n  WIDGET_SECONDARY_TEXT_COLOR: \"#999\",\n\n      LINK_COLOR: \"#9A9\",\n      EVENT_LINK_COLOR: \"#A86\",\n      CONNECTING_LINK_COLOR: \"#AFA\",\n\n      MAX_NUMBER_OF_NODES: 1000, //avoid infinite loops\n      DEFAULT_POSITION: [100, 100], //default node position\n      VALID_SHAPES: [\"default\", \"box\", \"round\", \"card\"], //,\"circle\"\n\n      //shapes are used for nodes but also for slots\n      BOX_SHAPE: 1,\n      ROUND_SHAPE: 2,\n      CIRCLE_SHAPE: 3,\n      CARD_SHAPE: 4,\n      ARROW_SHAPE: 5,\n\n      //enums\n      INPUT: 1,\n      OUTPUT: 2,\n\n      EVENT: -1, //for outputs\n      ACTION: -1, //for inputs\n\n      ALWAYS: 0,\n      ON_EVENT: 1,\n      NEVER: 2,\n      ON_TRIGGER: 3,\n\n      UP: 1,\n      DOWN: 2,\n      LEFT: 3,\n      RIGHT: 4,\n      CENTER: 5,\n\n      STRAIGHT_LINK: 0,\n      LINEAR_LINK: 1,\n      SPLINE_LINK: 2,\n\n      NORMAL_TITLE: 0,\n      NO_TITLE: 1,\n      TRANSPARENT_TITLE: 2,\n      AUTOHIDE_TITLE: 3,\n\n      proxy: null, //used to redirect calls\n      node_images_path: \"\",\n\n      debug: false,\n      catch_exceptions: true,\n      throw_errors: true,\n      allow_scripts: false, //if set to true some nodes like Formula would be allowed to evaluate code that comes from unsafe sources (like node configuration), which could lead to exploits\n      registered_node_types: {}, //nodetypes by string\n      node_types_by_file_extension: {}, //used for dropping files in the canvas\n      Nodes: {}, //node types by classname\n\n      searchbox_extras: {}, //used to add extra features to the search box\n\n      /**\n       * Register a node class so it can be listed when the user wants to create a new one\n       * @method registerNodeType\n       * @param {String} type name of the node and path\n       * @param {Class} base_class class containing the structure of a node\n       */\n\n      registerNodeType: function(type, base_class) {\n          if (!base_class.prototype) {\n              throw \"Cannot register a simple object, it must be a class with a prototype\";\n          }\n          base_class.type = type;\n\n          if (LiteGraph.debug) {\n              console.log(\"Node registered: \" + type);\n          }\n\n          var categories = type.split(\"/\");\n          var classname = base_class.name;\n\n          var pos = type.lastIndexOf(\"/\");\n          base_class.category = type.substr(0, pos);\n\n          if (!base_class.title) {\n              base_class.title = classname;\n          }\n          //info.name = name.substr(pos+1,name.length - pos);\n\n          //extend class\n          if (base_class.prototype) {\n              //is a class\n              for (var i in LGraphNode.prototype) {\n                  if (!base_class.prototype[i]) {\n                      base_class.prototype[i] = LGraphNode.prototype[i];\n                  }\n              }\n          }\n\n    if( !Object.hasOwnProperty( base_class.prototype, \"shape\") )\n    {\n      Object.defineProperty(base_class.prototype, \"shape\", {\n        set: function(v) {\n          switch (v) {\n            case \"default\":\n              delete this._shape;\n              break;\n            case \"box\":\n              this._shape = LiteGraph.BOX_SHAPE;\n              break;\n            case \"round\":\n              this._shape = LiteGraph.ROUND_SHAPE;\n              break;\n            case \"circle\":\n              this._shape = LiteGraph.CIRCLE_SHAPE;\n              break;\n            case \"card\":\n              this._shape = LiteGraph.CARD_SHAPE;\n              break;\n            default:\n              this._shape = v;\n          }\n        },\n        get: function(v) {\n          return this._shape;\n        },\n        enumerable: true\n      });\n    }\n\n          var prev = this.registered_node_types[type];\n    if(prev)\n      console.log(\"replacing node type: \" + type);\n\n          this.registered_node_types[type] = base_class;\n          if (base_class.constructor.name) {\n              this.Nodes[classname] = base_class;\n          }\n          if (LiteGraph.onNodeTypeRegistered) {\n              LiteGraph.onNodeTypeRegistered(type, base_class);\n          }\n          if (prev && LiteGraph.onNodeTypeReplaced) {\n              LiteGraph.onNodeTypeReplaced(type, base_class, prev);\n          }\n\n          //warnings\n          if (base_class.prototype.onPropertyChange) {\n              console.warn(\n                  \"LiteGraph node class \" +\n                      type +\n                      \" has onPropertyChange method, it must be called onPropertyChanged with d at the end\"\n              );\n          }\n\n    //used to know which nodes create when dragging files to the canvas\n          if (base_class.supported_extensions) {\n              for (var i in base_class.supported_extensions) {\n                  this.node_types_by_file_extension[\n                      base_class.supported_extensions[i].toLowerCase()\n                  ] = base_class;\n              }\n          }\n      },\n\n      /**\n       * Create a new nodetype by passing a function, it wraps it with a proper class and generates inputs according to the parameters of the function.\n       * Useful to wrap simple methods that do not require properties, and that only process some input to generate an output.\n       * @method wrapFunctionAsNode\n       * @param {String} name node name with namespace (p.e.: 'math/sum')\n       * @param {Function} func\n       * @param {Array} param_types [optional] an array containing the type of every parameter, otherwise parameters will accept any type\n       * @param {String} return_type [optional] string with the return type, otherwise it will be generic\n       * @param {Object} properties [optional] properties to be configurable\n       */\n      wrapFunctionAsNode: function(\n          name,\n          func,\n          param_types,\n          return_type,\n          properties\n      ) {\n          var params = Array(func.length);\n          var code = \"\";\n          var names = LiteGraph.getParameterNames(func);\n          for (var i = 0; i < names.length; ++i) {\n              code +=\n                  \"this.addInput('\" +\n                  names[i] +\n                  \"',\" +\n                  (param_types && param_types[i]\n                      ? \"'\" + param_types[i] + \"'\"\n                      : \"0\") +\n                  \");\\n\";\n          }\n          code +=\n              \"this.addOutput('out',\" +\n              (return_type ? \"'\" + return_type + \"'\" : 0) +\n              \");\\n\";\n          if (properties) {\n              code +=\n                  \"this.properties = \" + JSON.stringify(properties) + \";\\n\";\n          }\n          var classobj = Function(code);\n          classobj.title = name.split(\"/\").pop();\n          classobj.desc = \"Generated from \" + func.name;\n          classobj.prototype.onExecute = function onExecute() {\n              for (var i = 0; i < params.length; ++i) {\n                  params[i] = this.getInputData(i);\n              }\n              var r = func.apply(this, params);\n              this.setOutputData(0, r);\n          };\n          this.registerNodeType(name, classobj);\n      },\n\n      /**\n       * Adds this method to all nodetypes, existing and to be created\n       * (You can add it to LGraphNode.prototype but then existing node types wont have it)\n       * @method addNodeMethod\n       * @param {Function} func\n       */\n      addNodeMethod: function(name, func) {\n          LGraphNode.prototype[name] = func;\n          for (var i in this.registered_node_types) {\n              var type = this.registered_node_types[i];\n              if (type.prototype[name]) {\n                  type.prototype[\"_\" + name] = type.prototype[name];\n              } //keep old in case of replacing\n              type.prototype[name] = func;\n          }\n      },\n\n      /**\n       * Create a node of a given type with a name. The node is not attached to any graph yet.\n       * @method createNode\n       * @param {String} type full name of the node class. p.e. \"math/sin\"\n       * @param {String} name a name to distinguish from other nodes\n       * @param {Object} options to set options\n       */\n\n      createNode: function(type, title, options) {\n          var base_class = this.registered_node_types[type];\n          if (!base_class) {\n              if (LiteGraph.debug) {\n                  console.log(\n                      'GraphNode type \"' + type + '\" not registered.'\n                  );\n              }\n              return null;\n          }\n\n          var prototype = base_class.prototype || base_class;\n\n          title = title || base_class.title || type;\n\n          var node = null;\n\n          if (LiteGraph.catch_exceptions) {\n              try {\n                  node = new base_class(title);\n              } catch (err) {\n                  console.error(err);\n                  return null;\n              }\n          } else {\n              node = new base_class(title);\n          }\n\n          node.type = type;\n\n          if (!node.title && title) {\n              node.title = title;\n          }\n          if (!node.properties) {\n              node.properties = {};\n          }\n          if (!node.properties_info) {\n              node.properties_info = [];\n          }\n          if (!node.flags) {\n              node.flags = {};\n          }\n          if (!node.size) {\n              node.size = node.computeSize();\n          }\n          if (!node.pos) {\n              node.pos = LiteGraph.DEFAULT_POSITION.concat();\n          }\n          if (!node.mode) {\n              node.mode = LiteGraph.ALWAYS;\n          }\n\n          //extra options\n          if (options) {\n              for (var i in options) {\n                  node[i] = options[i];\n              }\n          }\n\n          return node;\n      },\n\n      /**\n       * Returns a registered node type with a given name\n       * @method getNodeType\n       * @param {String} type full name of the node class. p.e. \"math/sin\"\n       * @return {Class} the node class\n       */\n      getNodeType: function(type) {\n          return this.registered_node_types[type];\n      },\n\n      /**\n       * Returns a list of node types matching one category\n       * @method getNodeType\n       * @param {String} category category name\n       * @return {Array} array with all the node classes\n       */\n\n      getNodeTypesInCategory: function(category, filter) {\n          var r = [];\n          for (var i in this.registered_node_types) {\n              var type = this.registered_node_types[i];\n              if (filter && type.filter && type.filter != filter) {\n                  continue;\n              }\n\n              if (category == \"\") {\n                  if (type.category == null) {\n                      r.push(type);\n                  }\n              } else if (type.category == category) {\n                  r.push(type);\n              }\n          }\n\n          return r;\n      },\n\n      /**\n       * Returns a list with all the node type categories\n       * @method getNodeTypesCategories\n       * @return {Array} array with all the names of the categories\n       */\n\n      getNodeTypesCategories: function( filter ) {\n          var categories = { \"\": 1 };\n          for (var i in this.registered_node_types) {\n      var type = this.registered_node_types[i];\n              if ( type.category && !type.skip_list )\n              {\n        if(filter && type.filter != filter)\n          continue;\n                  categories[type.category] = 1;\n              }\n          }\n          var result = [];\n          for (var i in categories) {\n              result.push(i);\n          }\n          return result;\n      },\n\n      //debug purposes: reloads all the js scripts that matches a wildcard\n      reloadNodes: function(folder_wildcard) {\n          var tmp = document.getElementsByTagName(\"script\");\n          //weird, this array changes by its own, so we use a copy\n          var script_files = [];\n          for (var i in tmp) {\n              script_files.push(tmp[i]);\n          }\n\n          var docHeadObj = document.getElementsByTagName(\"head\")[0];\n          folder_wildcard = document.location.href + folder_wildcard;\n\n          for (var i in script_files) {\n              var src = script_files[i].src;\n              if (\n                  !src ||\n                  src.substr(0, folder_wildcard.length) != folder_wildcard\n              ) {\n                  continue;\n              }\n\n              try {\n                  if (LiteGraph.debug) {\n                      console.log(\"Reloading: \" + src);\n                  }\n                  var dynamicScript = document.createElement(\"script\");\n                  dynamicScript.type = \"text/javascript\";\n                  dynamicScript.src = src;\n                  docHeadObj.appendChild(dynamicScript);\n                  docHeadObj.removeChild(script_files[i]);\n              } catch (err) {\n                  if (LiteGraph.throw_errors) {\n                      throw err;\n                  }\n                  if (LiteGraph.debug) {\n                      console.log(\"Error while reloading \" + src);\n                  }\n              }\n          }\n\n          if (LiteGraph.debug) {\n              console.log(\"Nodes reloaded\");\n          }\n      },\n\n      //separated just to improve if it doesn't work\n      cloneObject: function(obj, target) {\n          if (obj == null) {\n              return null;\n          }\n          var r = JSON.parse(JSON.stringify(obj));\n          if (!target) {\n              return r;\n          }\n\n          for (var i in r) {\n              target[i] = r[i];\n          }\n          return target;\n      },\n\n      isValidConnection: function(type_a, type_b) {\n          if (\n              !type_a || //generic output\n              !type_b || //generic input\n              type_a == type_b || //same type (is valid for triggers)\n              (type_a == LiteGraph.EVENT && type_b == LiteGraph.ACTION)\n          ) {\n              return true;\n          }\n\n          // Enforce string type to handle toLowerCase call (-1 number not ok)\n          type_a = String(type_a);\n          type_b = String(type_b);\n          type_a = type_a.toLowerCase();\n          type_b = type_b.toLowerCase();\n\n          // For nodes supporting multiple connection types\n          if (type_a.indexOf(\",\") == -1 && type_b.indexOf(\",\") == -1) {\n              return type_a == type_b;\n          }\n\n          // Check all permutations to see if one is valid\n          var supported_types_a = type_a.split(\",\");\n          var supported_types_b = type_b.split(\",\");\n          for (var i = 0; i < supported_types_a.length; ++i) {\n              for (var j = 0; j < supported_types_b.length; ++j) {\n                  if (supported_types_a[i] == supported_types_b[j]) {\n                      return true;\n                  }\n              }\n          }\n\n          return false;\n      },\n\n      registerSearchboxExtra: function(node_type, description, data) {\n          this.searchbox_extras[description.toLowerCase()] = {\n              type: node_type,\n              desc: description,\n              data: data\n          };\n      }\n  });\n\n  //timer that works everywhere\n  if (typeof performance != \"undefined\") {\n      LiteGraph.getTime = performance.now.bind(performance);\n  } else if (typeof Date != \"undefined\" && Date.now) {\n      LiteGraph.getTime = Date.now.bind(Date);\n  } else if (typeof process != \"undefined\") {\n      LiteGraph.getTime = function() {\n          var t = process.hrtime();\n          return t[0] * 0.001 + t[1] * 1e-6;\n      };\n  } else {\n      LiteGraph.getTime = function getTime() {\n          return new Date().getTime();\n      };\n  }\n\n  //*********************************************************************************\n  // LGraph CLASS\n  //*********************************************************************************\n\n  /**\n   * LGraph is the class that contain a full graph. We instantiate one and add nodes to it, and then we can run the execution loop.\n   *\n   * @class LGraph\n   * @constructor\n   * @param {Object} o data from previous serialization [optional]\n   */\n\n  function LGraph(o) {\n      if (LiteGraph.debug) {\n          console.log(\"Graph created\");\n      }\n      this.list_of_graphcanvas = null;\n      this.clear();\n\n      if (o) {\n          this.configure(o);\n      }\n  }\n\n  global.LGraph = LiteGraph.LGraph = LGraph;\n\n  //default supported types\n  LGraph.supported_types = [\"number\", \"string\", \"boolean\"];\n\n  //used to know which types of connections support this graph (some graphs do not allow certain types)\n  LGraph.prototype.getSupportedTypes = function() {\n      return this.supported_types || LGraph.supported_types;\n  };\n\n  LGraph.STATUS_STOPPED = 1;\n  LGraph.STATUS_RUNNING = 2;\n\n  /**\n   * Removes all nodes from this graph\n   * @method clear\n   */\n\n  LGraph.prototype.clear = function() {\n      this.stop();\n      this.status = LGraph.STATUS_STOPPED;\n\n      this.last_node_id = 0;\n      this.last_link_id = 0;\n\n      this._version = -1; //used to detect changes\n\n      //safe clear\n      if (this._nodes) {\n          for (var i = 0; i < this._nodes.length; ++i) {\n              var node = this._nodes[i];\n              if (node.onRemoved) {\n                  node.onRemoved();\n              }\n          }\n      }\n\n      //nodes\n      this._nodes = [];\n      this._nodes_by_id = {};\n      this._nodes_in_order = []; //nodes that are executable sorted in execution order\n      this._nodes_executable = null; //nodes that contain onExecute\n\n      //other scene stuff\n      this._groups = [];\n\n      //links\n      this.links = {}; //container with all the links\n\n      //iterations\n      this.iteration = 0;\n\n      //custom data\n      this.config = {};\n  this.vars = {};\n\n      //timing\n      this.globaltime = 0;\n      this.runningtime = 0;\n      this.fixedtime = 0;\n      this.fixedtime_lapse = 0.01;\n      this.elapsed_time = 0.01;\n      this.last_update_time = 0;\n      this.starttime = 0;\n\n      this.catch_errors = true;\n\n      //subgraph_data\n      this.inputs = {};\n      this.outputs = {};\n\n      //notify canvas to redraw\n      this.change();\n\n      this.sendActionToCanvas(\"clear\");\n  };\n\n  /**\n   * Attach Canvas to this graph\n   * @method attachCanvas\n   * @param {GraphCanvas} graph_canvas\n   */\n\n  LGraph.prototype.attachCanvas = function(graphcanvas) {\n      if (graphcanvas.constructor != LGraphCanvas) {\n          throw \"attachCanvas expects a LGraphCanvas instance\";\n      }\n      if (graphcanvas.graph && graphcanvas.graph != this) {\n          graphcanvas.graph.detachCanvas(graphcanvas);\n      }\n\n      graphcanvas.graph = this;\n      if (!this.list_of_graphcanvas) {\n          this.list_of_graphcanvas = [];\n      }\n      this.list_of_graphcanvas.push(graphcanvas);\n  };\n\n  /**\n   * Detach Canvas from this graph\n   * @method detachCanvas\n   * @param {GraphCanvas} graph_canvas\n   */\n  LGraph.prototype.detachCanvas = function(graphcanvas) {\n      if (!this.list_of_graphcanvas) {\n          return;\n      }\n\n      var pos = this.list_of_graphcanvas.indexOf(graphcanvas);\n      if (pos == -1) {\n          return;\n      }\n      graphcanvas.graph = null;\n      this.list_of_graphcanvas.splice(pos, 1);\n  };\n\n  /**\n   * Starts running this graph every interval milliseconds.\n   * @method start\n   * @param {number} interval amount of milliseconds between executions, if 0 then it renders to the monitor refresh rate\n   */\n\n  LGraph.prototype.start = function(interval) {\n      if (this.status == LGraph.STATUS_RUNNING) {\n          return;\n      }\n      this.status = LGraph.STATUS_RUNNING;\n\n      if (this.onPlayEvent) {\n          this.onPlayEvent();\n      }\n\n      this.sendEventToAllNodes(\"onStart\");\n\n      //launch\n      this.starttime = LiteGraph.getTime();\n      this.last_update_time = this.starttime;\n      interval = interval || 0;\n      var that = this;\n\n      if (\n          interval == 0 &&\n          typeof window != \"undefined\" &&\n          window.requestAnimationFrame\n      ) {\n          function on_frame() {\n              if (that.execution_timer_id != -1) {\n                  return;\n              }\n              window.requestAnimationFrame(on_frame);\n              that.runStep(1, !this.catch_errors);\n          }\n          this.execution_timer_id = -1;\n          on_frame();\n      } else {\n          this.execution_timer_id = setInterval(function() {\n              //execute\n              that.runStep(1, !this.catch_errors);\n          }, interval);\n      }\n  };\n\n  /**\n   * Stops the execution loop of the graph\n   * @method stop execution\n   */\n\n  LGraph.prototype.stop = function() {\n      if (this.status == LGraph.STATUS_STOPPED) {\n          return;\n      }\n\n      this.status = LGraph.STATUS_STOPPED;\n\n      if (this.onStopEvent) {\n          this.onStopEvent();\n      }\n\n      if (this.execution_timer_id != null) {\n          if (this.execution_timer_id != -1) {\n              clearInterval(this.execution_timer_id);\n          }\n          this.execution_timer_id = null;\n      }\n\n      this.sendEventToAllNodes(\"onStop\");\n  };\n\n  /**\n   * Run N steps (cycles) of the graph\n   * @method runStep\n   * @param {number} num number of steps to run, default is 1\n   * @param {Boolean} do_not_catch_errors [optional] if you want to try/catch errors \n   * @param {number} limit max number of nodes to execute (used to execute from start to a node)\n   */\n\n  LGraph.prototype.runStep = function(num, do_not_catch_errors, limit ) {\n      num = num || 1;\n\n      var start = LiteGraph.getTime();\n      this.globaltime = 0.001 * (start - this.starttime);\n\n      var nodes = this._nodes_executable\n          ? this._nodes_executable\n          : this._nodes;\n      if (!nodes) {\n          return;\n      }\n\n  limit = limit || nodes.length;\n\n      if (do_not_catch_errors) {\n          //iterations\n          for (var i = 0; i < num; i++) {\n              for (var j = 0; j < limit; ++j) {\n                  var node = nodes[j];\n                  if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                      node.onExecute(); //hard to send elapsed time\n                  }\n              }\n\n              this.fixedtime += this.fixedtime_lapse;\n              if (this.onExecuteStep) {\n                  this.onExecuteStep();\n              }\n          }\n\n          if (this.onAfterExecute) {\n              this.onAfterExecute();\n          }\n      } else {\n          try {\n              //iterations\n              for (var i = 0; i < num; i++) {\n                  for (var j = 0; j < limit; ++j) {\n                      var node = nodes[j];\n                      if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                          node.onExecute();\n                      }\n                  }\n\n                  this.fixedtime += this.fixedtime_lapse;\n                  if (this.onExecuteStep) {\n                      this.onExecuteStep();\n                  }\n              }\n\n              if (this.onAfterExecute) {\n                  this.onAfterExecute();\n              }\n              this.errors_in_execution = false;\n          } catch (err) {\n              this.errors_in_execution = true;\n              if (LiteGraph.throw_errors) {\n                  throw err;\n              }\n              if (LiteGraph.debug) {\n                  console.log(\"Error during execution: \" + err);\n              }\n              this.stop();\n          }\n      }\n\n      var now = LiteGraph.getTime();\n      var elapsed = now - start;\n      if (elapsed == 0) {\n          elapsed = 1;\n      }\n      this.execution_time = 0.001 * elapsed;\n      this.globaltime += 0.001 * elapsed;\n      this.iteration += 1;\n      this.elapsed_time = (now - this.last_update_time) * 0.001;\n      this.last_update_time = now;\n  };\n\n  /**\n   * Updates the graph execution order according to relevance of the nodes (nodes with only outputs have more relevance than\n   * nodes with only inputs.\n   * @method updateExecutionOrder\n   */\n  LGraph.prototype.updateExecutionOrder = function() {\n      this._nodes_in_order = this.computeExecutionOrder(false);\n      this._nodes_executable = [];\n      for (var i = 0; i < this._nodes_in_order.length; ++i) {\n          if (this._nodes_in_order[i].onExecute) {\n              this._nodes_executable.push(this._nodes_in_order[i]);\n          }\n      }\n  };\n\n  //This is more internal, it computes the executable nodes in order and returns it\n  LGraph.prototype.computeExecutionOrder = function(\n      only_onExecute,\n      set_level\n  ) {\n      var L = [];\n      var S = [];\n      var M = {};\n      var visited_links = {}; //to avoid repeating links\n      var remaining_links = {}; //to a\n\n      //search for the nodes without inputs (starting nodes)\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          var node = this._nodes[i];\n          if (only_onExecute && !node.onExecute) {\n              continue;\n          }\n\n          M[node.id] = node; //add to pending nodes\n\n          var num = 0; //num of input connections\n          if (node.inputs) {\n              for (var j = 0, l2 = node.inputs.length; j < l2; j++) {\n                  if (node.inputs[j] && node.inputs[j].link != null) {\n                      num += 1;\n                  }\n              }\n          }\n\n          if (num == 0) {\n              //is a starting node\n              S.push(node);\n              if (set_level) {\n                  node._level = 1;\n              }\n          } //num of input links\n          else {\n              if (set_level) {\n                  node._level = 0;\n              }\n              remaining_links[node.id] = num;\n          }\n      }\n\n      while (true) {\n          if (S.length == 0) {\n              break;\n          }\n\n          //get an starting node\n          var node = S.shift();\n          L.push(node); //add to ordered list\n          delete M[node.id]; //remove from the pending nodes\n\n          if (!node.outputs) {\n              continue;\n          }\n\n          //for every output\n          for (var i = 0; i < node.outputs.length; i++) {\n              var output = node.outputs[i];\n              //not connected\n              if (\n                  output == null ||\n                  output.links == null ||\n                  output.links.length == 0\n              ) {\n                  continue;\n              }\n\n              //for every connection\n              for (var j = 0; j < output.links.length; j++) {\n                  var link_id = output.links[j];\n                  var link = this.links[link_id];\n                  if (!link) {\n                      continue;\n                  }\n\n                  //already visited link (ignore it)\n                  if (visited_links[link.id]) {\n                      continue;\n                  }\n\n                  var target_node = this.getNodeById(link.target_id);\n                  if (target_node == null) {\n                      visited_links[link.id] = true;\n                      continue;\n                  }\n\n                  if (\n                      set_level &&\n                      (!target_node._level ||\n                          target_node._level <= node._level)\n                  ) {\n                      target_node._level = node._level + 1;\n                  }\n\n                  visited_links[link.id] = true; //mark as visited\n                  remaining_links[target_node.id] -= 1; //reduce the number of links remaining\n                  if (remaining_links[target_node.id] == 0) {\n                      S.push(target_node);\n                  } //if no more links, then add to starters array\n              }\n          }\n      }\n\n      //the remaining ones (loops)\n      for (var i in M) {\n          L.push(M[i]);\n      }\n\n      if (L.length != this._nodes.length && LiteGraph.debug) {\n          console.warn(\"something went wrong, nodes missing\");\n      }\n\n      var l = L.length;\n\n      //save order number in the node\n      for (var i = 0; i < l; ++i) {\n          L[i].order = i;\n      }\n\n      //sort now by priority\n      L = L.sort(function(A, B) {\n          var Ap = A.constructor.priority || A.priority || 0;\n          var Bp = B.constructor.priority || B.priority || 0;\n          if (Ap == Bp) {\n              //if same priority, sort by order\n              return A.order - B.order;\n          }\n          return Ap - Bp; //sort by priority\n      });\n\n      //save order number in the node, again...\n      for (var i = 0; i < l; ++i) {\n          L[i].order = i;\n      }\n\n      return L;\n  };\n\n  /**\n   * Returns all the nodes that could affect this one (ancestors) by crawling all the inputs recursively.\n   * It doesn't include the node itself\n   * @method getAncestors\n   * @return {Array} an array with all the LGraphNodes that affect this node, in order of execution\n   */\n  LGraph.prototype.getAncestors = function(node) {\n      var ancestors = [];\n      var pending = [node];\n      var visited = {};\n\n      while (pending.length) {\n          var current = pending.shift();\n          if (!current.inputs) {\n              continue;\n          }\n          if (!visited[current.id] && current != node) {\n              visited[current.id] = true;\n              ancestors.push(current);\n          }\n\n          for (var i = 0; i < current.inputs.length; ++i) {\n              var input = current.getInputNode(i);\n              if (input && ancestors.indexOf(input) == -1) {\n                  pending.push(input);\n              }\n          }\n      }\n\n      ancestors.sort(function(a, b) {\n          return a.order - b.order;\n      });\n      return ancestors;\n  };\n\n  /**\n   * Positions every node in a more readable manner\n   * @method arrange\n   */\n  LGraph.prototype.arrange = function(margin) {\n      margin = margin || 100;\n\n      var nodes = this.computeExecutionOrder(false, true);\n      var columns = [];\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          var col = node._level || 1;\n          if (!columns[col]) {\n              columns[col] = [];\n          }\n          columns[col].push(node);\n      }\n\n      var x = margin;\n\n      for (var i = 0; i < columns.length; ++i) {\n          var column = columns[i];\n          if (!column) {\n              continue;\n          }\n          var max_size = 100;\n          var y = margin + LiteGraph.NODE_TITLE_HEIGHT;\n          for (var j = 0; j < column.length; ++j) {\n              var node = column[j];\n              node.pos[0] = x;\n              node.pos[1] = y;\n              if (node.size[0] > max_size) {\n                  max_size = node.size[0];\n              }\n              y += node.size[1] + margin + LiteGraph.NODE_TITLE_HEIGHT;\n          }\n          x += max_size + margin;\n      }\n\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * Returns the amount of time the graph has been running in milliseconds\n   * @method getTime\n   * @return {number} number of milliseconds the graph has been running\n   */\n  LGraph.prototype.getTime = function() {\n      return this.globaltime;\n  };\n\n  /**\n   * Returns the amount of time accumulated using the fixedtime_lapse var. This is used in context where the time increments should be constant\n   * @method getFixedTime\n   * @return {number} number of milliseconds the graph has been running\n   */\n\n  LGraph.prototype.getFixedTime = function() {\n      return this.fixedtime;\n  };\n\n  /**\n   * Returns the amount of time it took to compute the latest iteration. Take into account that this number could be not correct\n   * if the nodes are using graphical actions\n   * @method getElapsedTime\n   * @return {number} number of milliseconds it took the last cycle\n   */\n\n  LGraph.prototype.getElapsedTime = function() {\n      return this.elapsed_time;\n  };\n\n  /**\n   * Sends an event to all the nodes, useful to trigger stuff\n   * @method sendEventToAllNodes\n   * @param {String} eventname the name of the event (function to be called)\n   * @param {Array} params parameters in array format\n   */\n  LGraph.prototype.sendEventToAllNodes = function(eventname, params, mode) {\n      mode = mode || LiteGraph.ALWAYS;\n\n      var nodes = this._nodes_in_order ? this._nodes_in_order : this._nodes;\n      if (!nodes) {\n          return;\n      }\n\n      for (var j = 0, l = nodes.length; j < l; ++j) {\n          var node = nodes[j];\n\n          if (\n              node.constructor === LiteGraph.Subgraph &&\n              eventname != \"onExecute\"\n          ) {\n              if (node.mode == mode) {\n                  node.sendEventToAllNodes(eventname, params, mode);\n              }\n              continue;\n          }\n\n          if (!node[eventname] || node.mode != mode) {\n              continue;\n          }\n          if (params === undefined) {\n              node[eventname]();\n          } else if (params && params.constructor === Array) {\n              node[eventname].apply(node, params);\n          } else {\n              node[eventname](params);\n          }\n      }\n  };\n\n  LGraph.prototype.sendActionToCanvas = function(action, params) {\n      if (!this.list_of_graphcanvas) {\n          return;\n      }\n\n      for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n          var c = this.list_of_graphcanvas[i];\n          if (c[action]) {\n              c[action].apply(c, params);\n          }\n      }\n  };\n\n  /**\n   * Adds a new node instance to this graph\n   * @method add\n   * @param {LGraphNode} node the instance of the node\n   */\n\n  LGraph.prototype.add = function(node, skip_compute_order) {\n      if (!node) {\n          return;\n      }\n\n      //groups\n      if (node.constructor === LGraphGroup) {\n          this._groups.push(node);\n          this.setDirtyCanvas(true);\n          this.change();\n          node.graph = this;\n          this._version++;\n          return;\n      }\n\n      //nodes\n      if (node.id != -1 && this._nodes_by_id[node.id] != null) {\n          console.warn(\n              \"LiteGraph: there is already a node with this ID, changing it\"\n          );\n          node.id = ++this.last_node_id;\n      }\n\n      if (this._nodes.length >= LiteGraph.MAX_NUMBER_OF_NODES) {\n          throw \"LiteGraph: max number of nodes in a graph reached\";\n      }\n\n      //give him an id\n      if (node.id == null || node.id == -1) {\n          node.id = ++this.last_node_id;\n      } else if (this.last_node_id < node.id) {\n          this.last_node_id = node.id;\n      }\n\n      node.graph = this;\n      this._version++;\n\n      this._nodes.push(node);\n      this._nodes_by_id[node.id] = node;\n\n      if (node.onAdded) {\n          node.onAdded(this);\n      }\n\n      if (this.config.align_to_grid) {\n          node.alignToGrid();\n      }\n\n      if (!skip_compute_order) {\n          this.updateExecutionOrder();\n      }\n\n      if (this.onNodeAdded) {\n          this.onNodeAdded(node);\n      }\n\n      this.setDirtyCanvas(true);\n      this.change();\n\n      return node; //to chain actions\n  };\n\n  /**\n   * Removes a node from the graph\n   * @method remove\n   * @param {LGraphNode} node the instance of the node\n   */\n\n  LGraph.prototype.remove = function(node) {\n      if (node.constructor === LiteGraph.LGraphGroup) {\n          var index = this._groups.indexOf(node);\n          if (index != -1) {\n              this._groups.splice(index, 1);\n          }\n          node.graph = null;\n          this._version++;\n          this.setDirtyCanvas(true, true);\n          this.change();\n          return;\n      }\n\n      if (this._nodes_by_id[node.id] == null) {\n          return;\n      } //not found\n\n      if (node.ignore_remove) {\n          return;\n      } //cannot be removed\n\n      //disconnect inputs\n      if (node.inputs) {\n          for (var i = 0; i < node.inputs.length; i++) {\n              var slot = node.inputs[i];\n              if (slot.link != null) {\n                  node.disconnectInput(i);\n              }\n          }\n      }\n\n      //disconnect outputs\n      if (node.outputs) {\n          for (var i = 0; i < node.outputs.length; i++) {\n              var slot = node.outputs[i];\n              if (slot.links != null && slot.links.length) {\n                  node.disconnectOutput(i);\n              }\n          }\n      }\n\n      //node.id = -1; //why?\n\n      //callback\n      if (node.onRemoved) {\n          node.onRemoved();\n      }\n\n      node.graph = null;\n      this._version++;\n\n      //remove from canvas render\n      if (this.list_of_graphcanvas) {\n          for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n              var canvas = this.list_of_graphcanvas[i];\n              if (canvas.selected_nodes[node.id]) {\n                  delete canvas.selected_nodes[node.id];\n              }\n              if (canvas.node_dragged == node) {\n                  canvas.node_dragged = null;\n              }\n          }\n      }\n\n      //remove from containers\n      var pos = this._nodes.indexOf(node);\n      if (pos != -1) {\n          this._nodes.splice(pos, 1);\n      }\n      delete this._nodes_by_id[node.id];\n\n      if (this.onNodeRemoved) {\n          this.onNodeRemoved(node);\n      }\n\n      this.setDirtyCanvas(true, true);\n      this.change();\n\n      this.updateExecutionOrder();\n  };\n\n  /**\n   * Returns a node by its id.\n   * @method getNodeById\n   * @param {Number} id\n   */\n\n  LGraph.prototype.getNodeById = function(id) {\n      if (id == null) {\n          return null;\n      }\n      return this._nodes_by_id[id];\n  };\n\n  /**\n   * Returns a list of nodes that matches a class\n   * @method findNodesByClass\n   * @param {Class} classObject the class itself (not an string)\n   * @return {Array} a list with all the nodes of this type\n   */\n  LGraph.prototype.findNodesByClass = function(classObject, result) {\n      result = result || [];\n      result.length = 0;\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].constructor === classObject) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns a list of nodes that matches a type\n   * @method findNodesByType\n   * @param {String} type the name of the node type\n   * @return {Array} a list with all the nodes of this type\n   */\n  LGraph.prototype.findNodesByType = function(type, result) {\n      var type = type.toLowerCase();\n      result = result || [];\n      result.length = 0;\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].type.toLowerCase() == type) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns the first node that matches a name in its title\n   * @method findNodeByTitle\n   * @param {String} name the name of the node to search\n   * @return {Node} the node or null\n   */\n  LGraph.prototype.findNodeByTitle = function(title) {\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].title == title) {\n              return this._nodes[i];\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Returns a list of nodes that matches a name\n   * @method findNodesByTitle\n   * @param {String} name the name of the node to search\n   * @return {Array} a list with all the nodes with this name\n   */\n  LGraph.prototype.findNodesByTitle = function(title) {\n      var result = [];\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].title == title) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns the top-most node in this position of the canvas\n   * @method getNodeOnPos\n   * @param {number} x the x coordinate in canvas space\n   * @param {number} y the y coordinate in canvas space\n   * @param {Array} nodes_list a list with all the nodes to search from, by default is all the nodes in the graph\n   * @return {LGraphNode} the node at this position or null\n   */\n  LGraph.prototype.getNodeOnPos = function(x, y, nodes_list, margin) {\n      nodes_list = nodes_list || this._nodes;\n      for (var i = nodes_list.length - 1; i >= 0; i--) {\n          var n = nodes_list[i];\n          if (n.isPointInside(x, y, margin)) {\n              return n;\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Returns the top-most group in that position\n   * @method getGroupOnPos\n   * @param {number} x the x coordinate in canvas space\n   * @param {number} y the y coordinate in canvas space\n   * @return {LGraphGroup} the group or null\n   */\n  LGraph.prototype.getGroupOnPos = function(x, y) {\n      for (var i = this._groups.length - 1; i >= 0; i--) {\n          var g = this._groups[i];\n          if (g.isPointInside(x, y, 2, true)) {\n              return g;\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Checks that the node type matches the node type registered, used when replacing a nodetype by a newer version during execution\n   * this replaces the ones using the old version with the new version\n   * @method checkNodeTypes\n   */\n  LGraph.prototype.checkNodeTypes = function() {\n      var changes = false;\n      for (var i = 0; i < this._nodes.length; i++) {\n          var node = this._nodes[i];\n          var ctor = LiteGraph.registered_node_types[node.type];\n          if (node.constructor == ctor) {\n              continue;\n          }\n          console.log(\"node being replaced by newer version: \" + node.type);\n          var newnode = LiteGraph.createNode(node.type);\n          changes = true;\n          this._nodes[i] = newnode;\n          newnode.configure(node.serialize());\n          newnode.graph = this;\n          this._nodes_by_id[newnode.id] = newnode;\n          if (node.inputs) {\n              newnode.inputs = node.inputs.concat();\n          }\n          if (node.outputs) {\n              newnode.outputs = node.outputs.concat();\n          }\n      }\n      this.updateExecutionOrder();\n  };\n\n  // ********** GLOBALS *****************\n\n  LGraph.prototype.onAction = function(action, param) {\n      this._input_nodes = this.findNodesByClass(\n          LiteGraph.GraphInput,\n          this._input_nodes\n      );\n      for (var i = 0; i < this._input_nodes.length; ++i) {\n          var node = this._input_nodes[i];\n          if (node.properties.name != action) {\n              continue;\n          }\n          node.onAction(action, param);\n          break;\n      }\n  };\n\n  LGraph.prototype.trigger = function(action, param) {\n      if (this.onTrigger) {\n          this.onTrigger(action, param);\n      }\n  };\n\n  /**\n   * Tell this graph it has a global graph input of this type\n   * @method addGlobalInput\n   * @param {String} name\n   * @param {String} type\n   * @param {*} value [optional]\n   */\n  LGraph.prototype.addInput = function(name, type, value) {\n      var input = this.inputs[name];\n      if (input) {\n          //already exist\n          return;\n      }\n\n      this.inputs[name] = { name: name, type: type, value: value };\n      this._version++;\n\n      if (this.onInputAdded) {\n          this.onInputAdded(name, type);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Assign a data to the global graph input\n   * @method setGlobalInputData\n   * @param {String} name\n   * @param {*} data\n   */\n  LGraph.prototype.setInputData = function(name, data) {\n      var input = this.inputs[name];\n      if (!input) {\n          return;\n      }\n      input.value = data;\n  };\n\n  /**\n   * Returns the current value of a global graph input\n   * @method getInputData\n   * @param {String} name\n   * @return {*} the data\n   */\n  LGraph.prototype.getInputData = function(name) {\n      var input = this.inputs[name];\n      if (!input) {\n          return null;\n      }\n      return input.value;\n  };\n\n  /**\n   * Changes the name of a global graph input\n   * @method renameInput\n   * @param {String} old_name\n   * @param {String} new_name\n   */\n  LGraph.prototype.renameInput = function(old_name, name) {\n      if (name == old_name) {\n          return;\n      }\n\n      if (!this.inputs[old_name]) {\n          return false;\n      }\n\n      if (this.inputs[name]) {\n          console.error(\"there is already one input with that name\");\n          return false;\n      }\n\n      this.inputs[name] = this.inputs[old_name];\n      delete this.inputs[old_name];\n      this._version++;\n\n      if (this.onInputRenamed) {\n          this.onInputRenamed(old_name, name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Changes the type of a global graph input\n   * @method changeInputType\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.changeInputType = function(name, type) {\n      if (!this.inputs[name]) {\n          return false;\n      }\n\n      if (\n          this.inputs[name].type &&\n          String(this.inputs[name].type).toLowerCase() ==\n              String(type).toLowerCase()\n      ) {\n          return;\n      }\n\n      this.inputs[name].type = type;\n      this._version++;\n      if (this.onInputTypeChanged) {\n          this.onInputTypeChanged(name, type);\n      }\n  };\n\n  /**\n   * Removes a global graph input\n   * @method removeInput\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.removeInput = function(name) {\n      if (!this.inputs[name]) {\n          return false;\n      }\n\n      delete this.inputs[name];\n      this._version++;\n\n      if (this.onInputRemoved) {\n          this.onInputRemoved(name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n      return true;\n  };\n\n  /**\n   * Creates a global graph output\n   * @method addOutput\n   * @param {String} name\n   * @param {String} type\n   * @param {*} value\n   */\n  LGraph.prototype.addOutput = function(name, type, value) {\n      this.outputs[name] = { name: name, type: type, value: value };\n      this._version++;\n\n      if (this.onOutputAdded) {\n          this.onOutputAdded(name, type);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Assign a data to the global output\n   * @method setOutputData\n   * @param {String} name\n   * @param {String} value\n   */\n  LGraph.prototype.setOutputData = function(name, value) {\n      var output = this.outputs[name];\n      if (!output) {\n          return;\n      }\n      output.value = value;\n  };\n\n  /**\n   * Returns the current value of a global graph output\n   * @method getOutputData\n   * @param {String} name\n   * @return {*} the data\n   */\n  LGraph.prototype.getOutputData = function(name) {\n      var output = this.outputs[name];\n      if (!output) {\n          return null;\n      }\n      return output.value;\n  };\n\n  /**\n   * Renames a global graph output\n   * @method renameOutput\n   * @param {String} old_name\n   * @param {String} new_name\n   */\n  LGraph.prototype.renameOutput = function(old_name, name) {\n      if (!this.outputs[old_name]) {\n          return false;\n      }\n\n      if (this.outputs[name]) {\n          console.error(\"there is already one output with that name\");\n          return false;\n      }\n\n      this.outputs[name] = this.outputs[old_name];\n      delete this.outputs[old_name];\n      this._version++;\n\n      if (this.onOutputRenamed) {\n          this.onOutputRenamed(old_name, name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Changes the type of a global graph output\n   * @method changeOutputType\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.changeOutputType = function(name, type) {\n      if (!this.outputs[name]) {\n          return false;\n      }\n\n      if (\n          this.outputs[name].type &&\n          String(this.outputs[name].type).toLowerCase() ==\n              String(type).toLowerCase()\n      ) {\n          return;\n      }\n\n      this.outputs[name].type = type;\n      this._version++;\n      if (this.onOutputTypeChanged) {\n          this.onOutputTypeChanged(name, type);\n      }\n  };\n\n  /**\n   * Removes a global graph output\n   * @method removeOutput\n   * @param {String} name\n   */\n  LGraph.prototype.removeOutput = function(name) {\n      if (!this.outputs[name]) {\n          return false;\n      }\n      delete this.outputs[name];\n      this._version++;\n\n      if (this.onOutputRemoved) {\n          this.onOutputRemoved(name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n      return true;\n  };\n\n  LGraph.prototype.triggerInput = function(name, value) {\n      var nodes = this.findNodesByTitle(name);\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].onTrigger(value);\n      }\n  };\n\n  LGraph.prototype.setCallback = function(name, func) {\n      var nodes = this.findNodesByTitle(name);\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].setTrigger(func);\n      }\n  };\n\n  LGraph.prototype.connectionChange = function(node, link_info) {\n      this.updateExecutionOrder();\n      if (this.onConnectionChange) {\n          this.onConnectionChange(node);\n      }\n      this._version++;\n      this.sendActionToCanvas(\"onConnectionChange\");\n  };\n\n  /**\n   * returns if the graph is in live mode\n   * @method isLive\n   */\n\n  LGraph.prototype.isLive = function() {\n      if (!this.list_of_graphcanvas) {\n          return false;\n      }\n\n      for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n          var c = this.list_of_graphcanvas[i];\n          if (c.live_mode) {\n              return true;\n          }\n      }\n      return false;\n  };\n\n  /**\n   * clears the triggered slot animation in all links (stop visual animation)\n   * @method clearTriggeredSlots\n   */\n  LGraph.prototype.clearTriggeredSlots = function() {\n      for (var i in this.links) {\n          var link_info = this.links[i];\n          if (!link_info) {\n              continue;\n          }\n          if (link_info._last_time) {\n              link_info._last_time = 0;\n          }\n      }\n  };\n\n  /* Called when something visually changed (not the graph!) */\n  LGraph.prototype.change = function() {\n      if (LiteGraph.debug) {\n          console.log(\"Graph changed\");\n      }\n      this.sendActionToCanvas(\"setDirty\", [true, true]);\n      if (this.on_change) {\n          this.on_change(this);\n      }\n  };\n\n  LGraph.prototype.setDirtyCanvas = function(fg, bg) {\n      this.sendActionToCanvas(\"setDirty\", [fg, bg]);\n  };\n\n  /**\n   * Destroys a link\n   * @method removeLink\n   * @param {Number} link_id\n   */\n  LGraph.prototype.removeLink = function(link_id) {\n      var link = this.links[link_id];\n      if (!link) {\n          return;\n      }\n      var node = this.getNodeById(link.target_id);\n      if (node) {\n          node.disconnectInput(link.target_slot);\n      }\n  };\n\n  //save and recover app state ***************************************\n  /**\n   * Creates a Object containing all the info about this graph, it can be serialized\n   * @method serialize\n   * @return {Object} value of the node\n   */\n  LGraph.prototype.serialize = function() {\n      var nodes_info = [];\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          nodes_info.push(this._nodes[i].serialize());\n      }\n\n      //pack link info into a non-verbose format\n      var links = [];\n      for (var i in this.links) {\n          //links is an OBJECT\n          var link = this.links[i];\n          if (!link.serialize) {\n              //weird bug I havent solved yet\n              console.warn(\n                  \"weird LLink bug, link info is not a LLink but a regular object\"\n              );\n              var link2 = new LLink();\n              for (var i in link) {\n                  link2[i] = link[i];\n              }\n              this.links[i] = link2;\n              link = link2;\n          }\n\n          links.push(link.serialize());\n      }\n\n      var groups_info = [];\n      for (var i = 0; i < this._groups.length; ++i) {\n          groups_info.push(this._groups[i].serialize());\n      }\n\n      var data = {\n          last_node_id: this.last_node_id,\n          last_link_id: this.last_link_id,\n          nodes: nodes_info,\n          links: links,\n          groups: groups_info,\n          config: this.config,\n          version: LiteGraph.VERSION\n      };\n\n      return data;\n  };\n\n  /**\n   * Configure a graph from a JSON string\n   * @method configure\n   * @param {String} str configure a graph from a JSON string\n   * @param {Boolean} returns if there was any error parsing\n   */\n  LGraph.prototype.configure = function(data, keep_old) {\n      if (!data) {\n          return;\n      }\n\n      if (!keep_old) {\n          this.clear();\n      }\n\n      var nodes = data.nodes;\n\n      //decode links info (they are very verbose)\n      if (data.links && data.links.constructor === Array) {\n          var links = [];\n          for (var i = 0; i < data.links.length; ++i) {\n              var link_data = data.links[i];\n      if(!link_data) //weird bug\n      {\n        console.warn(\"serialized graph link data contains errors, skipping.\");\n        continue;\n      }\n              var link = new LLink();\n              link.configure(link_data);\n              links[link.id] = link;\n          }\n          data.links = links;\n      }\n\n      //copy all stored fields\n      for (var i in data) {\n    if(i == \"nodes\" || i == \"groups\")\n      continue;\n          this[i] = data[i];\n      }\n\n      var error = false;\n\n      //create nodes\n      this._nodes = [];\n      if (nodes) {\n          for (var i = 0, l = nodes.length; i < l; ++i) {\n              var n_info = nodes[i]; //stored info\n              var node = LiteGraph.createNode(n_info.type, n_info.title);\n              if (!node) {\n                  if (LiteGraph.debug) {\n                      console.log(\n                          \"Node not found or has errors: \" + n_info.type\n                      );\n                  }\n\n                  //in case of error we create a replacement node to avoid losing info\n                  node = new LGraphNode();\n                  node.last_serialization = n_info;\n                  node.has_errors = true;\n                  error = true;\n                  //continue;\n              }\n\n              node.id = n_info.id; //id it or it will create a new id\n              this.add(node, true); //add before configure, otherwise configure cannot create links\n          }\n\n          //configure nodes afterwards so they can reach each other\n          for (var i = 0, l = nodes.length; i < l; ++i) {\n              var n_info = nodes[i];\n              var node = this.getNodeById(n_info.id);\n              if (node) {\n                  node.configure(n_info);\n              }\n          }\n      }\n\n      //groups\n      this._groups.length = 0;\n      if (data.groups) {\n          for (var i = 0; i < data.groups.length; ++i) {\n              var group = new LiteGraph.LGraphGroup();\n              group.configure(data.groups[i]);\n              this.add(group);\n          }\n      }\n\n      this.updateExecutionOrder();\n      this._version++;\n      this.setDirtyCanvas(true, true);\n      return error;\n  };\n\n  LGraph.prototype.load = function(url) {\n      var that = this;\n      var req = new XMLHttpRequest();\n      req.open(\"GET\", url, true);\n      req.send(null);\n      req.onload = function(oEvent) {\n          if (req.status !== 200) {\n              console.error(\"Error loading graph:\", req.status, req.response);\n              return;\n          }\n          var data = JSON.parse(req.response);\n          that.configure(data);\n      };\n      req.onerror = function(err) {\n          console.error(\"Error loading graph:\", err);\n      };\n  };\n\n  LGraph.prototype.onNodeTrace = function(node, msg, color) {\n      //TODO\n  };\n\n  //this is the class in charge of storing link information\n  function LLink(id, type, origin_id, origin_slot, target_id, target_slot) {\n      this.id = id;\n      this.type = type;\n      this.origin_id = origin_id;\n      this.origin_slot = origin_slot;\n      this.target_id = target_id;\n      this.target_slot = target_slot;\n\n      this._data = null;\n      this._pos = new Float32Array(2); //center\n  }\n\n  LLink.prototype.configure = function(o) {\n      if (o.constructor === Array) {\n          this.id = o[0];\n          this.origin_id = o[1];\n          this.origin_slot = o[2];\n          this.target_id = o[3];\n          this.target_slot = o[4];\n          this.type = o[5];\n      } else {\n          this.id = o.id;\n          this.type = o.type;\n          this.origin_id = o.origin_id;\n          this.origin_slot = o.origin_slot;\n          this.target_id = o.target_id;\n          this.target_slot = o.target_slot;\n      }\n  };\n\n  LLink.prototype.serialize = function() {\n      return [\n          this.id,\n          this.origin_id,\n          this.origin_slot,\n          this.target_id,\n          this.target_slot,\n          this.type\n      ];\n  };\n\n  LiteGraph.LLink = LLink;\n\n  // *************************************************************\n  //   Node CLASS                                          *******\n  // *************************************************************\n\n  /*\ntitle: string\npos: [x,y]\nsize: [x,y]\n\ninput|output: every connection\n  +  { name:string, type:string, pos: [x,y]=Optional, direction: \"input\"|\"output\", links: Array });\n\ngeneral properties:\n  + clip_area: if you render outside the node, it will be clipped\n  + unsafe_execution: not allowed for safe execution\n  + skip_repeated_outputs: when adding new outputs, it wont show if there is one already connected\n  + resizable: if set to false it wont be resizable with the mouse\n  + horizontal: slots are distributed horizontally\n  + widgets_start_y: widgets start at y distance from the top of the node\n\nflags object:\n  + collapsed: if it is collapsed\n\nsupported callbacks:\n  + onAdded: when added to graph (warning: this is called BEFORE the node is configured when loading)\n  + onRemoved: when removed from graph\n  + onStart:\twhen the graph starts playing\n  + onStop:\twhen the graph stops playing\n  + onDrawForeground: render the inside widgets inside the node\n  + onDrawBackground: render the background area inside the node (only in edit mode)\n  + onMouseDown\n  + onMouseMove\n  + onMouseUp\n  + onMouseEnter\n  + onMouseLeave\n  + onExecute: execute the node\n  + onPropertyChanged: when a property is changed in the panel (return true to skip default behaviour)\n  + onGetInputs: returns an array of possible inputs\n  + onGetOutputs: returns an array of possible outputs\n  + onBounding: in case this node has a bigger bounding than the node itself (the callback receives the bounding as [x,y,w,h])\n  + onDblClick: double clicked in the node\n  + onInputDblClick: input slot double clicked (can be used to automatically create a node connected)\n  + onOutputDblClick: output slot double clicked (can be used to automatically create a node connected)\n  + onConfigure: called after the node has been configured\n  + onSerialize: to add extra info when serializing (the callback receives the object that should be filled with the data)\n  + onSelected\n  + onDeselected\n  + onDropItem : DOM item dropped over the node\n  + onDropFile : file dropped over the node\n  + onConnectInput : if returns false the incoming connection will be canceled\n  + onConnectionsChange : a connection changed (new one or removed) (LiteGraph.INPUT or LiteGraph.OUTPUT, slot, true if connected, link_info, input_info )\n  + onAction: action slot triggered\n  + getExtraMenuOptions: to add option to context menu\n*/\n\n  /**\n   * Base Class for all the node type classes\n   * @class LGraphNode\n   * @param {String} name a name for the node\n   */\n\n  function LGraphNode(title) {\n      this._ctor(title);\n  }\n\n  global.LGraphNode = LiteGraph.LGraphNode = LGraphNode;\n\n  LGraphNode.prototype._ctor = function(title) {\n      this.title = title || \"Unnamed\";\n      this.size = [LiteGraph.NODE_WIDTH, 60];\n      this.graph = null;\n\n      this._pos = new Float32Array(10, 10);\n\n      Object.defineProperty(this, \"pos\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._pos[0] = v[0];\n              this._pos[1] = v[1];\n          },\n          get: function() {\n              return this._pos;\n          },\n          enumerable: true\n      });\n\n      this.id = -1; //not know till not added\n      this.type = null;\n\n      //inputs available: array of inputs\n      this.inputs = [];\n      this.outputs = [];\n      this.connections = [];\n\n      //local data\n      this.properties = {}; //for the values\n      this.properties_info = []; //for the info\n\n      this.flags = {};\n  };\n\n  /**\n   * configure a node from an object containing the serialized info\n   * @method configure\n   */\n  LGraphNode.prototype.configure = function(info) {\n      if (this.graph) {\n          this.graph._version++;\n      }\n      for (var j in info) {\n          if (j == \"properties\") {\n              //i don't want to clone properties, I want to reuse the old container\n              for (var k in info.properties) {\n                  this.properties[k] = info.properties[k];\n                  if (this.onPropertyChanged) {\n                      this.onPropertyChanged( k, info.properties[k] );\n                  }\n              }\n              continue;\n          }\n\n          if (info[j] == null) {\n              continue;\n          } else if (typeof info[j] == \"object\") {\n              //object\n              if (this[j] && this[j].configure) {\n                  this[j].configure(info[j]);\n              } else {\n                  this[j] = LiteGraph.cloneObject(info[j], this[j]);\n              }\n          } //value\n          else {\n              this[j] = info[j];\n          }\n      }\n\n      if (!info.title) {\n          this.title = this.constructor.title;\n      }\n\n      if (this.onConnectionsChange) {\n          if (this.inputs) {\n              for (var i = 0; i < this.inputs.length; ++i) {\n                  var input = this.inputs[i];\n                  var link_info = this.graph\n                      ? this.graph.links[input.link]\n                      : null;\n                  this.onConnectionsChange(\n                      LiteGraph.INPUT,\n                      i,\n                      true,\n                      link_info,\n                      input\n                  ); //link_info has been created now, so its updated\n              }\n          }\n\n          if (this.outputs) {\n              for (var i = 0; i < this.outputs.length; ++i) {\n                  var output = this.outputs[i];\n                  if (!output.links) {\n                      continue;\n                  }\n                  for (var j = 0; j < output.links.length; ++j) {\n                      var link_info = this.graph\n                          ? this.graph.links[output.links[j]]\n                          : null;\n                      this.onConnectionsChange(\n                          LiteGraph.OUTPUT,\n                          i,\n                          true,\n                          link_info,\n                          output\n                      ); //link_info has been created now, so its updated\n                  }\n              }\n          }\n      }\n\n  if( this.widgets )\n  {\n    for (var i = 0; i < this.widgets.length; ++i)\n    {\n      var w = this.widgets[i];\n      if(w.options && w.options.property && this.properties[ w.options.property ])\n        w.value = JSON.parse( JSON.stringify( this.properties[ w.options.property ] ) );\n    }\n    if (info.widgets_values) {\n      for (var i = 0; i < info.widgets_values.length; ++i) {\n        if (this.widgets[i]) {\n          this.widgets[i].value = info.widgets_values[i];\n        }\n      }\n    }\n  }\n\n      if (this.onConfigure) {\n          this.onConfigure(info);\n      }\n  };\n\n  /**\n   * serialize the content\n   * @method serialize\n   */\n\n  LGraphNode.prototype.serialize = function() {\n      //create serialization object\n      var o = {\n          id: this.id,\n          type: this.type,\n          pos: this.pos,\n          size: this.size,\n          flags: LiteGraph.cloneObject(this.flags),\n    order: this.order,\n          mode: this.mode\n      };\n\n      //special case for when there were errors\n      if (this.constructor === LGraphNode && this.last_serialization) {\n          return this.last_serialization;\n      }\n\n      if (this.inputs) {\n          o.inputs = this.inputs;\n      }\n\n      if (this.outputs) {\n          //clear outputs last data (because data in connections is never serialized but stored inside the outputs info)\n          for (var i = 0; i < this.outputs.length; i++) {\n              delete this.outputs[i]._data;\n          }\n          o.outputs = this.outputs;\n      }\n\n      if (this.title && this.title != this.constructor.title) {\n          o.title = this.title;\n      }\n\n      if (this.properties) {\n          o.properties = LiteGraph.cloneObject(this.properties);\n      }\n\n      if (this.widgets && this.serialize_widgets) {\n          o.widgets_values = [];\n          for (var i = 0; i < this.widgets.length; ++i) {\n              o.widgets_values[i] = this.widgets[i].value;\n          }\n      }\n\n      if (!o.type) {\n          o.type = this.constructor.type;\n      }\n\n      if (this.color) {\n          o.color = this.color;\n      }\n      if (this.bgcolor) {\n          o.bgcolor = this.bgcolor;\n      }\n      if (this.boxcolor) {\n          o.boxcolor = this.boxcolor;\n      }\n      if (this.shape) {\n          o.shape = this.shape;\n      }\n\n      if (this.onSerialize) {\n          if (this.onSerialize(o)) {\n              console.warn(\n                  \"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter\"\n              );\n          }\n      }\n\n      return o;\n  };\n\n  /* Creates a clone of this node */\n  LGraphNode.prototype.clone = function() {\n      var node = LiteGraph.createNode(this.type);\n      if (!node) {\n          return null;\n      }\n\n      //we clone it because serialize returns shared containers\n      var data = LiteGraph.cloneObject(this.serialize());\n\n      //remove links\n      if (data.inputs) {\n          for (var i = 0; i < data.inputs.length; ++i) {\n              data.inputs[i].link = null;\n          }\n      }\n\n      if (data.outputs) {\n          for (var i = 0; i < data.outputs.length; ++i) {\n              if (data.outputs[i].links) {\n                  data.outputs[i].links.length = 0;\n              }\n          }\n      }\n\n      delete data[\"id\"];\n      //remove links\n      node.configure(data);\n\n      return node;\n  };\n\n  /**\n   * serialize and stringify\n   * @method toString\n   */\n\n  LGraphNode.prototype.toString = function() {\n      return JSON.stringify(this.serialize());\n  };\n  //LGraphNode.prototype.deserialize = function(info) {} //this cannot be done from within, must be done in LiteGraph\n\n  /**\n   * get the title string\n   * @method getTitle\n   */\n\n  LGraphNode.prototype.getTitle = function() {\n      return this.title || this.constructor.title;\n  };\n\n  /**\n   * sets the value of a property\n   * @method setProperty\n   * @param {String} name\n   * @param {*} value\n   */\n  LGraphNode.prototype.setProperty = function(name, value) {\n      if (!this.properties) {\n          this.properties = {};\n      }\n  if( value === this.properties[name] )\n    return;\n  var prev_value = this.properties[name];\n      this.properties[name] = value;\n      if (this.onPropertyChanged) {\n          if( this.onPropertyChanged(name, value, prev_value) === false ) //abort change\n      this.properties[name] = prev_value;\n      }\n  };\n\n  // Execution *************************\n  /**\n   * sets the output data\n   * @method setOutputData\n   * @param {number} slot\n   * @param {*} data\n   */\n  LGraphNode.prototype.setOutputData = function(slot, data) {\n      if (!this.outputs) {\n          return;\n      }\n\n      //this maybe slow and a niche case\n      //if(slot && slot.constructor === String)\n      //\tslot = this.findOutputSlot(slot);\n\n      if (slot == -1 || slot >= this.outputs.length) {\n          return;\n      }\n\n      var output_info = this.outputs[slot];\n      if (!output_info) {\n          return;\n      }\n\n      //store data in the output itself in case we want to debug\n      output_info._data = data;\n\n      //if there are connections, pass the data to the connections\n      if (this.outputs[slot].links) {\n          for (var i = 0; i < this.outputs[slot].links.length; i++) {\n              var link_id = this.outputs[slot].links[i];\n      var link = this.graph.links[link_id];\n      if(link)\n        link.data = data;\n          }\n      }\n  };\n\n  /**\n   * sets the output data type, useful when you want to be able to overwrite the data type\n   * @method setOutputDataType\n   * @param {number} slot\n   * @param {String} datatype\n   */\n  LGraphNode.prototype.setOutputDataType = function(slot, type) {\n      if (!this.outputs) {\n          return;\n      }\n      if (slot == -1 || slot >= this.outputs.length) {\n          return;\n      }\n      var output_info = this.outputs[slot];\n      if (!output_info) {\n          return;\n      }\n      //store data in the output itself in case we want to debug\n      output_info.type = type;\n\n      //if there are connections, pass the data to the connections\n      if (this.outputs[slot].links) {\n          for (var i = 0; i < this.outputs[slot].links.length; i++) {\n              var link_id = this.outputs[slot].links[i];\n              this.graph.links[link_id].type = type;\n          }\n      }\n  };\n\n  /**\n   * Retrieves the input data (data traveling through the connection) from one slot\n   * @method getInputData\n   * @param {number} slot\n   * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n   * @return {*} data or if it is not connected returns undefined\n   */\n  LGraphNode.prototype.getInputData = function(slot, force_update) {\n      if (!this.inputs) {\n          return;\n      } //undefined;\n\n      if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n          return;\n      }\n\n      var link_id = this.inputs[slot].link;\n      var link = this.graph.links[link_id];\n      if (!link) {\n          //bug: weird case but it happens sometimes\n          return null;\n      }\n\n      if (!force_update) {\n          return link.data;\n      }\n\n      //special case: used to extract data from the incoming connection before the graph has been executed\n      var node = this.graph.getNodeById(link.origin_id);\n      if (!node) {\n          return link.data;\n      }\n\n      if (node.updateOutputData) {\n          node.updateOutputData(link.origin_slot);\n      } else if (node.onExecute) {\n          node.onExecute();\n      }\n\n      return link.data;\n  };\n\n  /**\n   * Retrieves the input data type (in case this supports multiple input types)\n   * @method getInputDataType\n   * @param {number} slot\n   * @return {String} datatype in string format\n   */\n  LGraphNode.prototype.getInputDataType = function(slot) {\n      if (!this.inputs) {\n          return null;\n      } //undefined;\n\n      if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n          return null;\n      }\n      var link_id = this.inputs[slot].link;\n      var link = this.graph.links[link_id];\n      if (!link) {\n          //bug: weird case but it happens sometimes\n          return null;\n      }\n      var node = this.graph.getNodeById(link.origin_id);\n      if (!node) {\n          return link.type;\n      }\n      var output_info = node.outputs[link.origin_slot];\n      if (output_info) {\n          return output_info.type;\n      }\n      return null;\n  };\n\n  /**\n   * Retrieves the input data from one slot using its name instead of slot number\n   * @method getInputDataByName\n   * @param {String} slot_name\n   * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n   * @return {*} data or if it is not connected returns null\n   */\n  LGraphNode.prototype.getInputDataByName = function(\n      slot_name,\n      force_update\n  ) {\n      var slot = this.findInputSlot(slot_name);\n      if (slot == -1) {\n          return null;\n      }\n      return this.getInputData(slot, force_update);\n  };\n\n  /**\n   * tells you if there is a connection in one input slot\n   * @method isInputConnected\n   * @param {number} slot\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isInputConnected = function(slot) {\n      if (!this.inputs) {\n          return false;\n      }\n      return slot < this.inputs.length && this.inputs[slot].link != null;\n  };\n\n  LGraphNode.prototype.clearInput = function() {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  };\n\n  /**\n   * tells you info about an input connection (which node, type, etc)\n   * @method getInputInfo\n   * @param {number} slot\n   * @return {Object} object or null { link: id, name: string, type: string or 0 }\n   */\n  LGraphNode.prototype.getInputInfo = function(slot) {\n      if (!this.inputs) {\n          return null;\n      }\n      if (slot < this.inputs.length) {\n          return this.inputs[slot];\n      }\n      return null;\n  };\n\n  /**\n   * returns the node connected in the input slot\n   * @method getInputNode\n   * @param {number} slot\n   * @return {LGraphNode} node or null\n   */\n  LGraphNode.prototype.getInputNode = function(slot) {\n      if (!this.inputs) {\n          return null;\n      }\n      if (slot >= this.inputs.length) {\n          return null;\n      }\n      var input = this.inputs[slot];\n      if (!input || input.link === null) {\n          return null;\n      }\n      var link_info = this.graph.links[input.link];\n      if (!link_info) {\n          return null;\n      }\n      return this.graph.getNodeById(link_info.origin_id);\n  };\n\n  LGraphNode.prototype.getInputNodeByName = function(name) {\n    let slot = this.findInputSlot(name);\n    if (slot < 0)\n        return null;\n    return this.getInputNode(slot);\n    };\n\n    LGraphNode.prototype.getInputLinkByName = function(name) {\n        let slot = this.findInputSlot(name);\n        if (slot < 0)\n            return null;\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot >= this.inputs.length) {\n            return null;\n        }\n        var input = this.inputs[slot];\n        if (!input || input.link === null) {\n            return null;\n        }\n        var link_info = this.graph.links[input.link];\n        if (!link_info) {\n            return null;\n        }\n        return link_info;\n    };\n\n  /**\n   * returns the value of an input with this name, otherwise checks if there is a property with that name\n   * @method getInputOrProperty\n   * @param {string} name\n   * @return {*} value\n   */\n  LGraphNode.prototype.getInputOrProperty = function(name) {\n      if (!this.inputs || !this.inputs.length) {\n          return this.properties ? this.properties[name] : null;\n      }\n\n      for (var i = 0, l = this.inputs.length; i < l; ++i) {\n          var input_info = this.inputs[i];\n          if (name == input_info.name && input_info.link != null) {\n              var link = this.graph.links[input_info.link];\n              if (link) {\n                  return link.data;\n              }\n          }\n      }\n      return this.properties[name];\n  };\n\n  /**\n   * tells you the last output data that went in that slot\n   * @method getOutputData\n   * @param {number} slot\n   * @return {Object}  object or null\n   */\n  LGraphNode.prototype.getOutputData = function(slot) {\n      if (!this.outputs) {\n          return null;\n      }\n      if (slot >= this.outputs.length) {\n          return null;\n      }\n\n      var info = this.outputs[slot];\n      return info._data;\n  };\n\n  /**\n   * tells you info about an output connection (which node, type, etc)\n   * @method getOutputInfo\n   * @param {number} slot\n   * @return {Object}  object or null { name: string, type: string, links: [ ids of links in number ] }\n   */\n  LGraphNode.prototype.getOutputInfo = function(slot) {\n      if (!this.outputs) {\n          return null;\n      }\n      if (slot < this.outputs.length) {\n          return this.outputs[slot];\n      }\n      return null;\n  };\n\n  /**\n   * tells you if there is a connection in one output slot\n   * @method isOutputConnected\n   * @param {number} slot\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isOutputConnected = function(slot) {\n      if (!this.outputs) {\n          return false;\n      }\n      return (\n          slot < this.outputs.length &&\n          this.outputs[slot].links &&\n          this.outputs[slot].links.length\n      );\n  };\n\n  /**\n   * tells you if there is any connection in the output slots\n   * @method isAnyOutputConnected\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isAnyOutputConnected = function() {\n      if (!this.outputs) {\n          return false;\n      }\n      for (var i = 0; i < this.outputs.length; ++i) {\n          if (this.outputs[i].links && this.outputs[i].links.length) {\n              return true;\n          }\n      }\n      return false;\n  };\n\n  /**\n   * retrieves all the nodes connected to this output slot\n   * @method getOutputNodes\n   * @param {number} slot\n   * @return {array}\n   */\n  LGraphNode.prototype.getOutputNodes = function(slot) {\n      if (!this.outputs || this.outputs.length == 0) {\n          return null;\n      }\n\n      if (slot >= this.outputs.length) {\n          return null;\n      }\n\n      var output = this.outputs[slot];\n      if (!output.links || output.links.length == 0) {\n          return null;\n      }\n\n      var r = [];\n      for (var i = 0; i < output.links.length; i++) {\n          var link_id = output.links[i];\n          var link = this.graph.links[link_id];\n          if (link) {\n              var target_node = this.graph.getNodeById(link.target_id);\n              if (target_node) {\n                  r.push(target_node);\n              }\n          }\n      }\n      return r;\n  };\n\n  /**\n   * Triggers an event in this node, this will trigger any output with the same name\n   * @method trigger\n   * @param {String} event name ( \"on_play\", ... ) if action is equivalent to false then the event is send to all\n   * @param {*} param\n   */\n  LGraphNode.prototype.trigger = function(action, param) {\n      if (!this.outputs || !this.outputs.length) {\n          return;\n      }\n\n      if (this.graph)\n          this.graph._last_trigger_time = LiteGraph.getTime();\n\n      for (var i = 0; i < this.outputs.length; ++i) {\n          var output = this.outputs[i];\n          if ( !output || output.type !== LiteGraph.EVENT || (action && output.name != action) )\n              continue;\n          this.triggerSlot(i, param);\n      }\n  };\n\n  /**\n   * Triggers an slot event in this node\n   * @method triggerSlot\n   * @param {Number} slot the index of the output slot\n   * @param {*} param\n   * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n   */\n  LGraphNode.prototype.triggerSlot = function(slot, param, link_id) {\n      if (!this.outputs) {\n          return;\n      }\n\n      var output = this.outputs[slot];\n      if (!output) {\n          return;\n      }\n\n      var links = output.links;\n      if (!links || !links.length) {\n          return;\n      }\n\n      if (this.graph) {\n          this.graph._last_trigger_time = LiteGraph.getTime();\n      }\n\n      //for every link attached here\n      for (var k = 0; k < links.length; ++k) {\n          var id = links[k];\n          if (link_id != null && link_id != id) {\n              //to skip links\n              continue;\n          }\n          var link_info = this.graph.links[links[k]];\n          if (!link_info) {\n              //not connected\n              continue;\n          }\n          link_info._last_time = LiteGraph.getTime();\n          var node = this.graph.getNodeById(link_info.target_id);\n          if (!node) {\n              //node not found?\n              continue;\n          }\n\n          //used to mark events in graph\n          var target_connection = node.inputs[link_info.target_slot];\n\n          if (node.onAction) {\n              node.onAction(target_connection.name, param);\n          } else if (node.mode === LiteGraph.ON_TRIGGER) {\n              if (node.onExecute) {\n                  node.onExecute(param);\n              }\n          }\n      }\n  };\n\n  /**\n   * clears the trigger slot animation\n   * @method clearTriggeredSlot\n   * @param {Number} slot the index of the output slot\n   * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n   */\n  LGraphNode.prototype.clearTriggeredSlot = function(slot, link_id) {\n      if (!this.outputs) {\n          return;\n      }\n\n      var output = this.outputs[slot];\n      if (!output) {\n          return;\n      }\n\n      var links = output.links;\n      if (!links || !links.length) {\n          return;\n      }\n\n      //for every link attached here\n      for (var k = 0; k < links.length; ++k) {\n          var id = links[k];\n          if (link_id != null && link_id != id) {\n              //to skip links\n              continue;\n          }\n          var link_info = this.graph.links[links[k]];\n          if (!link_info) {\n              //not connected\n              continue;\n          }\n          link_info._last_time = 0;\n      }\n  };\n\n  /**\n   * add a new property to this node\n   * @method addProperty\n   * @param {string} name\n   * @param {*} default_value\n   * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n   * @param {Object} extra_info this can be used to have special properties of the property (like values, etc)\n   */\n  LGraphNode.prototype.addProperty = function(\n      name,\n      default_value,\n      type,\n      extra_info\n  ) {\n      var o = { name: name, type: type, default_value: default_value };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n      if (!this.properties_info) {\n          this.properties_info = [];\n      }\n      this.properties_info.push(o);\n      if (!this.properties) {\n          this.properties = {};\n      }\n      this.properties[name] = default_value;\n      return o;\n  };\n\n  //connections\n\n  /**\n   * add a new output slot to use in this node\n   * @method addOutput\n   * @param {string} name\n   * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n   * @param {Object} extra_info this can be used to have special properties of an output (label, special color, position, etc)\n   */\n  LGraphNode.prototype.addOutput = function(name, type, extra_info) {\n      var o = { name: name, type: type, links: null };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n\n      if (!this.outputs) {\n          this.outputs = [];\n      }\n      this.outputs.push(o);\n      if (this.onOutputAdded) {\n          this.onOutputAdded(o);\n      }\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n      return o;\n  };\n\n  /**\n   * add a new output slot to use in this node\n   * @method addOutputs\n   * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n   */\n  LGraphNode.prototype.addOutputs = function(array) {\n      for (var i = 0; i < array.length; ++i) {\n          var info = array[i];\n          var o = { name: info[0], type: info[1], link: null };\n          if (array[2]) {\n              for (var j in info[2]) {\n                  o[j] = info[2][j];\n              }\n          }\n\n          if (!this.outputs) {\n              this.outputs = [];\n          }\n          this.outputs.push(o);\n          if (this.onOutputAdded) {\n              this.onOutputAdded(o);\n          }\n      }\n\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * remove an existing output slot\n   * @method removeOutput\n   * @param {number} slot\n   */\n  LGraphNode.prototype.removeOutput = function(slot) {\n      this.disconnectOutput(slot);\n      this.outputs.splice(slot, 1);\n      for (var i = slot; i < this.outputs.length; ++i) {\n          if (!this.outputs[i] || !this.outputs[i].links) {\n              continue;\n          }\n          var links = this.outputs[i].links;\n          for (var j = 0; j < links.length; ++j) {\n              var link = this.graph.links[links[j]];\n              if (!link) {\n                  continue;\n              }\n              link.origin_slot -= 1;\n          }\n      }\n\n      this.size = this.computeSize();\n      if (this.onOutputRemoved) {\n          this.onOutputRemoved(slot);\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * add a new input slot to use in this node\n   * @method addInput\n   * @param {string} name\n   * @param {string} type string defining the input type (\"vec3\",\"number\",...), it its a generic one use 0\n   * @param {Object} extra_info this can be used to have special properties of an input (label, color, position, etc)\n   */\n  LGraphNode.prototype.addInput = function(name, type, extra_info) {\n      type = type || 0;\n      var o = { name: name, type: type, link: null };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n\n      if (!this.inputs) {\n          this.inputs = [];\n      }\n      this.inputs.push(o);\n      this.size = this.computeSize();\n      if (this.onInputAdded) {\n          this.onInputAdded(o);\n      }\n      this.setDirtyCanvas(true, true);\n      return o;\n  };\n\n  /**\n   * add several new input slots in this node\n   * @method addInputs\n   * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n   */\n  LGraphNode.prototype.addInputs = function(array) {\n      for (var i = 0; i < array.length; ++i) {\n          var info = array[i];\n          var o = { name: info[0], type: info[1], link: null };\n          if (array[2]) {\n              for (var j in info[2]) {\n                  o[j] = info[2][j];\n              }\n          }\n\n          if (!this.inputs) {\n              this.inputs = [];\n          }\n          this.inputs.push(o);\n          if (this.onInputAdded) {\n              this.onInputAdded(o);\n          }\n      }\n\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * remove an existing input slot\n   * @method removeInput\n   * @param {number} slot\n   */\n  LGraphNode.prototype.removeInput = function(slot) {\n      this.disconnectInput(slot);\n      this.inputs.splice(slot, 1);\n      for (var i = slot; i < this.inputs.length; ++i) {\n          if (!this.inputs[i]) {\n              continue;\n          }\n          var link = this.graph.links[this.inputs[i].link];\n          if (!link) {\n              continue;\n          }\n          link.target_slot -= 1;\n      }\n      this.size = this.computeSize();\n      if (this.onInputRemoved) {\n          this.onInputRemoved(slot);\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  LGraphNode.prototype.removeInputByName = function(name) {\n        let slot = -1;\n        for (var i = 0; i < this.inputs.length; ++i) {\n            if (this.inputs[i].name == name)\n                slot = i;\n        }\n        if (slot < 0)\n            return;\n        this.removeInput(slot);\n    };\n\n    LGraphNode.prototype.removeOutputByName = function(name) {\n        let slot = -1;\n        for (var i = 0; i < this.inputs.length; ++i) {\n            if (this.inputs[i].name == name)\n                slot = i;\n        }\n        if (slot < 0)\n            return;\n        this.removeOutput(slot);\n    };\n\n  /**\n   * add an special connection to this node (used for special kinds of graphs)\n   * @method addConnection\n   * @param {string} name\n   * @param {string} type string defining the input type (\"vec3\",\"number\",...)\n   * @param {[x,y]} pos position of the connection inside the node\n   * @param {string} direction if is input or output\n   */\n  LGraphNode.prototype.addConnection = function(name, type, pos, direction) {\n      var o = {\n          name: name,\n          type: type,\n          pos: pos,\n          direction: direction,\n          links: null\n      };\n      this.connections.push(o);\n      return o;\n  };\n\n  /**\n   * computes the size of a node according to its inputs and output slots\n   * @method computeSize\n   * @param {number} minHeight\n   * @return {number} the total size\n   */\n  LGraphNode.prototype.computeSize = function(minHeight, out) {\n      if (this.constructor.size) {\n          return this.constructor.size.concat();\n      }\n\n      var rows = Math.max(\n          this.inputs ? this.inputs.length : 1,\n          this.outputs ? this.outputs.length : 1\n      );\n      var size = out || new Float32Array([0, 0]);\n      rows = Math.max(rows, 1);\n      var font_size = LiteGraph.NODE_TEXT_SIZE; //although it should be graphcanvas.inner_text_font size\n      size[1] = (this.constructor.slot_start_y || 0) + rows * LiteGraph.NODE_SLOT_HEIGHT;\n\n      var widgets_height = 0;\n      if (this.widgets && this.widgets.length) {\n          widgets_height = this.widgets.length * (LiteGraph.NODE_WIDGET_HEIGHT + 4) + 8;\n      }\n\n  //compute height using widgets height\n  if( this.widgets_up )\n          size[1] = Math.max( size[1], widgets_height );\n  else if( this.widgets_start_y != null )\n          size[1] = Math.max( size[1], widgets_height + this.widgets_start_y );\n  else\n          size[1] += widgets_height;\n\n      var font_size = font_size;\n      var title_width = compute_text_size(this.title);\n      var input_width = 0;\n      var output_width = 0;\n\n      if (this.inputs) {\n          for (var i = 0, l = this.inputs.length; i < l; ++i) {\n              var input = this.inputs[i];\n              var text = input.label || input.name || \"\";\n              var text_width = compute_text_size(text);\n              if (input_width < text_width) {\n                  input_width = text_width;\n              }\n          }\n      }\n\n      if (this.outputs) {\n          for (var i = 0, l = this.outputs.length; i < l; ++i) {\n              var output = this.outputs[i];\n              var text = output.label || output.name || \"\";\n              var text_width = compute_text_size(text);\n              if (output_width < text_width) {\n                  output_width = text_width;\n              }\n          }\n      }\n\n      size[0] = Math.max(input_width + output_width + 10, title_width);\n      size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH);\n      if (this.widgets && this.widgets.length) {\n          size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH * 1.5);\n      }\n\n      if (this.onResize) {\n          this.onResize(size);\n      }\n\n      function compute_text_size(text) {\n          if (!text) {\n              return 0;\n          }\n          return font_size * text.length * 0.6;\n      }\n\n      if (\n          this.constructor.min_height &&\n          size[1] < this.constructor.min_height\n      ) {\n          size[1] = this.constructor.min_height;\n      }\n\n      size[1] += 6; //margin\n\n      return size;\n  };\n\n  /**\n   * Allows to pass\n   *\n   * @method addWidget\n   * @param {String} type the widget type (could be \"number\",\"string\",\"combo\"\n   * @param {String} name the text to show on the widget\n   * @param {String} value the default value\n   * @param {Function} callback function to call when it changes (optionally, it can be the name of the property to modify)\n   * @param {Object} options the object that contains special properties of this widget \n   * @return {Object} the created widget object\n   */\n  LGraphNode.prototype.addWidget = function( type, name, value, callback, options )\n{\n      if (!this.widgets) {\n          this.widgets = [];\n      }\n\n  if(!options && callback && callback.constructor === Object)\n  {\n    options = callback;\n    callback = null;\n  }\n\n  if(options && options.constructor === String) //options can be the property name\n    options = { property: options };\n\n  if(callback && callback.constructor === String) //callback can be the property name\n  {\n    if(!options)\n      options = {};\n    options.property = callback;\n    callback = null;\n  }\n\n  if(callback && callback.constructor !== Function)\n  {\n    console.warn(\"addWidget: callback must be a function\");\n    callback = null;\n  }\n\n      var w = {\n          type: type.toLowerCase(),\n          name: name,\n          value: value,\n          callback: callback,\n          options: options || {}\n      };\n\n      if (w.options.y !== undefined) {\n          w.y = w.options.y;\n      }\n\n      if (!callback && !w.options.callback && !w.options.property) {\n          console.warn(\"LiteGraph addWidget(...) without a callback or property assigned\");\n      }\n      if (type == \"combo\" && !w.options.values) {\n          throw \"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }\";\n      }\n      this.widgets.push(w);\n  this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n      return w;\n  };\n\n  LGraphNode.prototype.addCustomWidget = function(custom_widget) {\n      if (!this.widgets) {\n          this.widgets = [];\n      }\n      this.widgets.push(custom_widget);\n      return custom_widget;\n  };\n\n  /**\n   * returns the bounding of the object, used for rendering purposes\n   * bounding is: [topleft_cornerx, topleft_cornery, width, height]\n   * @method getBounding\n   * @return {Float32Array[4]} the total size\n   */\n  LGraphNode.prototype.getBounding = function(out) {\n      out = out || new Float32Array(4);\n      out[0] = this.pos[0] - 4;\n      out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n      out[2] = this.size[0] + 4;\n      out[3] = this.size[1] + LiteGraph.NODE_TITLE_HEIGHT;\n\n      if (this.onBounding) {\n          this.onBounding(out);\n      }\n      return out;\n  };\n\n  /**\n   * checks if a point is inside the shape of a node\n   * @method isPointInside\n   * @param {number} x\n   * @param {number} y\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isPointInside = function(x, y, margin, skip_title) {\n      margin = margin || 0;\n\n      var margin_top = this.graph && this.graph.isLive() ? 0 : LiteGraph.NODE_TITLE_HEIGHT;\n      if (skip_title) {\n          margin_top = 0;\n      }\n      if (this.flags && this.flags.collapsed) {\n          //if ( distance([x,y], [this.pos[0] + this.size[0]*0.5, this.pos[1] + this.size[1]*0.5]) < LiteGraph.NODE_COLLAPSED_RADIUS)\n          if (\n              isInsideRectangle(\n                  x,\n                  y,\n                  this.pos[0] - margin,\n                  this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT - margin,\n                  (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) +\n                      2 * margin,\n                  LiteGraph.NODE_TITLE_HEIGHT + 2 * margin\n              )\n          ) {\n              return true;\n          }\n      } else if (\n          this.pos[0] - 4 - margin < x &&\n          this.pos[0] + this.size[0] + 4 + margin > x &&\n          this.pos[1] - margin_top - margin < y &&\n          this.pos[1] + this.size[1] + margin > y\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  /**\n   * checks if a point is inside a node slot, and returns info about which slot\n   * @method getSlotInPosition\n   * @param {number} x\n   * @param {number} y\n   * @return {Object} if found the object contains { input|output: slot object, slot: number, link_pos: [x,y] }\n   */\n  LGraphNode.prototype.getSlotInPosition = function(x, y) {\n      //search for inputs\n      var link_pos = new Float32Array(2);\n      if (this.inputs) {\n          for (var i = 0, l = this.inputs.length; i < l; ++i) {\n              var input = this.inputs[i];\n              this.getConnectionPos(true, i, link_pos);\n              if (\n                  isInsideRectangle(\n                      x,\n                      y,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      20,\n                      10\n                  )\n              ) {\n                  return { input: input, slot: i, link_pos: link_pos };\n              }\n          }\n      }\n\n      if (this.outputs) {\n          for (var i = 0, l = this.outputs.length; i < l; ++i) {\n              var output = this.outputs[i];\n              this.getConnectionPos(false, i, link_pos);\n              if (\n                  isInsideRectangle(\n                      x,\n                      y,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      20,\n                      10\n                  )\n              ) {\n                  return { output: output, slot: i, link_pos: link_pos };\n              }\n          }\n      }\n\n      return null;\n  };\n\n  /**\n   * returns the input slot with a given name (used for dynamic slots), -1 if not found\n   * @method findInputSlot\n   * @param {string} name the name of the slot\n   * @return {number} the slot (-1 if not found)\n   */\n  LGraphNode.prototype.findInputSlot = function(name) {\n      if (!this.inputs) {\n          return -1;\n      }\n      for (var i = 0, l = this.inputs.length; i < l; ++i) {\n          if (name == this.inputs[i].name) {\n              return i;\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * returns the output slot with a given name (used for dynamic slots), -1 if not found\n   * @method findOutputSlot\n   * @param {string} name the name of the slot\n   * @return {number} the slot (-1 if not found)\n   */\n  LGraphNode.prototype.findOutputSlot = function(name) {\n      if (!this.outputs) {\n          return -1;\n      }\n      for (var i = 0, l = this.outputs.length; i < l; ++i) {\n          if (name == this.outputs[i].name) {\n              return i;\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * connect this node output to the input of another node\n   * @method connect\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {LGraphNode} node the target node\n   * @param {number_or_string} target_slot the input slot of the target node (could be the number of the slot or the string with the name of the slot, or -1 to connect a trigger)\n   * @return {Object} the link_info is created, otherwise null\n   */\n  LGraphNode.prototype.connect = function(slot, target_node, target_slot) {\n      target_slot = target_slot || 0;\n\n      if (!this.graph) {\n          //could be connected before adding it to a graph\n          console.log(\n              \"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them.\"\n          ); //due to link ids being associated with graphs\n          return null;\n      }\n\n      //seek for the output slot\n      if (slot.constructor === String) {\n          slot = this.findOutputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return null;\n          }\n      } else if (!this.outputs || slot >= this.outputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return null;\n      }\n\n      if (target_node && target_node.constructor === Number) {\n          target_node = this.graph.getNodeById(target_node);\n      }\n      if (!target_node) {\n          throw \"target node is null\";\n      }\n\n      //avoid loopback\n      if (target_node == this) {\n          return null;\n      }\n\n      //you can specify the slot by name\n      if (target_slot.constructor === String) {\n          target_slot = target_node.findInputSlot(target_slot);\n          if (target_slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\n                      \"Connect: Error, no slot of name \" + target_slot\n                  );\n              }\n              return null;\n          }\n      } else if (target_slot === LiteGraph.EVENT) {\n          //search for first slot with event?\n          /*\n  //create input for trigger\n  var input = target_node.addInput(\"onTrigger\", LiteGraph.EVENT );\n  target_slot = target_node.inputs.length - 1; //last one is the one created\n  target_node.mode = LiteGraph.ON_TRIGGER;\n  */\n          return null;\n      } else if (\n          !target_node.inputs ||\n          target_slot >= target_node.inputs.length\n      ) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return null;\n      }\n\n      //if there is something already plugged there, disconnect\n      if (target_node.inputs[target_slot].link != null) {\n          target_node.disconnectInput(target_slot);\n      }\n\n      //why here??\n      //this.setDirtyCanvas(false,true);\n      //this.graph.connectionChange( this );\n\n      var output = this.outputs[slot];\n\n      //allows nodes to block connection\n      if (target_node.onConnectInput) {\n          if (\n              target_node.onConnectInput(target_slot, output.type, output) ===\n              false\n          ) {\n              return null;\n          }\n      }\n\n      var input = target_node.inputs[target_slot];\n      var link_info = null;\n\n      if (LiteGraph.isValidConnection(output.type, input.type)) {\n          link_info = new LLink(\n              ++this.graph.last_link_id,\n              input.type,\n              this.id,\n              slot,\n              target_node.id,\n              target_slot\n          );\n\n          //add to graph links list\n          this.graph.links[link_info.id] = link_info;\n\n          //connect in output\n          if (output.links == null) {\n              output.links = [];\n          }\n          output.links.push(link_info.id);\n          //connect in input\n          target_node.inputs[target_slot].link = link_info.id;\n          if (this.graph) {\n              this.graph._version++;\n          }\n          if (this.onConnectionsChange) {\n              this.onConnectionsChange(\n                  LiteGraph.OUTPUT,\n                  slot,\n                  true,\n                  link_info,\n                  output\n              );\n          } //link_info has been created now, so its updated\n          if (target_node.onConnectionsChange) {\n              target_node.onConnectionsChange(\n                  LiteGraph.INPUT,\n                  target_slot,\n                  true,\n                  link_info,\n                  input\n              );\n          }\n          if (this.graph && this.graph.onNodeConnectionChange) {\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.INPUT,\n                  target_node,\n                  target_slot,\n                  this,\n                  slot\n              );\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.OUTPUT,\n                  this,\n                  slot,\n                  target_node,\n                  target_slot\n              );\n          }\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this, link_info);\n\n      return link_info;\n  };\n\n  /**\n   * disconnect one output to an specific node\n   * @method disconnectOutput\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {LGraphNode} target_node the target node to which this slot is connected [Optional, if not target_node is specified all nodes will be disconnected]\n   * @return {boolean} if it was disconnected successfully\n   */\n  LGraphNode.prototype.disconnectOutput = function(slot, target_node) {\n      if (slot.constructor === String) {\n          slot = this.findOutputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return false;\n          }\n      } else if (!this.outputs || slot >= this.outputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return false;\n      }\n\n      //get output slot\n      var output = this.outputs[slot];\n      if (!output || !output.links || output.links.length == 0) {\n          return false;\n      }\n\n      //one of the output links in this slot\n      if (target_node) {\n          if (target_node.constructor === Number) {\n              target_node = this.graph.getNodeById(target_node);\n          }\n          if (!target_node) {\n              throw \"Target Node not found\";\n          }\n\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              var link_id = output.links[i];\n              var link_info = this.graph.links[link_id];\n\n              //is the link we are searching for...\n              if (link_info.target_id == target_node.id) {\n                  output.links.splice(i, 1); //remove here\n                  var input = target_node.inputs[link_info.target_slot];\n                  input.link = null; //remove there\n                  delete this.graph.links[link_id]; //remove the link from the links pool\n                  if (this.graph) {\n                      this.graph._version++;\n                  }\n                  if (target_node.onConnectionsChange) {\n                      target_node.onConnectionsChange(\n                          LiteGraph.INPUT,\n                          link_info.target_slot,\n                          false,\n                          link_info,\n                          input\n                      );\n                  } //link_info hasn't been modified so its ok\n                  if (this.onConnectionsChange) {\n                      this.onConnectionsChange(\n                          LiteGraph.OUTPUT,\n                          slot,\n                          false,\n                          link_info,\n                          output\n                      );\n                  }\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.OUTPUT,\n                          this,\n                          slot\n                      );\n                  }\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.OUTPUT,\n                          this,\n                          slot\n                      );\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.INPUT,\n                          target_node,\n                          link_info.target_slot\n                      );\n                  }\n                  break;\n              }\n          }\n      } //all the links in this output slot\n      else {\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              var link_id = output.links[i];\n              var link_info = this.graph.links[link_id];\n              if (!link_info) {\n                  //bug: it happens sometimes\n                  continue;\n              }\n\n              var target_node = this.graph.getNodeById(link_info.target_id);\n              var input = null;\n              if (this.graph) {\n                  this.graph._version++;\n              }\n              if (target_node) {\n                  input = target_node.inputs[link_info.target_slot];\n                  input.link = null; //remove other side link\n                  if (target_node.onConnectionsChange) {\n                      target_node.onConnectionsChange(\n                          LiteGraph.INPUT,\n                          link_info.target_slot,\n                          false,\n                          link_info,\n                          input\n                      );\n                  } //link_info hasn't been modified so its ok\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.INPUT,\n                          target_node,\n                          link_info.target_slot\n                      );\n                  }\n              }\n              delete this.graph.links[link_id]; //remove the link from the links pool\n              if (this.onConnectionsChange) {\n                  this.onConnectionsChange(\n                      LiteGraph.OUTPUT,\n                      slot,\n                      false,\n                      link_info,\n                      output\n                  );\n              }\n              if (this.graph && this.graph.onNodeConnectionChange) {\n                  this.graph.onNodeConnectionChange(\n                      LiteGraph.OUTPUT,\n                      this,\n                      slot\n                  );\n                  this.graph.onNodeConnectionChange(\n                      LiteGraph.INPUT,\n                      target_node,\n                      link_info.target_slot\n                  );\n              }\n          }\n          output.links = null;\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this);\n      return true;\n  };\n\n  /**\n   * disconnect one input\n   * @method disconnectInput\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @return {boolean} if it was disconnected successfully\n   */\n  LGraphNode.prototype.disconnectInput = function(slot) {\n      //seek for the output slot\n      if (slot.constructor === String) {\n          slot = this.findInputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return false;\n          }\n      } else if (!this.inputs || slot >= this.inputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return false;\n      }\n\n      var input = this.inputs[slot];\n      if (!input) {\n          return false;\n      }\n\n      var link_id = this.inputs[slot].link;\n      this.inputs[slot].link = null;\n\n      //remove other side\n      var link_info = this.graph.links[link_id];\n      if (link_info) {\n          var target_node = this.graph.getNodeById(link_info.origin_id);\n          if (!target_node) {\n              return false;\n          }\n\n          var output = target_node.outputs[link_info.origin_slot];\n          if (!output || !output.links || output.links.length == 0) {\n              return false;\n          }\n\n          //search in the inputs list for this link\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              if (output.links[i] == link_id) {\n                  output.links.splice(i, 1);\n                  break;\n              }\n          }\n\n          delete this.graph.links[link_id]; //remove from the pool\n          if (this.graph) {\n              this.graph._version++;\n          }\n          if (this.onConnectionsChange) {\n              this.onConnectionsChange(\n                  LiteGraph.INPUT,\n                  slot,\n                  false,\n                  link_info,\n                  input\n              );\n          }\n          if (target_node.onConnectionsChange) {\n              target_node.onConnectionsChange(\n                  LiteGraph.OUTPUT,\n                  i,\n                  false,\n                  link_info,\n                  output\n              );\n          }\n          if (this.graph && this.graph.onNodeConnectionChange) {\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.OUTPUT,\n                  target_node,\n                  i\n              );\n              this.graph.onNodeConnectionChange(LiteGraph.INPUT, this, slot);\n          }\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this);\n      return true;\n  };\n\n  /**\n   * returns the center of a connection point in canvas coords\n   * @method getConnectionPos\n   * @param {boolean} is_input true if if a input slot, false if it is an output\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {vec2} out [optional] a place to store the output, to free garbage\n   * @return {[x,y]} the position\n   **/\n  LGraphNode.prototype.getConnectionPos = function(\n      is_input,\n      slot_number,\n      out\n  ) {\n      out = out || new Float32Array(2);\n      var num_slots = 0;\n      if (is_input && this.inputs) {\n          num_slots = this.inputs.length;\n      }\n      if (!is_input && this.outputs) {\n          num_slots = this.outputs.length;\n      }\n\n      var offset = LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n\n      if (this.flags.collapsed) {\n          var w = this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH;\n          if (this.horizontal) {\n              out[0] = this.pos[0] + w * 0.5;\n              if (is_input) {\n                  out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n              } else {\n                  out[1] = this.pos[1];\n              }\n          } else {\n              if (is_input) {\n                  out[0] = this.pos[0];\n              } else {\n                  out[0] = this.pos[0] + w;\n              }\n              out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          }\n          return out;\n      }\n\n      //weird feature that never got finished\n      if (is_input && slot_number == -1) {\n          out[0] = this.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          out[1] = this.pos[1] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          return out;\n      }\n\n      //hard-coded pos\n      if (\n          is_input &&\n          num_slots > slot_number &&\n          this.inputs[slot_number].pos\n      ) {\n          out[0] = this.pos[0] + this.inputs[slot_number].pos[0];\n          out[1] = this.pos[1] + this.inputs[slot_number].pos[1];\n          return out;\n      } else if (\n          !is_input &&\n          num_slots > slot_number &&\n          this.outputs[slot_number].pos\n      ) {\n          out[0] = this.pos[0] + this.outputs[slot_number].pos[0];\n          out[1] = this.pos[1] + this.outputs[slot_number].pos[1];\n          return out;\n      }\n\n      //horizontal distributed slots\n      if (this.horizontal) {\n          out[0] =\n              this.pos[0] + (slot_number + 0.5) * (this.size[0] / num_slots);\n          if (is_input) {\n              out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n          } else {\n              out[1] = this.pos[1] + this.size[1];\n          }\n          return out;\n      }\n\n      //default vertical slots\n      if (is_input) {\n          out[0] = this.pos[0] + offset;\n      } else {\n          out[0] = this.pos[0] + this.size[0] + 1 - offset;\n      }\n      out[1] =\n          this.pos[1] +\n          (slot_number + 0.7) * LiteGraph.NODE_SLOT_HEIGHT +\n          (this.constructor.slot_start_y || 0);\n      return out;\n  };\n\n  /* Force align to grid */\n  LGraphNode.prototype.alignToGrid = function() {\n      this.pos[0] =\n          LiteGraph.CANVAS_GRID_SIZE *\n          Math.round(this.pos[0] / LiteGraph.CANVAS_GRID_SIZE);\n      this.pos[1] =\n          LiteGraph.CANVAS_GRID_SIZE *\n          Math.round(this.pos[1] / LiteGraph.CANVAS_GRID_SIZE);\n  };\n\n  /* Console output */\n  LGraphNode.prototype.trace = function(msg) {\n      if (!this.console) {\n          this.console = [];\n      }\n      this.console.push(msg);\n      if (this.console.length > LGraphNode.MAX_CONSOLE) {\n          this.console.shift();\n      }\n\n      this.graph.onNodeTrace(this, msg);\n  };\n\n  /* Forces to redraw or the main canvas (LGraphNode) or the bg canvas (links) */\n  LGraphNode.prototype.setDirtyCanvas = function(\n      dirty_foreground,\n      dirty_background\n  ) {\n      if (!this.graph) {\n          return;\n      }\n      this.graph.sendActionToCanvas(\"setDirty\", [\n          dirty_foreground,\n          dirty_background\n      ]);\n  };\n\n  LGraphNode.prototype.loadImage = function(url) {\n      var img = new Image();\n      img.src = LiteGraph.node_images_path + url;\n      img.ready = false;\n\n      var that = this;\n      img.onload = function() {\n          this.ready = true;\n          that.setDirtyCanvas(true);\n      };\n      return img;\n  };\n\n  //safe LGraphNode action execution (not sure if safe)\n  /*\nLGraphNode.prototype.executeAction = function(action)\n{\nif(action == \"\") return false;\n\nif( action.indexOf(\";\") != -1 || action.indexOf(\"}\") != -1)\n{\n  this.trace(\"Error: Action contains unsafe characters\");\n  return false;\n}\n\nvar tokens = action.split(\"(\");\nvar func_name = tokens[0];\nif( typeof(this[func_name]) != \"function\")\n{\n  this.trace(\"Error: Action not found on node: \" + func_name);\n  return false;\n}\n\nvar code = action;\n\ntry\n{\n  var _foo = eval;\n  eval = null;\n  (new Function(\"with(this) { \" + code + \"}\")).call(this);\n  eval = _foo;\n}\ncatch (err)\n{\n  this.trace(\"Error executing action {\" + action + \"} :\" + err);\n  return false;\n}\n\nreturn true;\n}\n*/\n\n  /* Allows to get onMouseMove and onMouseUp events even if the mouse is out of focus */\n  LGraphNode.prototype.captureInput = function(v) {\n      if (!this.graph || !this.graph.list_of_graphcanvas) {\n          return;\n      }\n\n      var list = this.graph.list_of_graphcanvas;\n\n      for (var i = 0; i < list.length; ++i) {\n          var c = list[i];\n          //releasing somebody elses capture?!\n          if (!v && c.node_capturing_input != this) {\n              continue;\n          }\n\n          //change\n          c.node_capturing_input = v ? this : null;\n      }\n  };\n\n  /**\n   * Collapse the node to make it smaller on the canvas\n   * @method collapse\n   **/\n  LGraphNode.prototype.collapse = function(force) {\n      this.graph._version++;\n      if (this.constructor.collapsable === false && !force) {\n          return;\n      }\n      if (!this.flags.collapsed) {\n          this.flags.collapsed = true;\n      } else {\n          this.flags.collapsed = false;\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * Forces the node to do not move or realign on Z\n   * @method pin\n   **/\n\n  LGraphNode.prototype.pin = function(v) {\n      this.graph._version++;\n      if (v === undefined) {\n          this.flags.pinned = !this.flags.pinned;\n      } else {\n          this.flags.pinned = v;\n      }\n  };\n\n  LGraphNode.prototype.localToScreen = function(x, y, graphcanvas) {\n      return [\n          (x + this.pos[0]) * graphcanvas.scale + graphcanvas.offset[0],\n          (y + this.pos[1]) * graphcanvas.scale + graphcanvas.offset[1]\n      ];\n  };\n\n  function LGraphGroup(title) {\n      this._ctor(title);\n  }\n\n  global.LGraphGroup = LiteGraph.LGraphGroup = LGraphGroup;\n\n  LGraphGroup.prototype._ctor = function(title) {\n      this.title = title || \"Group\";\n      this.font_size = 24;\n      this.color = LGraphCanvas.node_colors.pale_blue\n          ? LGraphCanvas.node_colors.pale_blue.groupcolor\n          : \"#AAA\";\n      this._bounding = new Float32Array([10, 10, 140, 80]);\n      this._pos = this._bounding.subarray(0, 2);\n      this._size = this._bounding.subarray(2, 4);\n      this._nodes = [];\n      this.graph = null;\n\n      Object.defineProperty(this, \"pos\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._pos[0] = v[0];\n              this._pos[1] = v[1];\n          },\n          get: function() {\n              return this._pos;\n          },\n          enumerable: true\n      });\n\n      Object.defineProperty(this, \"size\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._size[0] = Math.max(140, v[0]);\n              this._size[1] = Math.max(80, v[1]);\n          },\n          get: function() {\n              return this._size;\n          },\n          enumerable: true\n      });\n  };\n\n  LGraphGroup.prototype.configure = function(o) {\n      this.title = o.title;\n      this._bounding.set(o.bounding);\n      this.color = o.color;\n      this.font = o.font;\n  };\n\n  LGraphGroup.prototype.serialize = function() {\n      var b = this._bounding;\n      return {\n          title: this.title,\n          bounding: [\n              Math.round(b[0]),\n              Math.round(b[1]),\n              Math.round(b[2]),\n              Math.round(b[3])\n          ],\n          color: this.color,\n          font: this.font\n      };\n  };\n\n  LGraphGroup.prototype.move = function(deltax, deltay, ignore_nodes) {\n      this._pos[0] += deltax;\n      this._pos[1] += deltay;\n      if (ignore_nodes) {\n          return;\n      }\n      for (var i = 0; i < this._nodes.length; ++i) {\n          var node = this._nodes[i];\n          node.pos[0] += deltax;\n          node.pos[1] += deltay;\n      }\n  };\n\n  LGraphGroup.prototype.recomputeInsideNodes = function() {\n      this._nodes.length = 0;\n      var nodes = this.graph._nodes;\n      var node_bounding = new Float32Array(4);\n\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          node.getBounding(node_bounding);\n          if (!overlapBounding(this._bounding, node_bounding)) {\n              continue;\n          } //out of the visible area\n          this._nodes.push(node);\n      }\n  };\n\n  LGraphGroup.prototype.isPointInside = LGraphNode.prototype.isPointInside;\n  LGraphGroup.prototype.setDirtyCanvas = LGraphNode.prototype.setDirtyCanvas;\n\n  //****************************************\n\n  //Scale and Offset\n  function DragAndScale(element, skip_events) {\n      this.offset = new Float32Array([0, 0]);\n      this.scale = 1;\n      this.max_scale = 10;\n      this.min_scale = 0.1;\n      this.onredraw = null;\n      this.enabled = true;\n      this.last_mouse = [0, 0];\n      this.element = null;\n      this.visible_area = new Float32Array(4);\n\n      if (element) {\n          this.element = element;\n          if (!skip_events) {\n              this.bindEvents(element);\n          }\n      }\n  }\n\n  LiteGraph.DragAndScale = DragAndScale;\n\n  DragAndScale.prototype.bindEvents = function(element) {\n      this.last_mouse = new Float32Array(2);\n\n      this._binded_mouse_callback = this.onMouse.bind(this);\n\n      element.addEventListener(\"mousedown\", this._binded_mouse_callback);\n      element.addEventListener(\"mousemove\", this._binded_mouse_callback);\n\n      element.addEventListener(\n          \"mousewheel\",\n          this._binded_mouse_callback,\n          false\n      );\n      element.addEventListener(\"wheel\", this._binded_mouse_callback, false);\n  };\n\n  DragAndScale.prototype.computeVisibleArea = function() {\n      if (!this.element) {\n          this.visible_area[0] = this.visible_area[1] = this.visible_area[2] = this.visible_area[3] = 0;\n          return;\n      }\n      var width = this.element.width;\n      var height = this.element.height;\n      var startx = -this.offset[0];\n      var starty = -this.offset[1];\n      var endx = startx + width / this.scale;\n      var endy = starty + height / this.scale;\n      this.visible_area[0] = startx;\n      this.visible_area[1] = starty;\n      this.visible_area[2] = endx - startx;\n      this.visible_area[3] = endy - starty;\n  };\n\n  DragAndScale.prototype.onMouse = function(e) {\n      if (!this.enabled) {\n          return;\n      }\n\n      var canvas = this.element;\n      var rect = canvas.getBoundingClientRect();\n      var x = e.clientX - rect.left;\n      var y = e.clientY - rect.top;\n      e.canvasx = x;\n      e.canvasy = y;\n      e.dragging = this.dragging;\n\n      var ignore = false;\n      if (this.onmouse) {\n          ignore = this.onmouse(e);\n      }\n\n      if (e.type == \"mousedown\") {\n          this.dragging = true;\n          canvas.removeEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.addEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.addEventListener(\n              \"mouseup\",\n              this._binded_mouse_callback\n          );\n      } else if (e.type == \"mousemove\") {\n          if (!ignore) {\n              var deltax = x - this.last_mouse[0];\n              var deltay = y - this.last_mouse[1];\n              if (this.dragging) {\n                  this.mouseDrag(deltax, deltay);\n              }\n          }\n      } else if (e.type == \"mouseup\") {\n          this.dragging = false;\n          document.body.removeEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.removeEventListener(\n              \"mouseup\",\n              this._binded_mouse_callback\n          );\n          canvas.addEventListener(\"mousemove\", this._binded_mouse_callback);\n      } else if (\n          e.type == \"mousewheel\" ||\n          e.type == \"wheel\" ||\n          e.type == \"DOMMouseScroll\"\n      ) {\n          e.eventType = \"mousewheel\";\n          if (e.type == \"wheel\") {\n              e.wheel = -e.deltaY;\n          } else {\n              e.wheel =\n                  e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n          }\n\n          //from stack overflow\n          e.delta = e.wheelDelta\n              ? e.wheelDelta / 40\n              : e.deltaY\n              ? -e.deltaY / 3\n              : 0;\n          this.changeDeltaScale(1.0 + e.delta * 0.05);\n      }\n\n      this.last_mouse[0] = x;\n      this.last_mouse[1] = y;\n\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n  };\n\n  DragAndScale.prototype.toCanvasContext = function(ctx) {\n      ctx.scale(this.scale, this.scale);\n      ctx.translate(this.offset[0], this.offset[1]);\n  };\n\n  DragAndScale.prototype.convertOffsetToCanvas = function(pos) {\n      //return [pos[0] / this.scale - this.offset[0], pos[1] / this.scale - this.offset[1]];\n      return [\n          (pos[0] + this.offset[0]) * this.scale,\n          (pos[1] + this.offset[1]) * this.scale\n      ];\n  };\n\n  DragAndScale.prototype.convertCanvasToOffset = function(pos, out) {\n      out = out || [0, 0];\n      out[0] = pos[0] / this.scale - this.offset[0];\n      out[1] = pos[1] / this.scale - this.offset[1];\n      return out;\n  };\n\n  DragAndScale.prototype.mouseDrag = function(x, y) {\n      this.offset[0] += x / this.scale;\n      this.offset[1] += y / this.scale;\n\n      if (this.onredraw) {\n          this.onredraw(this);\n      }\n  };\n\n  DragAndScale.prototype.changeScale = function(value, zooming_center) {\n      if (value < this.min_scale) {\n          value = this.min_scale;\n      } else if (value > this.max_scale) {\n          value = this.max_scale;\n      }\n\n      if (value == this.scale) {\n          return;\n      }\n\n      if (!this.element) {\n          return;\n      }\n\n      var rect = this.element.getBoundingClientRect();\n      if (!rect) {\n          return;\n      }\n\n      zooming_center = zooming_center || [\n          rect.width * 0.5,\n          rect.height * 0.5\n      ];\n      var center = this.convertCanvasToOffset(zooming_center);\n      this.scale = value;\n      if (Math.abs(this.scale - 1) < 0.01) {\n          this.scale = 1;\n      }\n\n      var new_center = this.convertCanvasToOffset(zooming_center);\n      var delta_offset = [\n          new_center[0] - center[0],\n          new_center[1] - center[1]\n      ];\n\n      this.offset[0] += delta_offset[0];\n      this.offset[1] += delta_offset[1];\n\n      if (this.onredraw) {\n          this.onredraw(this);\n      }\n  };\n\n  DragAndScale.prototype.changeDeltaScale = function(value, zooming_center) {\n      this.changeScale(this.scale * value, zooming_center);\n  };\n\n  DragAndScale.prototype.reset = function() {\n      this.scale = 1;\n      this.offset[0] = 0;\n      this.offset[1] = 0;\n  };\n\n  //*********************************************************************************\n  // LGraphCanvas: LGraph renderer CLASS\n  //*********************************************************************************\n\n  /**\n   * This class is in charge of rendering one graph inside a canvas. And provides all the interaction required.\n   * Valid callbacks are: onNodeSelected, onNodeDeselected, onShowNodePanel, onNodeDblClicked\n   *\n   * @class LGraphCanvas\n   * @constructor\n   * @param {HTMLCanvas} canvas the canvas where you want to render (it accepts a selector in string format or the canvas element itself)\n   * @param {LGraph} graph [optional]\n   * @param {Object} options [optional] { skip_rendering, autoresize }\n   */\n  function LGraphCanvas(canvas, graph, options) {\n      options = options || {};\n\n      //if(graph === undefined)\n      //\tthrow (\"No graph assigned\");\n      this.background_image =\n          \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=\";\n\n      if (canvas && canvas.constructor === String) {\n          canvas = document.querySelector(canvas);\n      }\n\n      this.ds = new DragAndScale();\n      this.zoom_modify_alpha = true; //otherwise it generates ugly patterns when scaling down too much\n\n      this.title_text_font = \"\" + LiteGraph.NODE_TEXT_SIZE + \"px Arial\";\n      this.inner_text_font =\n          \"normal \" + LiteGraph.NODE_SUBTEXT_SIZE + \"px Arial\";\n      this.node_title_color = LiteGraph.NODE_TITLE_COLOR;\n      this.default_link_color = LiteGraph.LINK_COLOR;\n      this.default_connection_color = {\n          input_off: \"#778\",\n          input_on: \"#7F7\",\n          output_off: \"#778\",\n          output_on: \"#7F7\"\n      };\n\n      this.highquality_render = true;\n      this.use_gradients = false; //set to true to render titlebar with gradients\n      this.editor_alpha = 1; //used for transition\n      this.pause_rendering = false;\n      this.clear_background = true;\n\n  this.read_only = false; //if set to true users cannot modify the graph\n      this.render_only_selected = true;\n      this.live_mode = false;\n      this.show_info = true;\n      this.allow_dragcanvas = true;\n      this.allow_dragnodes = true;\n      this.allow_interaction = true; //allow to control widgets, buttons, collapse, etc\n      this.allow_searchbox = true;\n      this.allow_reconnect_links = false; //allows to change a connection with having to redo it again\n\n      this.drag_mode = false;\n      this.dragging_rectangle = null;\n\n      this.filter = null; //allows to filter to only accept some type of nodes in a graph\n\n      this.always_render_background = false;\n      this.render_shadows = true;\n      this.render_canvas_border = true;\n      this.render_connections_shadows = false; //too much cpu\n      this.render_connections_border = true;\n      this.render_curved_connections = false;\n      this.render_connection_arrows = false;\n      this.render_collapsed_slots = true;\n      this.render_execution_order = false;\n      this.render_title_colored = true;\n  this.render_link_tooltip = true;\n\n      this.links_render_mode = LiteGraph.SPLINE_LINK;\n\n      this.canvas_mouse = [0, 0]; //mouse in canvas graph coordinates, where 0,0 is the top-left corner of the blue rectangle\n\n      //to personalize the search box\n      this.onSearchBox = null;\n      this.onSearchBoxSelection = null;\n\n      //callbacks\n      this.onMouse = null;\n      this.onDrawBackground = null; //to render background objects (behind nodes and connections) in the canvas affected by transform\n      this.onDrawForeground = null; //to render foreground objects (above nodes and connections) in the canvas affected by transform\n      this.onDrawOverlay = null; //to render foreground objects not affected by transform (for GUIs)\n  this.onDrawLinkTooltip = null; //called when rendering a tooltip\n  this.onNodeMoved = null; //called after moving a node\n  this.onSelectionChange = null; //called if the selection changes\n\n      this.connections_width = 3;\n      this.round_radius = 8;\n\n      this.current_node = null;\n      this.node_widget = null; //used for widgets\n  this.over_link_center = null;\n      this.last_mouse_position = [0, 0];\n      this.visible_area = this.ds.visible_area;\n      this.visible_links = [];\n\n      //link canvas and graph\n      if (graph) {\n          graph.attachCanvas(this);\n      }\n\n      this.setCanvas(canvas);\n      this.clear();\n\n      if (!options.skip_render) {\n          this.startRendering();\n      }\n\n      this.autoresize = options.autoresize;\n  }\n\n  global.LGraphCanvas = LiteGraph.LGraphCanvas = LGraphCanvas;\n\n  LGraphCanvas.link_type_colors = {\n      \"-1\": LiteGraph.EVENT_LINK_COLOR,\n      number: \"#AAA\",\n      node: \"#DCA\"\n  };\n  LGraphCanvas.gradients = {}; //cache of gradients\n\n  /**\n   * clears all the data inside\n   *\n   * @method clear\n   */\n  LGraphCanvas.prototype.clear = function() {\n      this.frame = 0;\n      this.last_draw_time = 0;\n      this.render_time = 0;\n      this.fps = 0;\n\n      //this.scale = 1;\n      //this.offset = [0,0];\n\n      this.dragging_rectangle = null;\n\n      this.selected_nodes = {};\n      this.selected_group = null;\n\n      this.visible_nodes = [];\n      this.node_dragged = null;\n      this.node_over = null;\n      this.node_capturing_input = null;\n      this.connecting_node = null;\n      this.highlighted_links = {};\n\n      this.dirty_canvas = true;\n      this.dirty_bgcanvas = true;\n      this.dirty_area = null;\n\n      this.node_in_panel = null;\n      this.node_widget = null;\n\n      this.last_mouse = [0, 0];\n      this.last_mouseclick = 0;\n      this.visible_area.set([0, 0, 0, 0]);\n\n      if (this.onClear) {\n          this.onClear();\n      }\n  };\n\n  /**\n   * assigns a graph, you can reassign graphs to the same canvas\n   *\n   * @method setGraph\n   * @param {LGraph} graph\n   */\n  LGraphCanvas.prototype.setGraph = function(graph, skip_clear) {\n      if (this.graph == graph) {\n          return;\n      }\n\n      if (!skip_clear) {\n          this.clear();\n      }\n\n      if (!graph && this.graph) {\n          this.graph.detachCanvas(this);\n          return;\n      }\n\n      /*\nif(this.graph)\n  this.graph.canvas = null; //remove old graph link to the canvas\nthis.graph = graph;\nif(this.graph)\n  this.graph.canvas = this;\n*/\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n  };\n\n  /**\n   * opens a graph contained inside a node in the current graph\n   *\n   * @method openSubgraph\n   * @param {LGraph} graph\n   */\n  LGraphCanvas.prototype.openSubgraph = function(graph) {\n      if (!graph) {\n          throw \"graph cannot be null\";\n      }\n\n      if (this.graph == graph) {\n          throw \"graph cannot be the same\";\n      }\n\n      this.clear();\n\n      if (this.graph) {\n          if (!this._graph_stack) {\n              this._graph_stack = [];\n          }\n          this._graph_stack.push(this.graph);\n      }\n\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n  };\n\n  /**\n   * closes a subgraph contained inside a node\n   *\n   * @method closeSubgraph\n   * @param {LGraph} assigns a graph\n   */\n  LGraphCanvas.prototype.closeSubgraph = function() {\n      if (!this._graph_stack || this._graph_stack.length == 0) {\n          return;\n      }\n      var subgraph_node = this.graph._subgraph_node;\n      var graph = this._graph_stack.pop();\n      this.selected_nodes = {};\n      this.highlighted_links = {};\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n      if (subgraph_node) {\n          this.centerOnNode(subgraph_node);\n          this.selectNodes([subgraph_node]);\n      }\n  };\n\n  /**\n   * returns the visualy active graph (in case there are more in the stack)\n   * @method getCurrentGraph\n   * @return {LGraph} the active graph\n   */\n  LGraphCanvas.prototype.getCurrentGraph = function() {\n      return this.graph;\n  };\n\n  /**\n   * assigns a canvas\n   *\n   * @method setCanvas\n   * @param {Canvas} assigns a canvas (also accepts the ID of the element (not a selector)\n   */\n  LGraphCanvas.prototype.setCanvas = function(canvas, skip_events) {\n      var that = this;\n\n      if (canvas) {\n          if (canvas.constructor === String) {\n              canvas = document.getElementById(canvas);\n              if (!canvas) {\n                  throw \"Error creating LiteGraph canvas: Canvas not found\";\n              }\n          }\n      }\n\n      if (canvas === this.canvas) {\n          return;\n      }\n\n      if (!canvas && this.canvas) {\n          //maybe detach events from old_canvas\n          if (!skip_events) {\n              this.unbindEvents();\n          }\n      }\n\n      this.canvas = canvas;\n      this.ds.element = canvas;\n\n      if (!canvas) {\n          return;\n      }\n\n      //this.canvas.tabindex = \"1000\";\n      canvas.className += \" lgraphcanvas\";\n      canvas.data = this;\n      canvas.tabindex = \"1\"; //to allow key events\n\n      //bg canvas: used for non changing stuff\n      this.bgcanvas = null;\n      if (!this.bgcanvas) {\n          this.bgcanvas = document.createElement(\"canvas\");\n          this.bgcanvas.width = this.canvas.width;\n          this.bgcanvas.height = this.canvas.height;\n      }\n\n      if (canvas.getContext == null) {\n          if (canvas.localName != \"canvas\") {\n              throw \"Element supplied for LGraphCanvas must be a <canvas> element, you passed a \" +\n                  canvas.localName;\n          }\n          throw \"This browser doesn't support Canvas\";\n      }\n\n      var ctx = (this.ctx = canvas.getContext(\"2d\"));\n      if (ctx == null) {\n          if (!canvas.webgl_enabled) {\n              console.warn(\n                  \"This canvas seems to be WebGL, enabling WebGL renderer\"\n              );\n          }\n          this.enableWebGL();\n      }\n\n      //input:  (move and up could be unbinded)\n      this._mousemove_callback = this.processMouseMove.bind(this);\n      this._mouseup_callback = this.processMouseUp.bind(this);\n\n      if (!skip_events) {\n          this.bindEvents();\n      }\n  };\n\n  //used in some events to capture them\n  LGraphCanvas.prototype._doNothing = function doNothing(e) {\n      e.preventDefault();\n      return false;\n  };\n  LGraphCanvas.prototype._doReturnTrue = function doNothing(e) {\n      e.preventDefault();\n      return true;\n  };\n\n  /**\n   * binds mouse, keyboard, touch and drag events to the canvas\n   * @method bindEvents\n   **/\n  LGraphCanvas.prototype.bindEvents = function() {\n      if (this._events_binded) {\n          console.warn(\"LGraphCanvas: events already binded\");\n          return;\n      }\n\n      var canvas = this.canvas;\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document; //hack used when moving canvas between windows\n\n      this._mousedown_callback = this.processMouseDown.bind(this);\n      this._mousewheel_callback = this.processMouseWheel.bind(this);\n\n      canvas.addEventListener(\"mousedown\", this._mousedown_callback, true); //down do not need to store the binded\n      canvas.addEventListener(\"mousemove\", this._mousemove_callback);\n      canvas.addEventListener(\"mousewheel\", this._mousewheel_callback, false);\n\n      canvas.addEventListener(\"contextmenu\", this._doNothing);\n      canvas.addEventListener(\n          \"DOMMouseScroll\",\n          this._mousewheel_callback,\n          false\n      );\n\n      //touch events\n      //if( 'touchstart' in document.documentElement )\n      {\n          this.touchHandler = this.touchHandler.bind(this);\n          canvas.addEventListener(\"touchstart\", this.touchHandler, true);\n          canvas.addEventListener(\"touchmove\", this.touchHandler, true);\n          canvas.addEventListener(\"touchend\", this.touchHandler, true);\n          canvas.addEventListener(\"touchcancel\", this.touchHandler, true);\n      }\n\n      //Keyboard ******************\n      this._key_callback = this.processKey.bind(this);\n\n      canvas.addEventListener(\"keydown\", this._key_callback, true);\n      document.addEventListener(\"keyup\", this._key_callback, true); //in document, otherwise it doesn't fire keyup\n\n      //Dropping Stuff over nodes ************************************\n      this._ondrop_callback = this.processDrop.bind(this);\n\n      canvas.addEventListener(\"dragover\", this._doNothing, false);\n      canvas.addEventListener(\"dragend\", this._doNothing, false);\n      canvas.addEventListener(\"drop\", this._ondrop_callback, false);\n      canvas.addEventListener(\"dragenter\", this._doReturnTrue, false);\n\n      this._events_binded = true;\n  };\n\n  /**\n   * unbinds mouse events from the canvas\n   * @method unbindEvents\n   **/\n  LGraphCanvas.prototype.unbindEvents = function() {\n      if (!this._events_binded) {\n          console.warn(\"LGraphCanvas: no events binded\");\n          return;\n      }\n\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document;\n\n      this.canvas.removeEventListener(\"mousedown\", this._mousedown_callback);\n      this.canvas.removeEventListener(\n          \"mousewheel\",\n          this._mousewheel_callback\n      );\n      this.canvas.removeEventListener(\n          \"DOMMouseScroll\",\n          this._mousewheel_callback\n      );\n      this.canvas.removeEventListener(\"keydown\", this._key_callback);\n      document.removeEventListener(\"keyup\", this._key_callback);\n      this.canvas.removeEventListener(\"contextmenu\", this._doNothing);\n      this.canvas.removeEventListener(\"drop\", this._ondrop_callback);\n      this.canvas.removeEventListener(\"dragenter\", this._doReturnTrue);\n\n      this.canvas.removeEventListener(\"touchstart\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchmove\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchend\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchcancel\", this.touchHandler);\n\n      this._mousedown_callback = null;\n      this._mousewheel_callback = null;\n      this._key_callback = null;\n      this._ondrop_callback = null;\n\n      this._events_binded = false;\n  };\n\n  LGraphCanvas.getFileExtension = function(url) {\n      var question = url.indexOf(\"?\");\n      if (question != -1) {\n          url = url.substr(0, question);\n      }\n      var point = url.lastIndexOf(\".\");\n      if (point == -1) {\n          return \"\";\n      }\n      return url.substr(point + 1).toLowerCase();\n  };\n\n  /**\n   * this function allows to render the canvas using WebGL instead of Canvas2D\n   * this is useful if you plant to render 3D objects inside your nodes, it uses litegl.js for webgl and canvas2DtoWebGL to emulate the Canvas2D calls in webGL\n   * @method enableWebGL\n   **/\n  LGraphCanvas.prototype.enableWebGL = function() {\n      if (typeof GL === undefined) {\n          throw \"litegl.js must be included to use a WebGL canvas\";\n      }\n      if (typeof enableWebGLCanvas === undefined) {\n          throw \"webglCanvas.js must be included to use this feature\";\n      }\n\n      this.gl = this.ctx = enableWebGLCanvas(this.canvas);\n      this.ctx.webgl = true;\n      this.bgcanvas = this.canvas;\n      this.bgctx = this.gl;\n      this.canvas.webgl_enabled = true;\n\n      /*\nGL.create({ canvas: this.bgcanvas });\nthis.bgctx = enableWebGLCanvas( this.bgcanvas );\nwindow.gl = this.gl;\n*/\n  };\n\n  /**\n   * marks as dirty the canvas, this way it will be rendered again\n   *\n   * @class LGraphCanvas\n   * @method setDirty\n   * @param {bool} fgcanvas if the foreground canvas is dirty (the one containing the nodes)\n   * @param {bool} bgcanvas if the background canvas is dirty (the one containing the wires)\n   */\n  LGraphCanvas.prototype.setDirty = function(fgcanvas, bgcanvas) {\n      if (fgcanvas) {\n          this.dirty_canvas = true;\n      }\n      if (bgcanvas) {\n          this.dirty_bgcanvas = true;\n      }\n  };\n\n  /**\n   * Used to attach the canvas in a popup\n   *\n   * @method getCanvasWindow\n   * @return {window} returns the window where the canvas is attached (the DOM root node)\n   */\n  LGraphCanvas.prototype.getCanvasWindow = function() {\n      if (!this.canvas) {\n          return window;\n      }\n      var doc = this.canvas.ownerDocument;\n      return doc.defaultView || doc.parentWindow;\n  };\n\n  /**\n   * starts rendering the content of the canvas when needed\n   *\n   * @method startRendering\n   */\n  LGraphCanvas.prototype.startRendering = function() {\n      if (this.is_rendering) {\n          return;\n      } //already rendering\n\n      this.is_rendering = true;\n      renderFrame.call(this);\n\n      function renderFrame() {\n          if (!this.pause_rendering) {\n              this.draw();\n          }\n\n          var window = this.getCanvasWindow();\n          if (this.is_rendering) {\n              window.requestAnimationFrame(renderFrame.bind(this));\n          }\n      }\n  };\n\n  /**\n   * stops rendering the content of the canvas (to save resources)\n   *\n   * @method stopRendering\n   */\n  LGraphCanvas.prototype.stopRendering = function() {\n      this.is_rendering = false;\n      /*\nif(this.rendering_timer_id)\n{\n  clearInterval(this.rendering_timer_id);\n  this.rendering_timer_id = null;\n}\n*/\n  };\n\n  /* LiteGraphCanvas input */\n\n  LGraphCanvas.prototype.processMouseDown = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      this.adjustMouseEvent(e);\n\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document;\n      LGraphCanvas.active_canvas = this;\n      var that = this;\n\n      //move mouse move event to the window in case it drags outside of the canvas\n      this.canvas.removeEventListener(\"mousemove\", this._mousemove_callback);\n      ref_window.document.addEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      ); //catch for the entire window\n      ref_window.document.addEventListener(\n          \"mouseup\",\n          this._mouseup_callback,\n          true\n      );\n\n      var node = this.graph.getNodeOnPos(\n          e.canvasX,\n          e.canvasY,\n          this.visible_nodes,\n          5\n      );\n      var skip_dragging = false;\n      var skip_action = false;\n      var now = LiteGraph.getTime();\n      var is_double_click = now - this.last_mouseclick < 300;\n\n      this.canvas_mouse[0] = e.canvasX;\n      this.canvas_mouse[1] = e.canvasY;\n      this.canvas.focus();\n\n      LiteGraph.closeAllContextMenus(ref_window);\n\n      if (this.onMouse) {\n          if (this.onMouse(e) == true) {\n              return;\n          }\n      }\n\n      if (e.which == 1) {\n          //left button mouse\n          if (e.ctrlKey) {\n              this.dragging_rectangle = new Float32Array(4);\n              this.dragging_rectangle[0] = e.canvasX;\n              this.dragging_rectangle[1] = e.canvasY;\n              this.dragging_rectangle[2] = 1;\n              this.dragging_rectangle[3] = 1;\n              skip_action = true;\n          }\n\n          var clicking_canvas_bg = false;\n\n          //when clicked on top of a node\n          //and it is not interactive\n          if (node && this.allow_interaction && !skip_action && !this.read_only) {\n              if (!this.live_mode && !node.flags.pinned) {\n                  this.bringToFront(node);\n              } //if it wasn't selected?\n\n              //not dragging mouse to connect two slots\n              if (\n                  !this.connecting_node &&\n                  !node.flags.collapsed &&\n                  !this.live_mode\n              ) {\n                  //Search for corner for resize\n                  if (\n                      !skip_action &&\n                      node.resizable !== false &&\n                      isInsideRectangle(\n                          e.canvasX,\n                          e.canvasY,\n                          node.pos[0] + node.size[0] - 5,\n                          node.pos[1] + node.size[1] - 5,\n                          10,\n                          10\n                      )\n                  ) {\n                      this.resizing_node = node;\n                      this.canvas.style.cursor = \"se-resize\";\n                      skip_action = true;\n                  } else {\n                      //search for outputs\n                      if (node.outputs) {\n                          for (\n                              var i = 0, l = node.outputs.length;\n                              i < l;\n                              ++i\n                          ) {\n                              var output = node.outputs[i];\n                              var link_pos = node.getConnectionPos(false, i);\n                              if (\n                                  isInsideRectangle(\n                                      e.canvasX,\n                                      e.canvasY,\n                                      link_pos[0] - 15,\n                                      link_pos[1] - 10,\n                                      30,\n                                      20\n                                  )\n                              ) {\n                                  this.connecting_node = node;\n                                  this.connecting_output = output;\n                                  this.connecting_pos = node.getConnectionPos( false, i );\n                                  this.connecting_slot = i;\n\n                                  if (e.shiftKey) {\n                                      node.disconnectOutput(i);\n                                  }\n\n                                  if (is_double_click) {\n                                      if (node.onOutputDblClick) {\n                                          node.onOutputDblClick(i, e);\n                                      }\n                                  } else {\n                                      if (node.onOutputClick) {\n                                          node.onOutputClick(i, e);\n                                      }\n                                  }\n\n                                  skip_action = true;\n                                  break;\n                              }\n                          }\n                      }\n\n                      //search for inputs\n                      if (node.inputs) {\n                          for (\n                              var i = 0, l = node.inputs.length;\n                              i < l;\n                              ++i\n                          ) {\n                              var input = node.inputs[i];\n                              var link_pos = node.getConnectionPos(true, i);\n                              if (\n                                  isInsideRectangle(\n                                      e.canvasX,\n                                      e.canvasY,\n                                      link_pos[0] - 15,\n                                      link_pos[1] - 10,\n                                      30,\n                                      20\n                                  )\n                              ) {\n                                  if (is_double_click) {\n                                      if (node.onInputDblClick) {\n                                          node.onInputDblClick(i, e);\n                                      }\n                                  } else {\n                                      if (node.onInputClick) {\n                                          node.onInputClick(i, e);\n                                      }\n                                  }\n\n                                  if (input.link !== null) {\n                                      var link_info = this.graph.links[\n                                          input.link\n                                      ]; //before disconnecting\n                                      node.disconnectInput(i);\n\n                                      if (\n                                          this.allow_reconnect_links ||\n                                          e.shiftKey\n                                      ) {\n                                          this.connecting_node = this.graph._nodes_by_id[\n                                              link_info.origin_id\n                                          ];\n                                          this.connecting_slot =\n                                              link_info.origin_slot;\n                                          this.connecting_output = this.connecting_node.outputs[\n                                              this.connecting_slot\n                                          ];\n                                          this.connecting_pos = this.connecting_node.getConnectionPos( false, this.connecting_slot );\n                                      }\n\n                                      this.dirty_bgcanvas = true;\n                                      skip_action = true;\n                                  }\n                              }\n                          }\n                      }\n                  } //not resizing\n              }\n\n              //Search for corner for collapsing\n              /*\n      if( !skip_action && isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT ))\n      {\n        node.collapse();\n        skip_action = true;\n      }\n      */\n\n              //it wasn't clicked on the links boxes\n              if (!skip_action) {\n                  var block_drag_node = false;\n\n                  //widgets\n                  var widget = this.processNodeWidgets( node, this.canvas_mouse, e );\n                  if (widget) {\n                      block_drag_node = true;\n                      this.node_widget = [node, widget];\n                  }\n\n                  //double clicking\n                  if (is_double_click && this.selected_nodes[node.id]) {\n                      //double click node\n                      if (node.onDblClick) {\n                          node.onDblClick( e, [ e.canvasX - node.pos[0], e.canvasY - node.pos[1] ], this );\n                      }\n                      this.processNodeDblClicked(node);\n                      block_drag_node = true;\n                  }\n\n                  //if do not capture mouse\n                  if ( node.onMouseDown && node.onMouseDown( e, [e.canvasX - node.pos[0], e.canvasY - node.pos[1]], this ) ) {\n                      block_drag_node = true;\n                  } else if (this.live_mode) {\n                      clicking_canvas_bg = true;\n                      block_drag_node = true;\n                  }\n\n                  if (!block_drag_node) {\n                      if (this.allow_dragnodes) {\n                          this.node_dragged = node;\n                      }\n                      if (!this.selected_nodes[node.id]) {\n                          this.processNodeSelected(node, e);\n                      }\n                  }\n\n                  this.dirty_canvas = true;\n              }\n          } //clicked outside of nodes\n          else {\n              //search for link connector\n      if(!this.read_only) \n        for (var i = 0; i < this.visible_links.length; ++i) {\n          var link = this.visible_links[i];\n          var center = link._pos;\n          if (\n            !center ||\n            e.canvasX < center[0] - 4 ||\n            e.canvasX > center[0] + 4 ||\n            e.canvasY < center[1] - 4 ||\n            e.canvasY > center[1] + 4\n          ) {\n            continue;\n          }\n          //link clicked\n          this.showLinkMenu(link, e);\n          this.over_link_center = null; //clear tooltip\n          break;\n        }\n\n              this.selected_group = this.graph.getGroupOnPos( e.canvasX, e.canvasY );\n              this.selected_group_resizing = false;\n              if (this.selected_group && !this.read_only ) {\n                  if (e.ctrlKey) {\n                      this.dragging_rectangle = null;\n                  }\n\n                  var dist = distance( [e.canvasX, e.canvasY], [ this.selected_group.pos[0] + this.selected_group.size[0], this.selected_group.pos[1] + this.selected_group.size[1] ] );\n                  if (dist * this.ds.scale < 10) {\n                      this.selected_group_resizing = true;\n                  } else {\n                      this.selected_group.recomputeInsideNodes();\n                  }\n              }\n\n              if (is_double_click && !this.read_only && this.allow_searchbox) {\n                  this.showSearchBox(e);\n              }\n\n              clicking_canvas_bg = true;\n          }\n\n          if (!skip_action && clicking_canvas_bg && this.allow_dragcanvas) {\n              this.dragging_canvas = true;\n          }\n      } else if (e.which == 2) {\n          //middle button\n      } else if (e.which == 3) {\n          //right button\n    if(!this.read_only)\n            this.processContextMenu(node, e);\n      }\n\n      //TODO\n      //if(this.node_selected != prev_selected)\n      //\tthis.onNodeSelectionChange(this.node_selected);\n\n      this.last_mouse[0] = e.localX;\n      this.last_mouse[1] = e.localY;\n      this.last_mouseclick = LiteGraph.getTime();\n      this.last_mouse_dragging = true;\n\n      /*\nif( (this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n  this.draw();\n*/\n\n      this.graph.change();\n\n      //this is to ensure to defocus(blur) if a text input element is on focus\n      if (\n          !ref_window.document.activeElement ||\n          (ref_window.document.activeElement.nodeName.toLowerCase() !=\n              \"input\" &&\n              ref_window.document.activeElement.nodeName.toLowerCase() !=\n                  \"textarea\")\n      ) {\n          e.preventDefault();\n      }\n      e.stopPropagation();\n\n      if (this.onMouseDown) {\n          this.onMouseDown(e);\n      }\n\n      return false;\n  };\n\n  /**\n   * Called when a mouse move event has to be processed\n   * @method processMouseMove\n   **/\n  LGraphCanvas.prototype.processMouseMove = function(e) {\n      if (this.autoresize) {\n          this.resize();\n      }\n\n      if (!this.graph) {\n          return;\n      }\n\n      LGraphCanvas.active_canvas = this;\n      this.adjustMouseEvent(e);\n      var mouse = [e.localX, e.localY];\n      var delta = [\n          mouse[0] - this.last_mouse[0],\n          mouse[1] - this.last_mouse[1]\n      ];\n      this.last_mouse = mouse;\n      this.canvas_mouse[0] = e.canvasX;\n      this.canvas_mouse[1] = e.canvasY;\n      e.dragging = this.last_mouse_dragging;\n\n      if (this.node_widget) {\n          this.processNodeWidgets(\n              this.node_widget[0],\n              this.canvas_mouse,\n              e,\n              this.node_widget[1]\n          );\n          this.dirty_canvas = true;\n      }\n\n      if (this.dragging_rectangle) {\n          this.dragging_rectangle[2] = e.canvasX - this.dragging_rectangle[0];\n          this.dragging_rectangle[3] = e.canvasY - this.dragging_rectangle[1];\n          this.dirty_canvas = true;\n      } else if (this.selected_group && !this.read_only) {\n          //moving/resizing a group\n          if (this.selected_group_resizing) {\n              this.selected_group.size = [\n                  e.canvasX - this.selected_group.pos[0],\n                  e.canvasY - this.selected_group.pos[1]\n              ];\n          } else {\n              var deltax = delta[0] / this.ds.scale;\n              var deltay = delta[1] / this.ds.scale;\n              this.selected_group.move(deltax, deltay, e.ctrlKey);\n              if (this.selected_group._nodes.length) {\n                  this.dirty_canvas = true;\n              }\n          }\n          this.dirty_bgcanvas = true;\n      } else if (this.dragging_canvas) {\n          this.ds.offset[0] += delta[0] / this.ds.scale;\n          this.ds.offset[1] += delta[1] / this.ds.scale;\n          this.dirty_canvas = true;\n          this.dirty_bgcanvas = true;\n      } else if (this.allow_interaction && !this.read_only) {\n          if (this.connecting_node) {\n              this.dirty_canvas = true;\n          }\n\n          //get node over\n          var node = this.graph.getNodeOnPos(\n              e.canvasX,\n              e.canvasY,\n              this.visible_nodes\n          );\n\n          //remove mouseover flag\n          for (var i = 0, l = this.graph._nodes.length; i < l; ++i) {\n              if (\n                  this.graph._nodes[i].mouseOver &&\n                  node != this.graph._nodes[i]\n              ) {\n                  //mouse leave\n                  this.graph._nodes[i].mouseOver = false;\n                  if (this.node_over && this.node_over.onMouseLeave) {\n                      this.node_over.onMouseLeave(e);\n                  }\n                  this.node_over = null;\n                  this.dirty_canvas = true;\n              }\n          }\n\n          //mouse over a node\n          if (node) {\n              //this.canvas.style.cursor = \"move\";\n              if (!node.mouseOver) {\n                  //mouse enter\n                  node.mouseOver = true;\n                  this.node_over = node;\n                  this.dirty_canvas = true;\n\n                  if (node.onMouseEnter) {\n                      node.onMouseEnter(e);\n                  }\n              }\n\n              //in case the node wants to do something\n              if (node.onMouseMove) {\n                  node.onMouseMove(\n                      e,\n                      [e.canvasX - node.pos[0], e.canvasY - node.pos[1]],\n                      this\n                  );\n              }\n\n              //if dragging a link\n              if (this.connecting_node) {\n                  var pos = this._highlight_input || [0, 0]; //to store the output of isOverNodeInput\n\n                  //on top of input\n                  if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                      //mouse on top of the corner box, don't know what to do\n                  } else {\n                      //check if I have a slot below de mouse\n                      var slot = this.isOverNodeInput(\n                          node,\n                          e.canvasX,\n                          e.canvasY,\n                          pos\n                      );\n                      if (slot != -1 && node.inputs[slot]) {\n                          var slot_type = node.inputs[slot].type;\n                          if (\n                              LiteGraph.isValidConnection(\n                                  this.connecting_output.type,\n                                  slot_type\n                              )\n                          ) {\n                              this._highlight_input = pos;\n                          }\n                      } else {\n                          this._highlight_input = null;\n                      }\n                  }\n              }\n\n              //Search for corner\n              if (this.canvas) {\n                  if (\n                      isInsideRectangle(\n                          e.canvasX,\n                          e.canvasY,\n                          node.pos[0] + node.size[0] - 5,\n                          node.pos[1] + node.size[1] - 5,\n                          5,\n                          5\n                      )\n                  ) {\n                      this.canvas.style.cursor = \"se-resize\";\n                  } else {\n                      this.canvas.style.cursor = \"crosshair\";\n                  }\n              }\n          } else { //outside\n\n              //search for link connector\n      var over_link = null;\n      for (var i = 0; i < this.visible_links.length; ++i) {\n        var link = this.visible_links[i];\n        var center = link._pos;\n        if (\n          !center ||\n          e.canvasX < center[0] - 4 ||\n          e.canvasX > center[0] + 4 ||\n          e.canvasY < center[1] - 4 ||\n          e.canvasY > center[1] + 4\n        ) {\n          continue;\n        }\n        over_link = link;\n        break;\n      }\n      if( over_link != this.over_link_center )\n      {\n        this.over_link_center = over_link;\n                this.dirty_canvas = true;\n      }\n\n      if (this.canvas) {\n                this.canvas.style.cursor = \"\";\n      }\n    }\n\n          if ( this.node_capturing_input && this.node_capturing_input != node && this.node_capturing_input.onMouseMove ) {\n              this.node_capturing_input.onMouseMove(e,[e.canvasX - this.node_capturing_input.pos[0],e.canvasY - this.node_capturing_input.pos[1]], this);\n          }\n\n          if (this.node_dragged && !this.live_mode) {\n              for (var i in this.selected_nodes) {\n                  var n = this.selected_nodes[i];\n                  n.pos[0] += delta[0] / this.ds.scale;\n                  n.pos[1] += delta[1] / this.ds.scale;\n              }\n\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n          }\n\n          if (this.resizing_node && !this.live_mode) {\n              //convert mouse to node space\n              this.resizing_node.size[0] = e.canvasX - this.resizing_node.pos[0];\n              this.resizing_node.size[1] = e.canvasY - this.resizing_node.pos[1];\n\n              //constraint size\n              var max_slots = Math.max(\n                  this.resizing_node.inputs ? this.resizing_node.inputs.length : 0,\n                  this.resizing_node.outputs ? this.resizing_node.outputs.length : 0\n              );\n              var min_height =\n                  max_slots * LiteGraph.NODE_SLOT_HEIGHT +\n                  (this.resizing_node.widgets ? this.resizing_node.widgets.length : 0) * (LiteGraph.NODE_WIDGET_HEIGHT + 4) + 4;\n              if (this.resizing_node.size[1] < min_height) {\n                  this.resizing_node.size[1] = min_height;\n              }\n              if (this.resizing_node.size[0] < LiteGraph.NODE_MIN_WIDTH) {\n                  this.resizing_node.size[0] = LiteGraph.NODE_MIN_WIDTH;\n              }\n\n              this.canvas.style.cursor = \"se-resize\";\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n          }\n      }\n\n      e.preventDefault();\n      return false;\n  };\n\n  /**\n   * Called when a mouse up event has to be processed\n   * @method processMouseUp\n   **/\n  LGraphCanvas.prototype.processMouseUp = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      var window = this.getCanvasWindow();\n      var document = window.document;\n      LGraphCanvas.active_canvas = this;\n\n      //restore the mousemove event back to the canvas\n      document.removeEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      );\n      this.canvas.addEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      );\n      document.removeEventListener(\"mouseup\", this._mouseup_callback, true);\n\n      this.adjustMouseEvent(e);\n      var now = LiteGraph.getTime();\n      e.click_time = now - this.last_mouseclick;\n      this.last_mouse_dragging = false;\n\n      if (e.which == 1) {\n          //left button\n          this.node_widget = null;\n\n          if (this.selected_group) {\n              var diffx =\n                  this.selected_group.pos[0] -\n                  Math.round(this.selected_group.pos[0]);\n              var diffy =\n                  this.selected_group.pos[1] -\n                  Math.round(this.selected_group.pos[1]);\n              this.selected_group.move(diffx, diffy, e.ctrlKey);\n              this.selected_group.pos[0] = Math.round(\n                  this.selected_group.pos[0]\n              );\n              this.selected_group.pos[1] = Math.round(\n                  this.selected_group.pos[1]\n              );\n              if (this.selected_group._nodes.length) {\n                  this.dirty_canvas = true;\n              }\n              this.selected_group = null;\n          }\n          this.selected_group_resizing = false;\n\n          if (this.dragging_rectangle) {\n              if (this.graph) {\n                  var nodes = this.graph._nodes;\n                  var node_bounding = new Float32Array(4);\n                  this.deselectAllNodes();\n                  //compute bounding and flip if left to right\n                  var w = Math.abs(this.dragging_rectangle[2]);\n                  var h = Math.abs(this.dragging_rectangle[3]);\n                  var startx =\n                      this.dragging_rectangle[2] < 0\n                          ? this.dragging_rectangle[0] - w\n                          : this.dragging_rectangle[0];\n                  var starty =\n                      this.dragging_rectangle[3] < 0\n                          ? this.dragging_rectangle[1] - h\n                          : this.dragging_rectangle[1];\n                  this.dragging_rectangle[0] = startx;\n                  this.dragging_rectangle[1] = starty;\n                  this.dragging_rectangle[2] = w;\n                  this.dragging_rectangle[3] = h;\n\n                  //test against all nodes (not visible because the rectangle maybe start outside\n                  var to_select = [];\n                  for (var i = 0; i < nodes.length; ++i) {\n                      var node = nodes[i];\n                      node.getBounding(node_bounding);\n                      if (\n                          !overlapBounding(\n                              this.dragging_rectangle,\n                              node_bounding\n                          )\n                      ) {\n                          continue;\n                      } //out of the visible area\n                      to_select.push(node);\n                  }\n                  if (to_select.length) {\n                      this.selectNodes(to_select);\n                  }\n              }\n              this.dragging_rectangle = null;\n          } else if (this.connecting_node) {\n              //dragging a connection\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n\n              var node = this.graph.getNodeOnPos(\n                  e.canvasX,\n                  e.canvasY,\n                  this.visible_nodes\n              );\n\n              //node below mouse\n              if (node) {\n                  if (\n                      this.connecting_output.type == LiteGraph.EVENT &&\n                      this.isOverNodeBox(node, e.canvasX, e.canvasY)\n                  ) {\n                      this.connecting_node.connect(\n                          this.connecting_slot,\n                          node,\n                          LiteGraph.EVENT\n                      );\n                  } else {\n                      //slot below mouse? connect\n                      var slot = this.isOverNodeInput(\n                          node,\n                          e.canvasX,\n                          e.canvasY\n                      );\n                      if (slot != -1) {\n                          this.connecting_node.connect(\n                              this.connecting_slot,\n                              node,\n                              slot\n                          );\n                      } else {\n                          //not on top of an input\n                          var input = node.getInputInfo(0);\n                          //auto connect\n                          if (\n                              this.connecting_output.type == LiteGraph.EVENT\n                          ) {\n                              this.connecting_node.connect(\n                                  this.connecting_slot,\n                                  node,\n                                  LiteGraph.EVENT\n                              );\n                          } else if (\n                              input &&\n                              !input.link &&\n                              LiteGraph.isValidConnection(\n                                  input.type && this.connecting_output.type\n                              )\n                          ) {\n                              this.connecting_node.connect(\n                                  this.connecting_slot,\n                                  node,\n                                  0\n                              );\n                          }\n                      }\n                  }\n              }\n\n              this.connecting_output = null;\n              this.connecting_pos = null;\n              this.connecting_node = null;\n              this.connecting_slot = -1;\n          } //not dragging connection\n          else if (this.resizing_node) {\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n              this.resizing_node = null;\n          } else if (this.node_dragged) {\n              //node being dragged?\n              var node = this.node_dragged;\n              if (\n                  node &&\n                  e.click_time < 300 &&\n                  isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT )\n              ) {\n                  node.collapse();\n              }\n\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n              this.node_dragged.pos[0] = Math.round(this.node_dragged.pos[0]);\n              this.node_dragged.pos[1] = Math.round(this.node_dragged.pos[1]);\n              if (this.graph.config.align_to_grid) {\n                  this.node_dragged.alignToGrid();\n              }\n      if( this.onNodeMoved )\n        this.onNodeMoved( this.node_dragged );\n              this.node_dragged = null;\n          } //no node being dragged\n          else {\n              //get node over\n              var node = this.graph.getNodeOnPos(\n                  e.canvasX,\n                  e.canvasY,\n                  this.visible_nodes\n              );\n\n              if (!node && e.click_time < 300) {\n                  this.deselectAllNodes();\n              }\n\n              this.dirty_canvas = true;\n              this.dragging_canvas = false;\n\n              if (this.node_over && this.node_over.onMouseUp) {\n                  this.node_over.onMouseUp( e, [ e.canvasX - this.node_over.pos[0], e.canvasY - this.node_over.pos[1] ], this );\n              }\n              if (\n                  this.node_capturing_input &&\n                  this.node_capturing_input.onMouseUp\n              ) {\n                  this.node_capturing_input.onMouseUp(e, [\n                      e.canvasX - this.node_capturing_input.pos[0],\n                      e.canvasY - this.node_capturing_input.pos[1]\n                  ]);\n              }\n          }\n      } else if (e.which == 2) {\n          //middle button\n          //trace(\"middle\");\n          this.dirty_canvas = true;\n          this.dragging_canvas = false;\n      } else if (e.which == 3) {\n          //right button\n          //trace(\"right\");\n          this.dirty_canvas = true;\n          this.dragging_canvas = false;\n      }\n\n      /*\nif((this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n  this.draw();\n*/\n\n      this.graph.change();\n\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n  };\n\n  /**\n   * Called when a mouse wheel event has to be processed\n   * @method processMouseWheel\n   **/\n  LGraphCanvas.prototype.processMouseWheel = function(e) {\n      if (!this.graph || !this.allow_dragcanvas) {\n          return;\n      }\n\n      var delta = e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n\n      this.adjustMouseEvent(e);\n\n      var scale = this.ds.scale;\n\n      if (delta > 0) {\n          scale *= 1.1;\n      } else if (delta < 0) {\n          scale *= 1 / 1.1;\n      }\n\n      //this.setZoom( scale, [ e.localX, e.localY ] );\n      this.ds.changeScale(scale, [e.localX, e.localY]);\n\n      this.graph.change();\n\n      e.preventDefault();\n      return false; // prevent default\n  };\n\n  /**\n   * returns true if a position (in graph space) is on top of a node little corner box\n   * @method isOverNodeBox\n   **/\n  LGraphCanvas.prototype.isOverNodeBox = function(node, canvasx, canvasy) {\n      var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n      if (\n          isInsideRectangle(\n              canvasx,\n              canvasy,\n              node.pos[0] + 2,\n              node.pos[1] + 2 - title_height,\n              title_height - 4,\n              title_height - 4\n          )\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  /**\n   * returns true if a position (in graph space) is on top of a node input slot\n   * @method isOverNodeInput\n   **/\n  LGraphCanvas.prototype.isOverNodeInput = function(\n      node,\n      canvasx,\n      canvasy,\n      slot_pos\n  ) {\n      if (node.inputs) {\n          for (var i = 0, l = node.inputs.length; i < l; ++i) {\n              var input = node.inputs[i];\n              var link_pos = node.getConnectionPos(true, i);\n              var is_inside = false;\n              if (node.horizontal) {\n                  is_inside = isInsideRectangle(\n                      canvasx,\n                      canvasy,\n                      link_pos[0] - 5,\n                      link_pos[1] - 10,\n                      10,\n                      20\n                  );\n              } else {\n                  is_inside = isInsideRectangle(\n                      canvasx,\n                      canvasy,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      40,\n                      10\n                  );\n              }\n              if (is_inside) {\n                  if (slot_pos) {\n                      slot_pos[0] = link_pos[0];\n                      slot_pos[1] = link_pos[1];\n                  }\n                  return i;\n              }\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * process a key event\n   * @method processKey\n   **/\n  LGraphCanvas.prototype.processKey = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      var block_default = false;\n      //console.log(e); //debug\n\n      if (e.target.localName == \"input\") {\n          return;\n      }\n\n      if (e.type == \"keydown\") {\n          if (e.keyCode == 32) {\n              //esc\n              this.dragging_canvas = true;\n              block_default = true;\n          }\n\n          //select all Control A\n          if (e.keyCode == 65 && e.ctrlKey) {\n              this.selectNodes();\n              block_default = true;\n          }\n\n          if (e.code == \"KeyC\" && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n              //copy\n              if (this.selected_nodes) {\n                  this.copyToClipboard();\n                  block_default = true;\n              }\n          }\n\n          if (e.code == \"KeyV\" && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n              //paste\n              this.pasteFromClipboard();\n          }\n\n          //delete or backspace\n          if (e.keyCode == 46 || e.keyCode == 8) {\n              if (\n                  e.target.localName != \"input\" &&\n                  e.target.localName != \"textarea\"\n              ) {\n                  this.deleteSelectedNodes();\n                  block_default = true;\n              }\n          }\n\n          //collapse\n          //...\n\n          //TODO\n          if (this.selected_nodes) {\n              for (var i in this.selected_nodes) {\n                  if (this.selected_nodes[i].onKeyDown) {\n                      this.selected_nodes[i].onKeyDown(e);\n                  }\n              }\n          }\n      } else if (e.type == \"keyup\") {\n          if (e.keyCode == 32) {\n              this.dragging_canvas = false;\n          }\n\n          if (this.selected_nodes) {\n              for (var i in this.selected_nodes) {\n                  if (this.selected_nodes[i].onKeyUp) {\n                      this.selected_nodes[i].onKeyUp(e);\n                  }\n              }\n          }\n      }\n\n      this.graph.change();\n\n      if (block_default) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n          return false;\n      }\n  };\n\n  LGraphCanvas.prototype.copyToClipboard = function() {\n      var clipboard_info = {\n          nodes: [],\n          links: []\n      };\n      var index = 0;\n      var selected_nodes_array = [];\n      for (var i in this.selected_nodes) {\n          var node = this.selected_nodes[i];\n          node._relative_id = index;\n          selected_nodes_array.push(node);\n          index += 1;\n      }\n\n      for (var i = 0; i < selected_nodes_array.length; ++i) {\n          var node = selected_nodes_array[i];\n    var cloned = node.clone();\n    if(!cloned)\n    {\n      console.warn(\"node type not found: \" + node.type );\n      continue;\n    }\n          clipboard_info.nodes.push(cloned.serialize());\n          if (node.inputs && node.inputs.length) {\n              for (var j = 0; j < node.inputs.length; ++j) {\n                  var input = node.inputs[j];\n                  if (!input || input.link == null) {\n                      continue;\n                  }\n                  var link_info = this.graph.links[input.link];\n                  if (!link_info) {\n                      continue;\n                  }\n                  var target_node = this.graph.getNodeById(\n                      link_info.origin_id\n                  );\n                  if (!target_node || !this.selected_nodes[target_node.id]) {\n                      //improve this by allowing connections to non-selected nodes\n                      continue;\n                  } //not selected\n                  clipboard_info.links.push([\n                      target_node._relative_id,\n                      link_info.origin_slot, //j,\n                      node._relative_id,\n                      link_info.target_slot\n                  ]);\n              }\n          }\n      }\n      localStorage.setItem(\n          \"litegrapheditor_clipboard\",\n          JSON.stringify(clipboard_info)\n      );\n  };\n\n  LGraphCanvas.prototype.pasteFromClipboard = function() {\n      var data = localStorage.getItem(\"litegrapheditor_clipboard\");\n      if (!data) {\n          return;\n      }\n\n      //create nodes\n      var clipboard_info = JSON.parse(data);\n      var nodes = [];\n      for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n          var node_data = clipboard_info.nodes[i];\n          var node = LiteGraph.createNode(node_data.type);\n          if (node) {\n              node.configure(node_data);\n              node.pos[0] += 5;\n              node.pos[1] += 5;\n              this.graph.add(node);\n              nodes.push(node);\n          }\n      }\n\n      //create links\n      for (var i = 0; i < clipboard_info.links.length; ++i) {\n          var link_info = clipboard_info.links[i];\n          var origin_node = nodes[link_info[0]];\n          var target_node = nodes[link_info[2]];\n    if( origin_node && target_node )\n            origin_node.connect(link_info[1], target_node, link_info[3]);\n    else\n      console.warn(\"Warning, nodes missing on pasting\");\n      }\n\n      this.selectNodes(nodes);\n  };\n\n  /**\n   * process a item drop event on top the canvas\n   * @method processDrop\n   **/\n  LGraphCanvas.prototype.processDrop = function(e) {\n      e.preventDefault();\n      this.adjustMouseEvent(e);\n\n      var pos = [e.canvasX, e.canvasY];\n      var node = this.graph.getNodeOnPos(pos[0], pos[1]);\n\n      if (!node) {\n          var r = null;\n          if (this.onDropItem) {\n              r = this.onDropItem(event);\n          }\n          if (!r) {\n              this.checkDropItem(e);\n          }\n          return;\n      }\n\n      if (node.onDropFile || node.onDropData) {\n          var files = e.dataTransfer.files;\n          if (files && files.length) {\n              for (var i = 0; i < files.length; i++) {\n                  var file = e.dataTransfer.files[0];\n                  var filename = file.name;\n                  var ext = LGraphCanvas.getFileExtension(filename);\n                  //console.log(file);\n\n                  if (node.onDropFile) {\n                      node.onDropFile(file);\n                  }\n\n                  if (node.onDropData) {\n                      //prepare reader\n                      var reader = new FileReader();\n                      reader.onload = function(event) {\n                          //console.log(event.target);\n                          var data = event.target.result;\n                          node.onDropData(data, filename, file);\n                      };\n\n                      //read data\n                      var type = file.type.split(\"/\")[0];\n                      if (type == \"text\" || type == \"\") {\n                          reader.readAsText(file);\n                      } else if (type == \"image\") {\n                          reader.readAsDataURL(file);\n                      } else {\n                          reader.readAsArrayBuffer(file);\n                      }\n                  }\n              }\n          }\n      }\n\n      if (node.onDropItem) {\n          if (node.onDropItem(event)) {\n              return true;\n          }\n      }\n\n      if (this.onDropItem) {\n          return this.onDropItem(event);\n      }\n\n      return false;\n  };\n\n  //called if the graph doesn't have a default drop item behaviour\n  LGraphCanvas.prototype.checkDropItem = function(e) {\n      if (e.dataTransfer.files.length) {\n          var file = e.dataTransfer.files[0];\n          var ext = LGraphCanvas.getFileExtension(file.name).toLowerCase();\n          var nodetype = LiteGraph.node_types_by_file_extension[ext];\n          if (nodetype) {\n              var node = LiteGraph.createNode(nodetype.type);\n              node.pos = [e.canvasX, e.canvasY];\n              this.graph.add(node);\n              if (node.onDropFile) {\n                  node.onDropFile(file);\n              }\n          }\n      }\n  };\n\n  LGraphCanvas.prototype.processNodeDblClicked = function(n) {\n      if (this.onShowNodePanel) {\n          this.onShowNodePanel(n);\n      }\n\n      if (this.onNodeDblClicked) {\n          this.onNodeDblClicked(n);\n      }\n\n      this.setDirty(true);\n  };\n\n  LGraphCanvas.prototype.processNodeSelected = function(node, e) {\n      this.selectNode(node, e && e.shiftKey);\n      if (this.onNodeSelected) {\n          this.onNodeSelected(node);\n      }\n  };\n\n  /**\n   * selects a given node (or adds it to the current selection)\n   * @method selectNode\n   **/\n  LGraphCanvas.prototype.selectNode = function(\n      node,\n      add_to_current_selection\n  ) {\n      if (node == null) {\n          this.deselectAllNodes();\n      } else {\n          this.selectNodes([node], add_to_current_selection);\n      }\n  };\n\n  /**\n   * selects several nodes (or adds them to the current selection)\n   * @method selectNodes\n   **/\n  LGraphCanvas.prototype.selectNodes = function(\n      nodes,\n      add_to_current_selection\n  ) {\n      if (!add_to_current_selection) {\n          this.deselectAllNodes();\n      }\n\n      nodes = nodes || this.graph._nodes;\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          if (node.is_selected) {\n              continue;\n          }\n\n          if (!node.is_selected && node.onSelected) {\n              node.onSelected();\n          }\n          node.is_selected = true;\n          this.selected_nodes[node.id] = node;\n\n          if (node.inputs) {\n              for (var j = 0; j < node.inputs.length; ++j) {\n                  this.highlighted_links[node.inputs[j].link] = true;\n              }\n          }\n          if (node.outputs) {\n              for (var j = 0; j < node.outputs.length; ++j) {\n                  var out = node.outputs[j];\n                  if (out.links) {\n                      for (var k = 0; k < out.links.length; ++k) {\n                          this.highlighted_links[out.links[k]] = true;\n                      }\n                  }\n              }\n          }\n      }\n\n  if(\tthis.onSelectionChange )\n    this.onSelectionChange( this.selected_nodes );\n\n      this.setDirty(true);\n  };\n\n  /**\n   * removes a node from the current selection\n   * @method deselectNode\n   **/\n  LGraphCanvas.prototype.deselectNode = function(node) {\n      if (!node.is_selected) {\n          return;\n      }\n      if (node.onDeselected) {\n          node.onDeselected();\n      }\n      node.is_selected = false;\n\n      if (this.onNodeDeselected) {\n          this.onNodeDeselected(node);\n      }\n\n      //remove highlighted\n      if (node.inputs) {\n          for (var i = 0; i < node.inputs.length; ++i) {\n              delete this.highlighted_links[node.inputs[i].link];\n          }\n      }\n      if (node.outputs) {\n          for (var i = 0; i < node.outputs.length; ++i) {\n              var out = node.outputs[i];\n              if (out.links) {\n                  for (var j = 0; j < out.links.length; ++j) {\n                      delete this.highlighted_links[out.links[j]];\n                  }\n              }\n          }\n      }\n  };\n\n  /**\n   * removes all nodes from the current selection\n   * @method deselectAllNodes\n   **/\n  LGraphCanvas.prototype.deselectAllNodes = function() {\n      if (!this.graph) {\n          return;\n      }\n      var nodes = this.graph._nodes;\n      for (var i = 0, l = nodes.length; i < l; ++i) {\n          var node = nodes[i];\n          if (!node.is_selected) {\n              continue;\n          }\n          if (node.onDeselected) {\n              node.onDeselected();\n          }\n          node.is_selected = false;\n    if (this.onNodeDeselected) {\n      this.onNodeDeselected(node);\n    }\n      }\n      this.selected_nodes = {};\n      this.current_node = null;\n      this.highlighted_links = {};\n  if(\tthis.onSelectionChange )\n    this.onSelectionChange( this.selected_nodes );\n      this.setDirty(true);\n  };\n\n  /**\n   * deletes all nodes in the current selection from the graph\n   * @method deleteSelectedNodes\n   **/\n  LGraphCanvas.prototype.deleteSelectedNodes = function() {\n      for (var i in this.selected_nodes) {\n          var node = this.selected_nodes[i];\n    //autoconnect when possible (very basic, only takes into account first input-output)\n    if(node.inputs && node.inputs.length && node.outputs && node.outputs.length && LiteGraph.isValidConnection( node.inputs[0].type, node.outputs[0].type ) && node.inputs[0].link && node.outputs[0].links && node.outputs[0].links.length ) \n    {\n      var input_link = node.graph.links[ node.inputs[0].link ];\n      var output_link = node.graph.links[ node.outputs[0].links[0] ];\n      var input_node = node.getInputNode(0);\n      var output_node = node.getOutputNodes(0)[0];\n      if(input_node && output_node)\n        input_node.connect( input_link.origin_slot, output_node, output_link.target_slot );\n    }\n          this.graph.remove(node);\n    if (this.onNodeDeselected) {\n      this.onNodeDeselected(node);\n    }\n      }\n      this.selected_nodes = {};\n      this.current_node = null;\n      this.highlighted_links = {};\n      this.setDirty(true);\n  };\n\n  /**\n   * centers the camera on a given node\n   * @method centerOnNode\n   **/\n  LGraphCanvas.prototype.centerOnNode = function(node) {\n      this.ds.offset[0] =\n          -node.pos[0] -\n          node.size[0] * 0.5 +\n          (this.canvas.width * 0.5) / this.ds.scale;\n      this.ds.offset[1] =\n          -node.pos[1] -\n          node.size[1] * 0.5 +\n          (this.canvas.height * 0.5) / this.ds.scale;\n      this.setDirty(true, true);\n  };\n\n  /**\n   * adds some useful properties to a mouse event, like the position in graph coordinates\n   * @method adjustMouseEvent\n   **/\n  LGraphCanvas.prototype.adjustMouseEvent = function(e) {\n      if (this.canvas) {\n          var b = this.canvas.getBoundingClientRect();\n          e.localX = e.clientX - b.left;\n          e.localY = e.clientY - b.top;\n      } else {\n          e.localX = e.clientX;\n          e.localY = e.clientY;\n      }\n\n      e.deltaX = e.localX - this.last_mouse_position[0];\n      e.deltaY = e.localY - this.last_mouse_position[1];\n\n      this.last_mouse_position[0] = e.localX;\n      this.last_mouse_position[1] = e.localY;\n\n      e.canvasX = e.localX / this.ds.scale - this.ds.offset[0];\n      e.canvasY = e.localY / this.ds.scale - this.ds.offset[1];\n  };\n\n  /**\n   * changes the zoom level of the graph (default is 1), you can pass also a place used to pivot the zoom\n   * @method setZoom\n   **/\n  LGraphCanvas.prototype.setZoom = function(value, zooming_center) {\n      this.ds.changeScale(value, zooming_center);\n      /*\nif(!zooming_center && this.canvas)\n  zooming_center = [this.canvas.width * 0.5,this.canvas.height * 0.5];\n\nvar center = this.convertOffsetToCanvas( zooming_center );\n\nthis.ds.scale = value;\n\nif(this.scale > this.max_zoom)\n  this.scale = this.max_zoom;\nelse if(this.scale < this.min_zoom)\n  this.scale = this.min_zoom;\n\nvar new_center = this.convertOffsetToCanvas( zooming_center );\nvar delta_offset = [new_center[0] - center[0], new_center[1] - center[1]];\n\nthis.offset[0] += delta_offset[0];\nthis.offset[1] += delta_offset[1];\n*/\n\n      this.dirty_canvas = true;\n      this.dirty_bgcanvas = true;\n  };\n\n  /**\n   * converts a coordinate from graph coordinates to canvas2D coordinates\n   * @method convertOffsetToCanvas\n   **/\n  LGraphCanvas.prototype.convertOffsetToCanvas = function(pos, out) {\n      return this.ds.convertOffsetToCanvas(pos, out);\n  };\n\n  /**\n   * converts a coordinate from Canvas2D coordinates to graph space\n   * @method convertCanvasToOffset\n   **/\n  LGraphCanvas.prototype.convertCanvasToOffset = function(pos, out) {\n      return this.ds.convertCanvasToOffset(pos, out);\n  };\n\n  //converts event coordinates from canvas2D to graph coordinates\n  LGraphCanvas.prototype.convertEventToCanvasOffset = function(e) {\n      var rect = this.canvas.getBoundingClientRect();\n      return this.convertCanvasToOffset([\n          e.clientX - rect.left,\n          e.clientY - rect.top\n      ]);\n  };\n\n  /**\n   * brings a node to front (above all other nodes)\n   * @method bringToFront\n   **/\n  LGraphCanvas.prototype.bringToFront = function(node) {\n      var i = this.graph._nodes.indexOf(node);\n      if (i == -1) {\n          return;\n      }\n\n      this.graph._nodes.splice(i, 1);\n      this.graph._nodes.push(node);\n  };\n\n  /**\n   * sends a node to the back (below all other nodes)\n   * @method sendToBack\n   **/\n  LGraphCanvas.prototype.sendToBack = function(node) {\n      var i = this.graph._nodes.indexOf(node);\n      if (i == -1) {\n          return;\n      }\n\n      this.graph._nodes.splice(i, 1);\n      this.graph._nodes.unshift(node);\n  };\n\n  /* Interaction */\n\n  /* LGraphCanvas render */\n  var temp = new Float32Array(4);\n\n  /**\n   * checks which nodes are visible (inside the camera area)\n   * @method computeVisibleNodes\n   **/\n  LGraphCanvas.prototype.computeVisibleNodes = function(nodes, out) {\n      var visible_nodes = out || [];\n      visible_nodes.length = 0;\n      nodes = nodes || this.graph._nodes;\n      for (var i = 0, l = nodes.length; i < l; ++i) {\n          var n = nodes[i];\n\n          //skip rendering nodes in live mode\n          if (this.live_mode && !n.onDrawBackground && !n.onDrawForeground) {\n              continue;\n          }\n\n          if (!overlapBounding(this.visible_area, n.getBounding(temp))) {\n              continue;\n          } //out of the visible area\n\n          visible_nodes.push(n);\n      }\n      return visible_nodes;\n  };\n\n  /**\n   * renders the whole canvas content, by rendering in two separated canvas, one containing the background grid and the connections, and one containing the nodes)\n   * @method draw\n   **/\n  LGraphCanvas.prototype.draw = function(force_canvas, force_bgcanvas) {\n      if (!this.canvas) {\n          return;\n      }\n\n      //fps counting\n      var now = LiteGraph.getTime();\n      this.render_time = (now - this.last_draw_time) * 0.001;\n      this.last_draw_time = now;\n\n      if (this.graph) {\n          this.ds.computeVisibleArea();\n      }\n\n      if (\n          this.dirty_bgcanvas ||\n          force_bgcanvas ||\n          this.always_render_background ||\n          (this.graph &&\n              this.graph._last_trigger_time &&\n              now - this.graph._last_trigger_time < 1000)\n      ) {\n          this.drawBackCanvas();\n      }\n\n      if (this.dirty_canvas || force_canvas) {\n          this.drawFrontCanvas();\n      }\n\n      this.fps = this.render_time ? 1.0 / this.render_time : 0;\n      this.frame += 1;\n  };\n\n  /**\n   * draws the front canvas (the one containing all the nodes)\n   * @method drawFrontCanvas\n   **/\n  LGraphCanvas.prototype.drawFrontCanvas = function() {\n      this.dirty_canvas = false;\n\n      if (!this.ctx) {\n          this.ctx = this.bgcanvas.getContext(\"2d\");\n      }\n      var ctx = this.ctx;\n      if (!ctx) {\n          //maybe is using webgl...\n          return;\n      }\n\n      if (ctx.start2D) {\n          ctx.start2D();\n      }\n\n      var canvas = this.canvas;\n\n      //reset in case of error\n      ctx.restore();\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n      //clip dirty area if there is one, otherwise work in full canvas\n      if (this.dirty_area) {\n          ctx.save();\n          ctx.beginPath();\n          ctx.rect(\n              this.dirty_area[0],\n              this.dirty_area[1],\n              this.dirty_area[2],\n              this.dirty_area[3]\n          );\n          ctx.clip();\n      }\n\n      //clear\n      //canvas.width = canvas.width;\n      if (this.clear_background) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n\n      //draw bg canvas\n      if (this.bgcanvas == this.canvas) {\n          this.drawBackCanvas();\n      } else {\n          ctx.drawImage(this.bgcanvas, 0, 0);\n      }\n\n      //rendering\n      if (this.onRender) {\n          this.onRender(canvas, ctx);\n      }\n\n      //info widget\n      if (this.show_info) {\n          this.renderInfo(ctx);\n      }\n\n      if (this.graph) {\n          //apply transformations\n          ctx.save();\n          this.ds.toCanvasContext(ctx);\n\n          //draw nodes\n          var drawn_nodes = 0;\n          var visible_nodes = this.computeVisibleNodes(\n              null,\n              this.visible_nodes\n          );\n\n          for (var i = 0; i < visible_nodes.length; ++i) {\n              var node = visible_nodes[i];\n\n              //transform coords system\n              ctx.save();\n              ctx.translate(node.pos[0], node.pos[1]);\n\n              //Draw\n              this.drawNode(node, ctx);\n              drawn_nodes += 1;\n\n              //Restore\n              ctx.restore();\n          }\n\n          //on top (debug)\n          if (this.render_execution_order) {\n              this.drawExecutionOrder(ctx);\n          }\n\n          //connections ontop?\n          if (this.graph.config.links_ontop) {\n              if (!this.live_mode) {\n                  this.drawConnections(ctx);\n              }\n          }\n\n          //current connection (the one being dragged by the mouse)\n          if (this.connecting_pos != null) {\n              ctx.lineWidth = this.connections_width;\n              var link_color = null;\n\n              switch (this.connecting_output.type) {\n                  case LiteGraph.EVENT:\n                      link_color = LiteGraph.EVENT_LINK_COLOR;\n                      break;\n                  default:\n                      link_color = LiteGraph.CONNECTING_LINK_COLOR;\n              }\n\n              //the connection being dragged by the mouse\n              this.renderLink(\n                  ctx,\n                  this.connecting_pos,\n                  [this.canvas_mouse[0], this.canvas_mouse[1]],\n                  null,\n                  false,\n                  null,\n                  link_color,\n                  this.connecting_output.dir ||\n                      (this.connecting_node.horizontal\n                          ? LiteGraph.DOWN\n                          : LiteGraph.RIGHT),\n                  LiteGraph.CENTER\n              );\n\n              ctx.beginPath();\n              if (\n                  this.connecting_output.type === LiteGraph.EVENT ||\n                  this.connecting_output.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(\n                      this.connecting_pos[0] - 6 + 0.5,\n                      this.connecting_pos[1] - 5 + 0.5,\n                      14,\n                      10\n                  );\n              } else {\n                  ctx.arc(\n                      this.connecting_pos[0],\n                      this.connecting_pos[1],\n                      4,\n                      0,\n                      Math.PI * 2\n                  );\n              }\n              ctx.fill();\n\n              ctx.fillStyle = \"#ffcc00\";\n              if (this._highlight_input) {\n                  ctx.beginPath();\n                  ctx.arc(\n                      this._highlight_input[0],\n                      this._highlight_input[1],\n                      6,\n                      0,\n                      Math.PI * 2\n                  );\n                  ctx.fill();\n              }\n          }\n\n    //the selection rectangle\n          if (this.dragging_rectangle) {\n              ctx.strokeStyle = \"#FFF\";\n              ctx.strokeRect(\n                  this.dragging_rectangle[0],\n                  this.dragging_rectangle[1],\n                  this.dragging_rectangle[2],\n                  this.dragging_rectangle[3]\n              );\n          }\n\n    //on top of link center\n    if(this.over_link_center && this.render_link_tooltip)\n      this.drawLinkTooltip( ctx, this.over_link_center );\n    else\n      if(this.onDrawLinkTooltip) //to remove\n        this.onDrawLinkTooltip(ctx,null);\n\n    //custom info\n          if (this.onDrawForeground) {\n              this.onDrawForeground(ctx, this.visible_rect);\n          }\n\n          ctx.restore();\n      }\n\n      if (this.onDrawOverlay) {\n          this.onDrawOverlay(ctx);\n      }\n\n      if (this.dirty_area) {\n          ctx.restore();\n          //this.dirty_area = null;\n      }\n\n      if (ctx.finish2D) {\n          //this is a function I use in webgl renderer\n          ctx.finish2D();\n      }\n  };\n\n  /**\n   * draws some useful stats in the corner of the canvas\n   * @method renderInfo\n   **/\n  LGraphCanvas.prototype.renderInfo = function(ctx, x, y) {\n      x = x || 0;\n      y = y || 0;\n\n      ctx.save();\n      ctx.translate(x, y);\n\n      ctx.font = \"10px Arial\";\n      ctx.fillStyle = \"#888\";\n      if (this.graph) {\n          ctx.fillText( \"T: \" + this.graph.globaltime.toFixed(2) + \"s\", 5, 13 * 1 );\n          ctx.fillText(\"I: \" + this.graph.iteration, 5, 13 * 2 );\n          ctx.fillText(\"N: \" + this.graph._nodes.length + \" [\" + this.visible_nodes.length + \"]\", 5, 13 * 3 );\n          ctx.fillText(\"V: \" + this.graph._version, 5, 13 * 4);\n          ctx.fillText(\"FPS:\" + this.fps.toFixed(2), 5, 13 * 5);\n      } else {\n          ctx.fillText(\"No graph selected\", 5, 13 * 1);\n      }\n      ctx.restore();\n  };\n\n  /**\n   * draws the back canvas (the one containing the background and the connections)\n   * @method drawBackCanvas\n   **/\n  LGraphCanvas.prototype.drawBackCanvas = function() {\n      var canvas = this.bgcanvas;\n      if (\n          canvas.width != this.canvas.width ||\n          canvas.height != this.canvas.height\n      ) {\n          canvas.width = this.canvas.width;\n          canvas.height = this.canvas.height;\n      }\n\n      if (!this.bgctx) {\n          this.bgctx = this.bgcanvas.getContext(\"2d\");\n      }\n      var ctx = this.bgctx;\n      if (ctx.start) {\n          ctx.start();\n      }\n\n      //clear\n      if (this.clear_background) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n\n      if (this._graph_stack && this._graph_stack.length) {\n          ctx.save();\n          var parent_graph = this._graph_stack[this._graph_stack.length - 1];\n          var subgraph_node = this.graph._subgraph_node;\n          ctx.strokeStyle = subgraph_node.bgcolor;\n          ctx.lineWidth = 10;\n          ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);\n          ctx.lineWidth = 1;\n          ctx.font = \"40px Arial\";\n          ctx.textAlign = \"center\";\n          ctx.fillStyle = subgraph_node.bgcolor || \"#AAA\";\n          var title = \"\";\n          for (var i = 1; i < this._graph_stack.length; ++i) {\n              title +=\n                  this._graph_stack[i]._subgraph_node.getTitle() + \" >> \";\n          }\n          ctx.fillText(\n              title + subgraph_node.getTitle(),\n              canvas.width * 0.5,\n              40\n          );\n          ctx.restore();\n      }\n\n      var bg_already_painted = false;\n      if (this.onRenderBackground) {\n          bg_already_painted = this.onRenderBackground(canvas, ctx);\n      }\n\n      //reset in case of error\n      ctx.restore();\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      this.visible_links.length = 0;\n\n      if (this.graph) {\n          //apply transformations\n          ctx.save();\n          this.ds.toCanvasContext(ctx);\n            ctx.mozImageSmoothingEnabled = false;\n            ctx.oImageSmoothingEnabled = false;\n            ctx.webkitImageSmoothingEnabled = false;\n            ctx.msImageSmoothingEnabled = false;\n            ctx.imageSmoothingEnabled = false;\n          //render BG\n          if (\n              this.background_image &&\n              this.ds.scale > 0.5 &&\n              !bg_already_painted\n          ) {\n              if (this.zoom_modify_alpha) {\n                  ctx.globalAlpha =\n                      (1.0 - 0.5 / this.ds.scale) * this.editor_alpha;\n              } else {\n                  ctx.globalAlpha = this.editor_alpha;\n              }\n              if (\n                  !this._bg_img ||\n                  this._bg_img.name != this.background_image\n              ) {\n                  this._bg_img = new Image();\n                  this._bg_img.name = this.background_image;\n                  this._bg_img.src = this.background_image;\n                  var that = this;\n                  this._bg_img.onload = function() {\n                      that.draw(true, true);\n                  };\n              }\n\n              var pattern = null;\n              if (this._pattern == null && this._bg_img.width > 0) {\n                  pattern = ctx.createPattern(this._bg_img, \"repeat\");\n                  this._pattern_img = this._bg_img;\n                  this._pattern = pattern;\n              } else {\n                  pattern = this._pattern;\n              }\n              if (pattern) {\n                  ctx.fillStyle = pattern;\n                  ctx.fillRect(\n                      this.visible_area[0],\n                      this.visible_area[1],\n                      this.visible_area[2],\n                      this.visible_area[3]\n                  );\n                  ctx.fillStyle = \"transparent\";\n              }\n\n              ctx.globalAlpha = 1.0;\n          }\n\n          //groups\n          if (this.graph._groups.length && !this.live_mode) {\n              this.drawGroups(canvas, ctx);\n          }\n\n          if (this.onDrawBackground) {\n              this.onDrawBackground(ctx, this.visible_area);\n          }\n          if (this.onBackgroundRender) {\n              //LEGACY\n              console.error(\n                  \"WARNING! onBackgroundRender deprecated, now is named onDrawBackground \"\n              );\n              this.onBackgroundRender = null;\n          }\n\n          //DEBUG: show clipping area\n          //ctx.fillStyle = \"red\";\n          //ctx.fillRect( this.visible_area[0] + 10, this.visible_area[1] + 10, this.visible_area[2] - 20, this.visible_area[3] - 20);\n\n          //bg\n          if (this.render_canvas_border) {\n              ctx.strokeStyle = \"#235\";\n              ctx.strokeRect(0, 0, canvas.width, canvas.height);\n          }\n\n          if (this.render_connections_shadows) {\n              ctx.shadowColor = \"#000\";\n              ctx.shadowOffsetX = 0;\n              ctx.shadowOffsetY = 0;\n              ctx.shadowBlur = 6;\n          } else {\n              ctx.shadowColor = \"rgba(0,0,0,0)\";\n          }\n\n          //draw connections\n          if (!this.live_mode) {\n              this.drawConnections(ctx);\n          }\n\n          ctx.shadowColor = \"rgba(0,0,0,0)\";\n\n          //restore state\n          ctx.restore();\n      }\n\n      if (ctx.finish) {\n          ctx.finish();\n      }\n\n      this.dirty_bgcanvas = false;\n      this.dirty_canvas = true; //to force to repaint the front canvas with the bgcanvas\n  };\n\n  var temp_vec2 = new Float32Array(2);\n\n  /**\n   * draws the given node inside the canvas\n   * @method drawNode\n   **/\n  LGraphCanvas.prototype.drawNode = function(node, ctx) {\n      var glow = false;\n      this.current_node = node;\n\n      var color =\n          node.color ||\n          node.constructor.color ||\n          LiteGraph.NODE_DEFAULT_COLOR;\n      var bgcolor =\n          node.bgcolor ||\n          node.constructor.bgcolor ||\n          LiteGraph.NODE_DEFAULT_BGCOLOR;\n\n      //shadow and glow\n      if (node.mouseOver) {\n          glow = true;\n      }\n\n      var low_quality = this.ds.scale < 0.6; //zoomed out\n\n      //only render if it forces it to do it\n      if (this.live_mode) {\n          if (!node.flags.collapsed) {\n              ctx.shadowColor = \"transparent\";\n              if (node.onDrawForeground) {\n                  node.onDrawForeground(ctx, this, this.canvas);\n              }\n          }\n          return;\n      }\n\n      var editor_alpha = this.editor_alpha;\n      ctx.globalAlpha = editor_alpha;\n\n      if (this.render_shadows && !low_quality) {\n          ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n          ctx.shadowOffsetX = 2 * this.ds.scale;\n          ctx.shadowOffsetY = 2 * this.ds.scale;\n          ctx.shadowBlur = 3 * this.ds.scale;\n      } else {\n          ctx.shadowColor = \"transparent\";\n      }\n\n      //custom draw collapsed method (draw after shadows because they are affected)\n      if (\n          node.flags.collapsed &&\n          node.onDrawCollapsed &&\n          node.onDrawCollapsed(ctx, this) == true\n      ) {\n          return;\n      }\n\n      //clip if required (mask)\n      var shape = node._shape || LiteGraph.BOX_SHAPE;\n      var size = temp_vec2;\n      temp_vec2.set(node.size);\n      var horizontal = node.horizontal; // || node.flags.horizontal;\n\n      if (node.flags.collapsed) {\n          ctx.font = this.inner_text_font;\n          var title = node.getTitle ? node.getTitle() : node.title;\n          if (title != null) {\n              node._collapsed_width = Math.min(\n                  node.size[0],\n                  ctx.measureText(title).width +\n                      LiteGraph.NODE_TITLE_HEIGHT * 2\n              ); //LiteGraph.NODE_COLLAPSED_WIDTH;\n              size[0] = node._collapsed_width;\n              size[1] = 0;\n          }\n      }\n\n      if (node.clip_area) {\n          //Start clipping\n          ctx.save();\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE) {\n              ctx.rect(0, 0, size[0], size[1]);\n          } else if (shape == LiteGraph.ROUND_SHAPE) {\n              ctx.roundRect(0, 0, size[0], size[1], 10);\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.clip();\n      }\n\n      //draw shape\n      if (node.has_errors) {\n          bgcolor = \"red\";\n      }\n      this.drawNodeShape(\n          node,\n          ctx,\n          size,\n          color,\n          bgcolor,\n          node.is_selected,\n          node.mouseOver\n      );\n      ctx.shadowColor = \"transparent\";\n\n      //draw foreground\n      if (node.onDrawForeground) {\n          node.onDrawForeground(ctx, this, this.canvas);\n      }\n\n      //connection slots\n      ctx.textAlign = horizontal ? \"center\" : \"left\";\n      ctx.font = this.inner_text_font;\n\n      var render_text = !low_quality;\n\n      var out_slot = this.connecting_output;\n      ctx.lineWidth = 1;\n\n      var max_y = 0;\n      var slot_pos = new Float32Array(2); //to reuse\n\n      //render inputs and outputs\n      if (!node.flags.collapsed) {\n          //input connection slots\n          if (node.inputs) {\n              for (var i = 0; i < node.inputs.length; i++) {\n                  var slot = node.inputs[i];\n\n                  ctx.globalAlpha = editor_alpha;\n                  //change opacity of incompatible slots when dragging a connection\n                  if ( this.connecting_node && !LiteGraph.isValidConnection( slot.type , out_slot.type) ) {\n                      ctx.globalAlpha = 0.4 * editor_alpha;\n                  }\n\n                  ctx.fillStyle =\n                      slot.link != null\n                          ? slot.color_on ||\n                            this.default_connection_color.input_on\n                          : slot.color_off ||\n                            this.default_connection_color.input_off;\n\n                  var pos = node.getConnectionPos(true, i, slot_pos);\n                  pos[0] -= node.pos[0];\n                  pos[1] -= node.pos[1];\n                  if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                      max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                  }\n\n                  ctx.beginPath();\n\n                  if (\n                      slot.type === LiteGraph.EVENT ||\n                      slot.shape === LiteGraph.BOX_SHAPE\n                  ) {\n                      if (horizontal) {\n                          ctx.rect(\n                              pos[0] - 5 + 0.5,\n                              pos[1] - 8 + 0.5,\n                              10,\n                              14\n                          );\n                      } else {\n                          ctx.rect(\n                              pos[0] - 6 + 0.5,\n                              pos[1] - 5 + 0.5,\n                              14,\n                              10\n                          );\n                      }\n                  } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                      ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                      ctx.closePath();\n                  } else {\n          if(low_quality)\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 ); //faster\n          else\n                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                  }\n                  ctx.fill();\n\n                  //render name\n                  if (render_text) {\n                      var text = slot.label != null ? slot.label : slot.name;\n                      if (text) {\n                          ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                          if (horizontal || slot.dir == LiteGraph.UP) {\n                              ctx.fillText(text, pos[0], pos[1] - 10);\n                          } else {\n                              ctx.fillText(text, pos[0] + 10, pos[1] + 5);\n                          }\n                      }\n                  }\n              }\n          }\n\n          //output connection slots\n          if (this.connecting_node) {\n              ctx.globalAlpha = 0.4 * editor_alpha;\n          }\n\n          ctx.textAlign = horizontal ? \"center\" : \"right\";\n          ctx.strokeStyle = \"black\";\n          if (node.outputs) {\n              for (var i = 0; i < node.outputs.length; i++) {\n                  var slot = node.outputs[i];\n\n                  var pos = node.getConnectionPos(false, i, slot_pos);\n                  pos[0] -= node.pos[0];\n                  pos[1] -= node.pos[1];\n                  if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                      max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                  }\n\n                  ctx.fillStyle =\n                      slot.links && slot.links.length\n                          ? slot.color_on ||\n                            this.default_connection_color.output_on\n                          : slot.color_off ||\n                            this.default_connection_color.output_off;\n                  ctx.beginPath();\n                  //ctx.rect( node.size[0] - 14,i*14,10,10);\n\n                  if (\n                      slot.type === LiteGraph.EVENT ||\n                      slot.shape === LiteGraph.BOX_SHAPE\n                  ) {\n                      if (horizontal) {\n                          ctx.rect(\n                              pos[0] - 5 + 0.5,\n                              pos[1] - 8 + 0.5,\n                              10,\n                              14\n                          );\n                      } else {\n                          ctx.rect(\n                              pos[0] - 6 + 0.5,\n                              pos[1] - 5 + 0.5,\n                              14,\n                              10\n                          );\n                      }\n                  } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                      ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                      ctx.closePath();\n                  } else {\n          if(low_quality)\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 );\n          else\n                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                  }\n\n                  //trigger\n                  //if(slot.node_id != null && slot.slot == -1)\n                  //\tctx.fillStyle = \"#F85\";\n\n                  //if(slot.links != null && slot.links.length)\n                  ctx.fill();\n        if(!low_quality)\n                    ctx.stroke();\n\n                  //render output name\n                  if (render_text) {\n                      var text = slot.label != null ? slot.label : slot.name;\n                      if (text) {\n                          ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                          if (horizontal || slot.dir == LiteGraph.DOWN) {\n                              ctx.fillText(text, pos[0], pos[1] - 8);\n                          } else {\n                              ctx.fillText(text, pos[0] - 10, pos[1] + 5);\n                          }\n                      }\n                  }\n              }\n          }\n\n          ctx.textAlign = \"left\";\n          ctx.globalAlpha = 1;\n\n          if (node.widgets) {\n      var widgets_y = max_y;\n              if (horizontal || node.widgets_up) {\n                  widgets_y = 2;\n              }\n      if( node.widgets_start_y != null )\n                  widgets_y = node.widgets_start_y;\n              this.drawNodeWidgets(\n                  node,\n                  widgets_y,\n                  ctx,\n                  this.node_widget && this.node_widget[0] == node\n                      ? this.node_widget[1]\n                      : null\n              );\n          }\n      } else if (this.render_collapsed_slots) {\n          //if collapsed\n          var input_slot = null;\n          var output_slot = null;\n\n          //get first connected slot to render\n          if (node.inputs) {\n              for (var i = 0; i < node.inputs.length; i++) {\n                  var slot = node.inputs[i];\n                  if (slot.link == null) {\n                      continue;\n                  }\n                  input_slot = slot;\n                  break;\n              }\n          }\n          if (node.outputs) {\n              for (var i = 0; i < node.outputs.length; i++) {\n                  var slot = node.outputs[i];\n                  if (!slot.links || !slot.links.length) {\n                      continue;\n                  }\n                  output_slot = slot;\n              }\n          }\n\n          if (input_slot) {\n              var x = 0;\n              var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n              if (horizontal) {\n                  x = node._collapsed_width * 0.5;\n                  y = -LiteGraph.NODE_TITLE_HEIGHT;\n              }\n              ctx.fillStyle = \"#686\";\n              ctx.beginPath();\n              if (\n                  slot.type === LiteGraph.EVENT ||\n                  slot.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n              } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                  ctx.moveTo(x + 8, y);\n                  ctx.lineTo(x + -4, y - 4);\n                  ctx.lineTo(x + -4, y + 4);\n                  ctx.closePath();\n              } else {\n                  ctx.arc(x, y, 4, 0, Math.PI * 2);\n              }\n              ctx.fill();\n          }\n\n          if (output_slot) {\n              var x = node._collapsed_width;\n              var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n              if (horizontal) {\n                  x = node._collapsed_width * 0.5;\n                  y = 0;\n              }\n              ctx.fillStyle = \"#686\";\n              ctx.strokeStyle = \"black\";\n              ctx.beginPath();\n              if (\n                  slot.type === LiteGraph.EVENT ||\n                  slot.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n              } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                  ctx.moveTo(x + 6, y);\n                  ctx.lineTo(x - 6, y - 4);\n                  ctx.lineTo(x - 6, y + 4);\n                  ctx.closePath();\n              } else {\n                  ctx.arc(x, y, 4, 0, Math.PI * 2);\n              }\n              ctx.fill();\n              //ctx.stroke();\n          }\n      }\n\n      if (node.clip_area) {\n          ctx.restore();\n      }\n\n      ctx.globalAlpha = 1.0;\n  };\n\n//used by this.over_link_center\nLGraphCanvas.prototype.drawLinkTooltip = function( ctx, link )\n{\n  var pos = link._pos;\n  ctx.fillStyle = \"black\";\n  ctx.beginPath();\n  ctx.arc( pos[0], pos[1], 3, 0, Math.PI * 2 );\n  ctx.fill();\n\n  if(link.data == null)\n    return;\n\n  if(this.onDrawLinkTooltip)\n    if( this.onDrawLinkTooltip(ctx,link,this) == true )\n      return;\n\n  var data = link.data;\n  var text = null;\n\n  if( data.constructor === Number )\n    text = data.toFixed(2);\n  else if( data.constructor === String )\n    text = \"\\\"\" + data + \"\\\"\";\n  else if( data.constructor === Boolean )\n    text = String(data);\n  else if (data.toToolTip)\n    text = data.toToolTip();\n  else\n    text = \"[\" + data.constructor.name + \"]\";\n\n  if(text == null)\n    return;\n\n  ctx.font = \"14px Courier New\";\n  var info = ctx.measureText(text);\n  var w = info.width + 20;\n  var h = 24;\n  ctx.shadowColor = \"black\";\n  ctx.shadowOffsetX = 2;\n  ctx.shadowOffsetY = 2;\n  ctx.shadowBlur = 3;\n  ctx.fillStyle = \"#454\";\n  ctx.beginPath();\n  ctx.roundRect( pos[0] - w*0.5, pos[1] - 15 - h, w, h,3, 3);\n  ctx.moveTo( pos[0] - 10, pos[1] - 15 );\n  ctx.lineTo( pos[0] + 10, pos[1] - 15 );\n  ctx.lineTo( pos[0], pos[1] - 5 );\n  ctx.fill();\n      ctx.shadowColor = \"transparent\";\n  ctx.textAlign = \"center\";\n  ctx.fillStyle = \"#CEC\";\n  ctx.fillText(text, pos[0], pos[1] - 15 - h * 0.3);\n}\n\n  /**\n   * draws the shape of the given node in the canvas\n   * @method drawNodeShape\n   **/\n  var tmp_area = new Float32Array(4);\n\n  LGraphCanvas.prototype.drawNodeShape = function(\n      node,\n      ctx,\n      size,\n      fgcolor,\n      bgcolor,\n      selected,\n      mouse_over\n  ) {\n      //bg rect\n      ctx.strokeStyle = fgcolor;\n      ctx.fillStyle = bgcolor;\n\n      var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n      var low_quality = this.ds.scale < 0.5;\n\n      //render node area depending on shape\n      var shape =\n          node._shape || node.constructor.shape || LiteGraph.ROUND_SHAPE;\n\n      var title_mode = node.constructor.title_mode;\n\n      var render_title = true;\n      if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n          render_title = false;\n      } else if (title_mode == LiteGraph.AUTOHIDE_TITLE && mouse_over) {\n          render_title = true;\n      }\n\n      var area = tmp_area;\n      area[0] = 0; //x\n      area[1] = render_title ? -title_height : 0; //y\n      area[2] = size[0] + 1; //w\n      area[3] = render_title ? size[1] + title_height : size[1]; //h\n\n      var old_alpha = ctx.globalAlpha;\n\n      //full node shape\n      //if(node.flags.collapsed)\n      {\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n              ctx.fillRect(area[0], area[1], area[2], area[3]);\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              shape == LiteGraph.CARD_SHAPE\n          ) {\n              ctx.roundRect(\n                  area[0],\n                  area[1],\n                  area[2],\n                  area[3],\n                  this.round_radius,\n                  shape == LiteGraph.CARD_SHAPE ? 0 : this.round_radius\n              );\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.fill();\n\n    //separator\n    if(!node.flags.collapsed)\n    {\n      ctx.shadowColor = \"transparent\";\n      ctx.fillStyle = \"rgba(0,0,0,0.2)\";\n      ctx.fillRect(0, -1, area[2], 2);\n    }\n      }\n      ctx.shadowColor = \"transparent\";\n\n      if (node.onDrawBackground) {\n        ctx.mozImageSmoothingEnabled = false;\n        ctx.oImageSmoothingEnabled = false;\n        ctx.webkitImageSmoothingEnabled = false;\n        ctx.msImageSmoothingEnabled = false;\n        ctx.imageSmoothingEnabled = false;\n          node.onDrawBackground(ctx, this, this.canvas);\n      }\n\n      //title bg (remember, it is rendered ABOVE the node)\n      if (render_title || title_mode == LiteGraph.TRANSPARENT_TITLE) {\n          //title bar\n          if (node.onDrawTitleBar) {\n              node.onDrawTitleBar(\n                  ctx,\n                  title_height,\n                  size,\n                  this.ds.scale,\n                  fgcolor\n              );\n          } else if (\n              title_mode != LiteGraph.TRANSPARENT_TITLE &&\n              (node.constructor.title_color || this.render_title_colored)\n          ) {\n              var title_color = node.constructor.title_color || fgcolor;\n\n              if (node.flags.collapsed) {\n                  ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n              }\n\n              //* gradient test\n              if (this.use_gradients) {\n                  var grad = LGraphCanvas.gradients[title_color];\n                  if (!grad) {\n                      grad = LGraphCanvas.gradients[ title_color ] = ctx.createLinearGradient(0, 0, 400, 0);\n                      grad.addColorStop(0, title_color);\n                      grad.addColorStop(1, \"#000\");\n                  }\n                  ctx.fillStyle = grad;\n              } else {\n                  ctx.fillStyle = title_color;\n              }\n\n              //ctx.globalAlpha = 0.5 * old_alpha;\n              ctx.beginPath();\n              if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                  ctx.rect(0, -title_height, size[0] + 1, title_height);\n              } else if (  shape == LiteGraph.ROUND_SHAPE || shape == LiteGraph.CARD_SHAPE ) {\n                  ctx.roundRect(\n                      0,\n                      -title_height,\n                      size[0] + 1,\n                      title_height,\n                      this.round_radius,\n                      node.flags.collapsed ? this.round_radius : 0\n                  );\n              }\n              ctx.fill();\n              ctx.shadowColor = \"transparent\";\n          }\n\n          //title box\n          var box_size = 10;\n          if (node.onDrawTitleBox) {\n              node.onDrawTitleBox(ctx, title_height, size, this.ds.scale);\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              shape == LiteGraph.CIRCLE_SHAPE ||\n              shape == LiteGraph.CARD_SHAPE\n          ) {\n              if (low_quality) {\n                  ctx.fillStyle = \"black\";\n                  ctx.beginPath();\n                  ctx.arc(\n                      title_height * 0.5,\n                      title_height * -0.5,\n                      box_size * 0.5 + 1,\n                      0,\n                      Math.PI * 2\n                  );\n                  ctx.fill();\n              }\n\n              ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n      if(low_quality)\n        ctx.fillRect( title_height * 0.5 - box_size *0.5, title_height * -0.5 - box_size *0.5, box_size , box_size  );\n      else\n      {\n        ctx.beginPath();\n        ctx.arc(\n          title_height * 0.5,\n          title_height * -0.5,\n          box_size * 0.5,\n          0,\n          Math.PI * 2\n        );\n        ctx.fill();\n      }\n          } else {\n              if (low_quality) {\n                  ctx.fillStyle = \"black\";\n                  ctx.fillRect(\n                      (title_height - box_size) * 0.5 - 1,\n                      (title_height + box_size) * -0.5 - 1,\n                      box_size + 2,\n                      box_size + 2\n                  );\n              }\n              ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n              ctx.fillRect(\n                  (title_height - box_size) * 0.5,\n                  (title_height + box_size) * -0.5,\n                  box_size,\n                  box_size\n              );\n          }\n          ctx.globalAlpha = old_alpha;\n\n          //title text\n          if (node.onDrawTitleText) {\n              node.onDrawTitleText(\n                  ctx,\n                  title_height,\n                  size,\n                  this.ds.scale,\n                  this.title_text_font,\n                  selected\n              );\n          }\n          if (!low_quality) {\n              ctx.font = this.title_text_font;\n              var title = node.getTitle();\n              if (title) {\n                  if (selected) {\n                      ctx.fillStyle = \"white\";\n                  } else {\n                      ctx.fillStyle =\n                          node.constructor.title_text_color ||\n                          this.node_title_color;\n                  }\n                  if (node.flags.collapsed) {\n                      ctx.textAlign = \"center\";\n                      var measure = ctx.measureText(title);\n                      ctx.fillText(\n                          title,\n                          title_height + measure.width * 0.5,\n                          LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                      );\n                      ctx.textAlign = \"left\";\n                  } else {\n                      ctx.textAlign = \"left\";\n                      ctx.fillText(\n                          title,\n                          title_height,\n                          LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                      );\n                  }\n              }\n          }\n\n          if (node.onDrawTitle) {\n              node.onDrawTitle(ctx);\n          }\n      }\n\n      //render selection marker\n      if (selected) {\n          if (node.onBounding) {\n              node.onBounding(area);\n          }\n\n          if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n              area[1] -= title_height;\n              area[3] += title_height;\n          }\n          ctx.lineWidth = 1;\n          ctx.globalAlpha = 0.8;\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE) {\n              ctx.rect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3]\n              );\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              (shape == LiteGraph.CARD_SHAPE && node.flags.collapsed)\n          ) {\n              ctx.roundRect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3],\n                  this.round_radius * 2\n              );\n          } else if (shape == LiteGraph.CARD_SHAPE) {\n              ctx.roundRect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3],\n                  this.round_radius * 2,\n                  2\n              );\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5 + 6,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.strokeStyle = \"#FFF\";\n          ctx.stroke();\n          ctx.strokeStyle = fgcolor;\n          ctx.globalAlpha = 1;\n      }\n  };\n\n  var margin_area = new Float32Array(4);\n  var link_bounding = new Float32Array(4);\n  var tempA = new Float32Array(2);\n  var tempB = new Float32Array(2);\n\n  /**\n   * draws every connection visible in the canvas\n   * OPTIMIZE THIS: pre-catch connections position instead of recomputing them every time\n   * @method drawConnections\n   **/\n  LGraphCanvas.prototype.drawConnections = function(ctx) {\n      var now = LiteGraph.getTime();\n      var visible_area = this.visible_area;\n      margin_area[0] = visible_area[0] - 20;\n      margin_area[1] = visible_area[1] - 20;\n      margin_area[2] = visible_area[2] + 40;\n      margin_area[3] = visible_area[3] + 40;\n\n      //draw connections\n      ctx.lineWidth = this.connections_width;\n\n      ctx.fillStyle = \"#AAA\";\n      ctx.strokeStyle = \"#AAA\";\n      ctx.globalAlpha = this.editor_alpha;\n      //for every node\n      var nodes = this.graph._nodes;\n      for (var n = 0, l = nodes.length; n < l; ++n) {\n          var node = nodes[n];\n          //for every input (we render just inputs because it is easier as every slot can only have one input)\n          if (!node.inputs || !node.inputs.length) {\n              continue;\n          }\n\n          for (var i = 0; i < node.inputs.length; ++i) {\n              var input = node.inputs[i];\n              if (!input || input.link == null) {\n                  continue;\n              }\n              var link_id = input.link;\n              var link = this.graph.links[link_id];\n              if (!link) {\n                  continue;\n              }\n\n              //find link info\n              var start_node = this.graph.getNodeById(link.origin_id);\n              if (start_node == null) {\n                  continue;\n              }\n              var start_node_slot = link.origin_slot;\n              var start_node_slotpos = null;\n              if (start_node_slot == -1) {\n                  start_node_slotpos = [\n                      start_node.pos[0] + 10,\n                      start_node.pos[1] + 10\n                  ];\n              } else {\n                  start_node_slotpos = start_node.getConnectionPos(\n                      false,\n                      start_node_slot,\n                      tempA\n                  );\n              }\n              var end_node_slotpos = node.getConnectionPos(true, i, tempB);\n\n              //compute link bounding\n              link_bounding[0] = start_node_slotpos[0];\n              link_bounding[1] = start_node_slotpos[1];\n              link_bounding[2] = end_node_slotpos[0] - start_node_slotpos[0];\n              link_bounding[3] = end_node_slotpos[1] - start_node_slotpos[1];\n              if (link_bounding[2] < 0) {\n                  link_bounding[0] += link_bounding[2];\n                  link_bounding[2] = Math.abs(link_bounding[2]);\n              }\n              if (link_bounding[3] < 0) {\n                  link_bounding[1] += link_bounding[3];\n                  link_bounding[3] = Math.abs(link_bounding[3]);\n              }\n\n              //skip links outside of the visible area of the canvas\n              if (!overlapBounding(link_bounding, margin_area)) {\n                  continue;\n              }\n\n              var start_slot = start_node.outputs[start_node_slot];\n              var end_slot = node.inputs[i];\n              if (!start_slot || !end_slot) {\n                  continue;\n              }\n              var start_dir =\n                  start_slot.dir ||\n                  (start_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT);\n              var end_dir =\n                  end_slot.dir ||\n                  (node.horizontal ? LiteGraph.UP : LiteGraph.LEFT);\n\n              this.renderLink(\n                  ctx,\n                  start_node_slotpos,\n                  end_node_slotpos,\n                  link,\n                  false,\n                  0,\n                  null,\n                  start_dir,\n                  end_dir\n              );\n\n              //event triggered rendered on top\n              if (link && link._last_time && now - link._last_time < 1000) {\n                  var f = 2.0 - (now - link._last_time) * 0.002;\n                  var tmp = ctx.globalAlpha;\n                  ctx.globalAlpha = tmp * f;\n                  this.renderLink(\n                      ctx,\n                      start_node_slotpos,\n                      end_node_slotpos,\n                      link,\n                      true,\n                      f,\n                      \"white\",\n                      start_dir,\n                      end_dir\n                  );\n                  ctx.globalAlpha = tmp;\n              }\n          }\n      }\n      ctx.globalAlpha = 1;\n  };\n\n  /**\n   * draws a link between two points\n   * @method renderLink\n   * @param {vec2} a start pos\n   * @param {vec2} b end pos\n   * @param {Object} link the link object with all the link info\n   * @param {boolean} skip_border ignore the shadow of the link\n   * @param {boolean} flow show flow animation (for events)\n   * @param {string} color the color for the link\n   * @param {number} start_dir the direction enum\n   * @param {number} end_dir the direction enum\n   * @param {number} num_sublines number of sublines (useful to represent vec3 or rgb)\n   **/\n  LGraphCanvas.prototype.renderLink = function(\n      ctx,\n      a,\n      b,\n      link,\n      skip_border,\n      flow,\n      color,\n      start_dir,\n      end_dir,\n      num_sublines\n  ) {\n      if (link) {\n          this.visible_links.push(link);\n      }\n\n      //choose color\n      if (!color && link) {\n          color = link.color || LGraphCanvas.link_type_colors[link.type];\n      }\n      if (!color) {\n          color = this.default_link_color;\n      }\n      if (link != null && this.highlighted_links[link.id]) {\n          color = \"#FFF\";\n      }\n\n      start_dir = start_dir || LiteGraph.RIGHT;\n      end_dir = end_dir || LiteGraph.LEFT;\n\n      var dist = distance(a, b);\n\n      if (this.render_connections_border && this.ds.scale > 0.6) {\n          ctx.lineWidth = this.connections_width + 4;\n      }\n      ctx.lineJoin = \"round\";\n      num_sublines = num_sublines || 1;\n      if (num_sublines > 1) {\n          ctx.lineWidth = 0.5;\n      }\n\n      //begin line shape\n      ctx.beginPath();\n      for (var i = 0; i < num_sublines; i += 1) {\n          var offsety = (i - (num_sublines - 1) * 0.5) * 5;\n\n          if (this.links_render_mode == LiteGraph.SPLINE_LINK) {\n              ctx.moveTo(a[0], a[1] + offsety);\n              var start_offset_x = 0;\n              var start_offset_y = 0;\n              var end_offset_x = 0;\n              var end_offset_y = 0;\n              switch (start_dir) {\n                  case LiteGraph.LEFT:\n                      start_offset_x = dist * -0.25;\n                      break;\n                  case LiteGraph.RIGHT:\n                      start_offset_x = dist * 0.25;\n                      break;\n                  case LiteGraph.UP:\n                      start_offset_y = dist * -0.25;\n                      break;\n                  case LiteGraph.DOWN:\n                      start_offset_y = dist * 0.25;\n                      break;\n              }\n              switch (end_dir) {\n                  case LiteGraph.LEFT:\n                      end_offset_x = dist * -0.25;\n                      break;\n                  case LiteGraph.RIGHT:\n                      end_offset_x = dist * 0.25;\n                      break;\n                  case LiteGraph.UP:\n                      end_offset_y = dist * -0.25;\n                      break;\n                  case LiteGraph.DOWN:\n                      end_offset_y = dist * 0.25;\n                      break;\n              }\n              ctx.bezierCurveTo(\n                  a[0] + start_offset_x,\n                  a[1] + start_offset_y + offsety,\n                  b[0] + end_offset_x,\n                  b[1] + end_offset_y + offsety,\n                  b[0],\n                  b[1] + offsety\n              );\n          } else if (this.links_render_mode == LiteGraph.LINEAR_LINK) {\n              ctx.moveTo(a[0], a[1] + offsety);\n              var start_offset_x = 0;\n              var start_offset_y = 0;\n              var end_offset_x = 0;\n              var end_offset_y = 0;\n              switch (start_dir) {\n                  case LiteGraph.LEFT:\n                      start_offset_x = -1;\n                      break;\n                  case LiteGraph.RIGHT:\n                      start_offset_x = 1;\n                      break;\n                  case LiteGraph.UP:\n                      start_offset_y = -1;\n                      break;\n                  case LiteGraph.DOWN:\n                      start_offset_y = 1;\n                      break;\n              }\n              switch (end_dir) {\n                  case LiteGraph.LEFT:\n                      end_offset_x = -1;\n                      break;\n                  case LiteGraph.RIGHT:\n                      end_offset_x = 1;\n                      break;\n                  case LiteGraph.UP:\n                      end_offset_y = -1;\n                      break;\n                  case LiteGraph.DOWN:\n                      end_offset_y = 1;\n                      break;\n              }\n              var l = 15;\n              ctx.lineTo(\n                  a[0] + start_offset_x * l,\n                  a[1] + start_offset_y * l + offsety\n              );\n              ctx.lineTo(\n                  b[0] + end_offset_x * l,\n                  b[1] + end_offset_y * l + offsety\n              );\n              ctx.lineTo(b[0], b[1] + offsety);\n          } else if (this.links_render_mode == LiteGraph.STRAIGHT_LINK) {\n              ctx.moveTo(a[0], a[1]);\n              var start_x = a[0];\n              var start_y = a[1];\n              var end_x = b[0];\n              var end_y = b[1];\n              if (start_dir == LiteGraph.RIGHT) {\n                  start_x += 10;\n              } else {\n                  start_y += 10;\n              }\n              if (end_dir == LiteGraph.LEFT) {\n                  end_x -= 10;\n              } else {\n                  end_y -= 10;\n              }\n              ctx.lineTo(start_x, start_y);\n              ctx.lineTo((start_x + end_x) * 0.5, start_y);\n              ctx.lineTo((start_x + end_x) * 0.5, end_y);\n              ctx.lineTo(end_x, end_y);\n              ctx.lineTo(b[0], b[1]);\n          } else {\n              return;\n          } //unknown\n      }\n\n      //rendering the outline of the connection can be a little bit slow\n      if (\n          this.render_connections_border &&\n          this.ds.scale > 0.6 &&\n          !skip_border\n      ) {\n          ctx.strokeStyle = \"rgba(0,0,0,0.5)\";\n          ctx.stroke();\n      }\n\n      ctx.lineWidth = this.connections_width;\n      ctx.fillStyle = ctx.strokeStyle = color;\n      ctx.stroke();\n      //end line shape\n\n      var pos = this.computeConnectionPoint(a, b, 0.5, start_dir, end_dir);\n      if (link && link._pos) {\n          link._pos[0] = pos[0];\n          link._pos[1] = pos[1];\n      }\n\n      //render arrow in the middle\n      if (\n          this.ds.scale >= 0.6 &&\n          this.highquality_render &&\n          end_dir != LiteGraph.CENTER\n      ) {\n          //render arrow\n          if (this.render_connection_arrows) {\n              //compute two points in the connection\n              var posA = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.25,\n                  start_dir,\n                  end_dir\n              );\n              var posB = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.26,\n                  start_dir,\n                  end_dir\n              );\n              var posC = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.75,\n                  start_dir,\n                  end_dir\n              );\n              var posD = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.76,\n                  start_dir,\n                  end_dir\n              );\n\n              //compute the angle between them so the arrow points in the right direction\n              var angleA = 0;\n              var angleB = 0;\n              if (this.render_curved_connections) {\n                  angleA = -Math.atan2(posB[0] - posA[0], posB[1] - posA[1]);\n                  angleB = -Math.atan2(posD[0] - posC[0], posD[1] - posC[1]);\n              } else {\n                  angleB = angleA = b[1] > a[1] ? 0 : Math.PI;\n              }\n\n              //render arrow\n              ctx.save();\n              ctx.translate(posA[0], posA[1]);\n              ctx.rotate(angleA);\n              ctx.beginPath();\n              ctx.moveTo(-5, -3);\n              ctx.lineTo(0, +7);\n              ctx.lineTo(+5, -3);\n              ctx.fill();\n              ctx.restore();\n              ctx.save();\n              ctx.translate(posC[0], posC[1]);\n              ctx.rotate(angleB);\n              ctx.beginPath();\n              ctx.moveTo(-5, -3);\n              ctx.lineTo(0, +7);\n              ctx.lineTo(+5, -3);\n              ctx.fill();\n              ctx.restore();\n          }\n\n          //circle\n          ctx.beginPath();\n          ctx.arc(pos[0], pos[1], 5, 0, Math.PI * 2);\n          ctx.fill();\n      }\n\n      //render flowing points\n      if (flow) {\n          ctx.fillStyle = color;\n          for (var i = 0; i < 5; ++i) {\n              var f = (LiteGraph.getTime() * 0.001 + i * 0.2) % 1;\n              var pos = this.computeConnectionPoint(\n                  a,\n                  b,\n                  f,\n                  start_dir,\n                  end_dir\n              );\n              ctx.beginPath();\n              ctx.arc(pos[0], pos[1], 5, 0, 2 * Math.PI);\n              ctx.fill();\n          }\n      }\n  };\n\n  //returns the link center point based on curvature\n  LGraphCanvas.prototype.computeConnectionPoint = function(\n      a,\n      b,\n      t,\n      start_dir,\n      end_dir\n  ) {\n      start_dir = start_dir || LiteGraph.RIGHT;\n      end_dir = end_dir || LiteGraph.LEFT;\n\n      var dist = distance(a, b);\n      var p0 = a;\n      var p1 = [a[0], a[1]];\n      var p2 = [b[0], b[1]];\n      var p3 = b;\n\n      switch (start_dir) {\n          case LiteGraph.LEFT:\n              p1[0] += dist * -0.25;\n              break;\n          case LiteGraph.RIGHT:\n              p1[0] += dist * 0.25;\n              break;\n          case LiteGraph.UP:\n              p1[1] += dist * -0.25;\n              break;\n          case LiteGraph.DOWN:\n              p1[1] += dist * 0.25;\n              break;\n      }\n      switch (end_dir) {\n          case LiteGraph.LEFT:\n              p2[0] += dist * -0.25;\n              break;\n          case LiteGraph.RIGHT:\n              p2[0] += dist * 0.25;\n              break;\n          case LiteGraph.UP:\n              p2[1] += dist * -0.25;\n              break;\n          case LiteGraph.DOWN:\n              p2[1] += dist * 0.25;\n              break;\n      }\n\n      var c1 = (1 - t) * (1 - t) * (1 - t);\n      var c2 = 3 * ((1 - t) * (1 - t)) * t;\n      var c3 = 3 * (1 - t) * (t * t);\n      var c4 = t * t * t;\n\n      var x = c1 * p0[0] + c2 * p1[0] + c3 * p2[0] + c4 * p3[0];\n      var y = c1 * p0[1] + c2 * p1[1] + c3 * p2[1] + c4 * p3[1];\n      return [x, y];\n  };\n\n  LGraphCanvas.prototype.drawExecutionOrder = function(ctx) {\n      ctx.shadowColor = \"transparent\";\n      ctx.globalAlpha = 0.25;\n\n      ctx.textAlign = \"center\";\n      ctx.strokeStyle = \"white\";\n      ctx.globalAlpha = 0.75;\n\n      var visible_nodes = this.visible_nodes;\n      for (var i = 0; i < visible_nodes.length; ++i) {\n          var node = visible_nodes[i];\n          ctx.fillStyle = \"black\";\n          ctx.fillRect(\n              node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT,\n              node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n              LiteGraph.NODE_TITLE_HEIGHT,\n              LiteGraph.NODE_TITLE_HEIGHT\n          );\n          if (node.order == 0) {\n              ctx.strokeRect(\n                  node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                  node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                  LiteGraph.NODE_TITLE_HEIGHT,\n                  LiteGraph.NODE_TITLE_HEIGHT\n              );\n          }\n          ctx.fillStyle = \"#FFF\";\n          ctx.fillText(\n              node.order,\n              node.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * -0.5,\n              node.pos[1] - 6\n          );\n      }\n      ctx.globalAlpha = 1;\n  };\n\n  /**\n   * draws the widgets stored inside a node\n   * @method drawNodeWidgets\n   **/\n  LGraphCanvas.prototype.drawNodeWidgets = function(\n      node,\n      posY,\n      ctx,\n      active_widget\n  ) {\n      if (!node.widgets || !node.widgets.length) {\n          return 0;\n      }\n      var width = node.size[0];\n      var widgets = node.widgets;\n      posY += 2;\n      var H = LiteGraph.NODE_WIDGET_HEIGHT;\n      var show_text = this.ds.scale > 0.5;\n      ctx.save();\n      ctx.globalAlpha = this.editor_alpha;\n      var outline_color = LiteGraph.WIDGET_OUTLINE_COLOR;\n      var background_color = LiteGraph.WIDGET_BGCOLOR;\n      var text_color = LiteGraph.WIDGET_TEXT_COLOR;\n  var secondary_text_color = LiteGraph.WIDGET_SECONDARY_TEXT_COLOR;\n      var margin = 15;\n\n      for (var i = 0; i < widgets.length; ++i) {\n          var w = widgets[i];\n          var y = posY;\n          if (w.y) {\n              y = w.y;\n          }\n          w.last_y = y;\n          ctx.strokeStyle = outline_color;\n          ctx.fillStyle = \"#222\";\n          ctx.textAlign = \"left\";\n    if(w.disabled)\n      ctx.globalAlpha *= 0.5;\n\n          switch (w.type) {\n              case \"button\":\n                  if (w.clicked) {\n                      ctx.fillStyle = \"#AAA\";\n                      w.clicked = false;\n                      this.dirty_canvas = true;\n                  }\n                  ctx.fillRect(margin, y, width - margin * 2, H);\n        if(show_text)\n                    ctx.strokeRect( margin, y, width - margin * 2, H );\n                  if (show_text) {\n                      ctx.textAlign = \"center\";\n                      ctx.fillStyle = text_color;\n                      ctx.fillText(w.name, width * 0.5, y + H * 0.7);\n                  }\n                  break;\n              case \"toggle\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n                  if (show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect(margin, posY, width - margin * 2, H );\n                  ctx.fill();\n        if(show_text)\n                    ctx.stroke();\n                  ctx.fillStyle = w.value ? \"#89A\" : \"#333\";\n                  ctx.beginPath();\n                  ctx.arc( width - margin * 2, y + H * 0.5, H * 0.36, 0, Math.PI * 2 );\n                  ctx.fill();\n                  if (show_text) {\n                      ctx.fillStyle = secondary_text_color;\n                      if (w.name != null) {\n                          ctx.fillText(w.name, margin * 2, y + H * 0.7);\n                      }\n                      ctx.fillStyle = w.value ? text_color : secondary_text_color;\n                      ctx.textAlign = \"right\";\n                      ctx.fillText(\n                          w.value\n                              ? w.options.on || \"true\"\n                              : w.options.off || \"false\",\n                          width - 40,\n                          y + H * 0.7\n                      );\n                  }\n                  break;\n              case \"slider\":\n                  ctx.fillStyle = background_color;\n                  ctx.fillRect(margin, y, width - margin * 2, H);\n                  var range = w.options.max - w.options.min;\n                  var nvalue = (w.value - w.options.min) / range;\n                  ctx.fillStyle = active_widget == w ? \"#89A\" : \"#678\";\n                  ctx.fillRect(margin, y, nvalue * (width - margin * 2), H);\n        if(show_text)\n                    ctx.strokeRect(margin, y, width - margin * 2, H);\n                  if (w.marker) {\n                      var marker_nvalue = (w.marker - w.options.min) / range;\n                      ctx.fillStyle = \"#AA9\";\n                      ctx.fillRect( margin + marker_nvalue * (width - margin * 2), y, 2, H );\n                  }\n                  if (show_text) {\n                      ctx.textAlign = \"center\";\n                      ctx.fillStyle = text_color;\n                      ctx.fillText(\n                          w.name + \"  \" + Number(w.value).toFixed(3),\n                          width * 0.5,\n                          y + H * 0.7\n                      );\n                  }\n                  break;\n              case \"number\":\n              case \"combo\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n        if(show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect(margin, posY, width - margin * 2, H );\n                  ctx.fill();\n                  if (show_text) {\n                    ctx.stroke();\n                      ctx.fillStyle = text_color;\n                      ctx.beginPath();\n                      ctx.moveTo(margin + 16, posY + 5);\n                      ctx.lineTo(margin + 6, posY + H * 0.5);\n                      ctx.lineTo(margin + 16, posY + H - 5);\n                      ctx.fill();\n                      ctx.beginPath();\n                      ctx.moveTo(width - margin - 16, posY + 5);\n                      ctx.lineTo(width - margin - 6, posY + H * 0.5);\n                      ctx.lineTo(width - margin - 16, posY + H - 5);\n                      ctx.fill();\n                      ctx.fillStyle = secondary_text_color;\n                      ctx.fillText(w.name, margin * 2 + 5, y + H * 0.7);\n                      ctx.fillStyle = text_color;\n                      ctx.textAlign = \"right\";\n                      if (w.type == \"number\") {\n                          ctx.fillText(\n                              Number(w.value).toFixed(\n                                  w.options.precision !== undefined\n                                      ? w.options.precision\n                                      : 3\n                              ),\n                              width - margin * 2 - 20,\n                              y + H * 0.7\n                          );\n                      } else {\n                          ctx.fillText(\n                              w.value,\n                              width - margin * 2 - 20,\n                              y + H * 0.7\n                          );\n                      }\n                  }\n                  break;\n              case \"string\":\n              case \"text\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n                  if (show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect( margin, posY, width - margin * 2, H );\n                  ctx.fill();\n                  if (show_text) {\n                    ctx.stroke();\n                      ctx.fillStyle = secondary_text_color;\n                      if (w.name != null) {\n                          ctx.fillText(w.name, margin * 2, y + H * 0.7);\n                      }\n                      ctx.fillStyle = text_color;\n                      ctx.textAlign = \"right\";\n                      ctx.fillText(w.value, width - margin * 2, y + H * 0.7);\n                  }\n                  break;\n              default:\n                  if (w.draw) {\n                      w.draw(ctx, node, w, y, H);\n                  }\n                  break;\n          }\n          posY += H + 4;\n    ctx.globalAlpha = this.editor_alpha;\n\n      }\n      ctx.restore();\n  ctx.textAlign = \"left\";\n  };\n\n  /**\n   * process an event on widgets\n   * @method processNodeWidgets\n   **/\n  LGraphCanvas.prototype.processNodeWidgets = function(\n      node,\n      pos,\n      event,\n      active_widget\n  ) {\n      if (!node.widgets || !node.widgets.length) {\n          return null;\n      }\n\n      var x = pos[0] - node.pos[0];\n      var y = pos[1] - node.pos[1];\n      var width = node.size[0];\n      var that = this;\n      var ref_window = this.getCanvasWindow();\n\n      for (var i = 0; i < node.widgets.length; ++i) {\n          var w = node.widgets[i];\n    if(w.disabled)\n      continue;\n          if ( w == active_widget || (x > 6 && x < width - 12 && y > w.last_y && y < w.last_y + LiteGraph.NODE_WIDGET_HEIGHT) ) {\n              //inside widget\n              switch (w.type) {\n                  case \"button\":\n                      if (event.type === \"mousemove\") {\n                          break;\n                      }\n                      if (w.callback) {\n                          setTimeout(function() {\n                              w.callback(w, that, node, pos, event);\n                          }, 20);\n                      }\n                      w.clicked = true;\n                      this.dirty_canvas = true;\n                      break;\n                  case \"slider\":\n                      var range = w.options.max - w.options.min;\n                      var nvalue = Math.clamp((x - 10) / (width - 20), 0, 1);\n                      w.value =\n                          w.options.min +\n                          (w.options.max - w.options.min) * nvalue;\n                      if (w.callback) {\n                          setTimeout(function() {\n                              inner_value_change(w, w.value);\n                          }, 20);\n                      }\n                      this.dirty_canvas = true;\n                      break;\n                  case \"number\":\n                  case \"combo\":\n          var old_value = w.value;\n                      if (event.type == \"mousemove\" && w.type == \"number\") {\n                          w.value +=\n                              event.deltaX * 0.1 * (w.options.step || 1);\n                          if (\n                              w.options.min != null &&\n                              w.value < w.options.min\n                          ) {\n                              w.value = w.options.min;\n                          }\n                          if (\n                              w.options.max != null &&\n                              w.value > w.options.max\n                          ) {\n                              w.value = w.options.max;\n                          }\n                      } else if (event.type == \"mousedown\") {\n                          var values = w.options.values;\n                          if (values && values.constructor === Function) {\n                              values = w.options.values(w, node);\n                          }\n\n                          var delta = x < 40 ? -1 : x > width - 40 ? 1 : 0;\n                          if (w.type == \"number\") {\n                              w.value += delta * 0.1 * (w.options.step || 1);\n                              if (\n                                  w.options.min != null &&\n                                  w.value < w.options.min\n                              ) {\n                                  w.value = w.options.min;\n                              }\n                              if (\n                                  w.options.max != null &&\n                                  w.value > w.options.max\n                              ) {\n                                  w.value = w.options.max;\n                              }\n                          } else if (delta) {\n                              var index = values.indexOf(w.value) + delta;\n                              if (index >= values.length) {\n                                  index = 0;\n                              }\n                              if (index < 0) {\n                                  index = values.length - 1;\n                              }\n                              w.value = values[index];\n                          } else {\n                              var menu = new LiteGraph.ContextMenu(\n                                  values,\n                                  {\n                                      scale: Math.max(1, this.ds.scale),\n                                      event: event,\n                                      className: \"dark\",\n                                      callback: inner_clicked.bind(w)\n                                  },\n                                  ref_window\n                              );\n                              function inner_clicked(v, option, event) {\n                                  this.value = v;\n                                  inner_value_change(this, v);\n                                  that.dirty_canvas = true;\n                                  return false;\n                              }\n                          }\n                      } //mousedown\n\n          if( old_value != w.value )\n            setTimeout(\n              function() {\n                inner_value_change(this, this.value);\n              }.bind(w),\n              20\n            );\n                      this.dirty_canvas = true;\n                      break;\n                  case \"toggle\":\n                      if (event.type == \"mousedown\") {\n                          w.value = !w.value;\n            setTimeout(function() {\n              inner_value_change(w, w.value);\n                          }, 20);\n                      }\n                      break;\n                  case \"string\":\n                  case \"text\":\n                      if (event.type == \"mousedown\") {\n                          this.prompt(\n                              \"Value\",\n                              w.value,\n                              function(v) {\n                                  this.value = v;\n                                  inner_value_change(this, v);\n                              }.bind(w),\n                              event\n                          );\n                      }\n                      break;\n                  default:\n                      if (w.mouse) {\n                          w.mouse(ctx, event, [x, y], node);\n                      }\n                      break;\n              } //end switch\n\n              return w;\n          }\n      }\n\n      function inner_value_change(widget, value) {\n          widget.value = value;\n          if ( widget.options && widget.options.property && node.properties[widget.options.property] !== undefined ) {\n              node.setProperty( widget.options.property, value );\n          }\n          if (widget.callback) {\n              widget.callback(widget.value, that, node, pos, event);\n          }\n      }\n\n      return null;\n  };\n\n  /**\n   * draws every group area in the background\n   * @method drawGroups\n   **/\n  LGraphCanvas.prototype.drawGroups = function(canvas, ctx) {\n      if (!this.graph) {\n          return;\n      }\n\n      var groups = this.graph._groups;\n\n      ctx.save();\n      ctx.globalAlpha = 0.5 * this.editor_alpha;\n\n      for (var i = 0; i < groups.length; ++i) {\n          var group = groups[i];\n\n          if (!overlapBounding(this.visible_area, group._bounding)) {\n              continue;\n          } //out of the visible area\n\n          ctx.fillStyle = group.color || \"#335\";\n          ctx.strokeStyle = group.color || \"#335\";\n          var pos = group._pos;\n          var size = group._size;\n          ctx.globalAlpha = 0.25 * this.editor_alpha;\n          ctx.beginPath();\n          ctx.rect(pos[0] + 0.5, pos[1] + 0.5, size[0], size[1]);\n          ctx.fill();\n          ctx.globalAlpha = this.editor_alpha;\n          ctx.stroke();\n\n          ctx.beginPath();\n          ctx.moveTo(pos[0] + size[0], pos[1] + size[1]);\n          ctx.lineTo(pos[0] + size[0] - 10, pos[1] + size[1]);\n          ctx.lineTo(pos[0] + size[0], pos[1] + size[1] - 10);\n          ctx.fill();\n\n          var font_size =\n              group.font_size || LiteGraph.DEFAULT_GROUP_FONT_SIZE;\n          ctx.font = font_size + \"px Arial\";\n          ctx.fillText(group.title, pos[0] + 4, pos[1] + font_size);\n      }\n\n      ctx.restore();\n  };\n\n  LGraphCanvas.prototype.adjustNodesSize = function() {\n      var nodes = this.graph._nodes;\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].size = nodes[i].computeSize();\n      }\n      this.setDirty(true, true);\n  };\n\n  /**\n   * resizes the canvas to a given size, if no size is passed, then it tries to fill the parentNode\n   * @method resize\n   **/\n  LGraphCanvas.prototype.resize = function(width, height) {\n      if (!width && !height) {\n          var parent = this.canvas.parentNode;\n          width = parent.offsetWidth;\n          height = parent.offsetHeight;\n      }\n\n      if (this.canvas.width == width && this.canvas.height == height) {\n          return;\n      }\n\n      this.canvas.width = width;\n      this.canvas.height = height;\n      this.bgcanvas.width = this.canvas.width;\n      this.bgcanvas.height = this.canvas.height;\n      this.setDirty(true, true);\n  };\n\n  /**\n   * switches to live mode (node shapes are not rendered, only the content)\n   * this feature was designed when graphs where meant to create user interfaces\n   * @method switchLiveMode\n   **/\n  LGraphCanvas.prototype.switchLiveMode = function(transition) {\n      if (!transition) {\n          this.live_mode = !this.live_mode;\n          this.dirty_canvas = true;\n          this.dirty_bgcanvas = true;\n          return;\n      }\n\n      var self = this;\n      var delta = this.live_mode ? 1.1 : 0.9;\n      if (this.live_mode) {\n          this.live_mode = false;\n          this.editor_alpha = 0.1;\n      }\n\n      var t = setInterval(function() {\n          self.editor_alpha *= delta;\n          self.dirty_canvas = true;\n          self.dirty_bgcanvas = true;\n\n          if (delta < 1 && self.editor_alpha < 0.01) {\n              clearInterval(t);\n              if (delta < 1) {\n                  self.live_mode = true;\n              }\n          }\n          if (delta > 1 && self.editor_alpha > 0.99) {\n              clearInterval(t);\n              self.editor_alpha = 1;\n          }\n      }, 1);\n  };\n\n  LGraphCanvas.prototype.onNodeSelectionChange = function(node) {\n      return; //disabled\n  };\n\n  LGraphCanvas.prototype.touchHandler = function(event) {\n      //alert(\"foo\");\n      var touches = event.changedTouches,\n          first = touches[0],\n          type = \"\";\n\n      switch (event.type) {\n          case \"touchstart\":\n              type = \"mousedown\";\n              break;\n          case \"touchmove\":\n              type = \"mousemove\";\n              break;\n          case \"touchend\":\n              type = \"mouseup\";\n              break;\n          default:\n              return;\n      }\n\n      //initMouseEvent(type, canBubble, cancelable, view, clickCount,\n      //           screenX, screenY, clientX, clientY, ctrlKey,\n      //           altKey, shiftKey, metaKey, button, relatedTarget);\n      var window = this.getCanvasWindow();\n      var document = window.document;\n\n      var simulatedEvent = document.createEvent(\"MouseEvent\");\n      simulatedEvent.initMouseEvent(\n          type,\n          true,\n          true,\n          window,\n          1,\n          first.screenX,\n          first.screenY,\n          first.clientX,\n          first.clientY,\n          false,\n          false,\n          false,\n          false,\n          0 /*left*/,\n          null\n      );\n      first.target.dispatchEvent(simulatedEvent);\n      event.preventDefault();\n  };\n\n  /* CONTEXT MENU ********************/\n\n  LGraphCanvas.onGroupAdd = function(info, entry, mouse_event) {\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var group = new LiteGraph.LGraphGroup();\n      group.pos = canvas.convertEventToCanvasOffset(mouse_event);\n      canvas.graph.add(group);\n  };\n\n  LGraphCanvas.onMenuAdd = function(node, options, e, prev_menu, callback) {\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var values = LiteGraph.getNodeTypesCategories( canvas.filter );\n      var entries = [];\n      for (var i in values) {\n          if (values[i]) {\n              entries.push({ value: values[i], content: values[i], has_submenu: true });\n          }\n      }\n\n      //show categories\n      var menu = new LiteGraph.ContextMenu( entries, { event: e, callback: inner_clicked, parentMenu: prev_menu }, ref_window );\n\n      function inner_clicked(v, option, e) {\n          var category = v.value;\n          var node_types = LiteGraph.getNodeTypesInCategory( category, canvas.filter );\n          var values = [];\n          for (var i in node_types) {\n              if (!node_types[i].skip_list) {\n                  values.push({\n                      content: node_types[i].title,\n                      value: node_types[i].type\n                  });\n              }\n          }\n\n          new LiteGraph.ContextMenu( values, { event: e, callback: inner_create, parentMenu: menu }, ref_window );\n          return false;\n      }\n\n      function inner_create(v, e) {\n          var first_event = prev_menu.getFirstEvent();\n          var node = LiteGraph.createNode(v.value);\n          if (node) {\n              node.pos = canvas.convertEventToCanvasOffset(first_event);\n              canvas.graph.add(node);\n          }\n    if(callback)\n      callback(node);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuCollapseAll = function() {};\n\n  LGraphCanvas.onMenuNodeEdit = function() {};\n\n  LGraphCanvas.showMenuNodeOptionalInputs = function(\n      v,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var options = node.optional_inputs;\n      if (node.onGetInputs) {\n          options = node.onGetInputs();\n      }\n\n      var entries = [];\n      if (options) {\n          for (var i in options) {\n              var entry = options[i];\n              if (!entry) {\n                  entries.push(null);\n                  continue;\n              }\n              var label = entry[0];\n              if (entry[2] && entry[2].label) {\n                  label = entry[2].label;\n              }\n              var data = { content: label, value: entry };\n              if (entry[1] == LiteGraph.ACTION) {\n                  data.className = \"event\";\n              }\n              entries.push(data);\n          }\n      }\n\n      if (this.onMenuNodeInputs) {\n          entries = this.onMenuNodeInputs(entries);\n      }\n\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, e, prev) {\n          if (!node) {\n              return;\n          }\n\n          if (v.callback) {\n              v.callback.call(that, node, v, e, prev);\n          }\n\n          if (v.value) {\n              node.addInput(v.value[0], v.value[1], v.value[2]);\n              node.setDirtyCanvas(true, true);\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.showMenuNodeOptionalOutputs = function(\n      v,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var options = node.optional_outputs;\n      if (node.onGetOutputs) {\n          options = node.onGetOutputs();\n      }\n\n      var entries = [];\n      if (options) {\n          for (var i in options) {\n              var entry = options[i];\n              if (!entry) {\n                  //separator?\n                  entries.push(null);\n                  continue;\n              }\n\n              if (\n                  node.flags &&\n                  node.flags.skip_repeated_outputs &&\n                  node.findOutputSlot(entry[0]) != -1\n              ) {\n                  continue;\n              } //skip the ones already on\n              var label = entry[0];\n              if (entry[2] && entry[2].label) {\n                  label = entry[2].label;\n              }\n              var data = { content: label, value: entry };\n              if (entry[1] == LiteGraph.EVENT) {\n                  data.className = \"event\";\n              }\n              entries.push(data);\n          }\n      }\n\n      if (this.onMenuNodeOutputs) {\n          entries = this.onMenuNodeOutputs(entries);\n      }\n\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, e, prev) {\n          if (!node) {\n              return;\n          }\n\n          if (v.callback) {\n              v.callback.call(that, node, v, e, prev);\n          }\n\n          if (!v.value) {\n              return;\n          }\n\n          var value = v.value[1];\n\n          if (\n              value &&\n              (value.constructor === Object || value.constructor === Array)\n          ) {\n              //submenu why?\n              var entries = [];\n              for (var i in value) {\n                  entries.push({ content: i, value: value[i] });\n              }\n              new LiteGraph.ContextMenu(entries, {\n                  event: e,\n                  callback: inner_clicked,\n                  parentMenu: prev_menu,\n                  node: node\n              });\n              return false;\n          } else {\n              node.addOutput(v.value[0], v.value[1], v.value[2]);\n              node.setDirtyCanvas(true, true);\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onShowMenuNodeProperties = function(\n      value,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node || !node.properties) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var entries = [];\n      for (var i in node.properties) {\n          var value = node.properties[i] !== undefined ? node.properties[i] : \" \";\n    if( typeof value == \"object\" )\n      value = JSON.stringify(value);\n          //value could contain invalid html characters, clean that\n          value = LGraphCanvas.decodeHTML(value);\n          entries.push({\n              content:\n                  \"<span class='property_name'>\" +\n                  i +\n                  \"</span>\" +\n                  \"<span class='property_value'>\" +\n                  value +\n                  \"</span>\",\n              value: i\n          });\n      }\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              allow_html: true,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, options, e, prev) {\n          if (!node) {\n              return;\n          }\n          var rect = this.getBoundingClientRect();\n          canvas.showEditPropertyValue(node, v.value, {\n              position: [rect.left, rect.top]\n          });\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.decodeHTML = function(str) {\n      var e = document.createElement(\"div\");\n      e.innerText = str;\n      return e.innerHTML;\n  };\n\n  LGraphCanvas.onResizeNode = function(value, options, e, menu, node) {\n      if (!node) {\n          return;\n      }\n      node.size = node.computeSize();\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.prototype.showLinkMenu = function(link, e) {\n      var that = this;\n  console.log(link);\n  var options = [\"Add Node\",null,\"Delete\"];\n      var menu = new LiteGraph.ContextMenu(options, {\n          event: e,\n    title: link.data != null ? link.data.constructor.name : null,\n          callback: inner_clicked\n      });\n\n      function inner_clicked(v,options,e) {\n          switch (v) {\n              case \"Add Node\":\n        LGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n          console.log(\"node autoconnect\");\n          var node_left = that.graph.getNodeById( link.origin_id );\n          var node_right = that.graph.getNodeById( link.target_id );\n          if(!node.inputs || !node.inputs.length || !node.outputs || !node.outputs.length)\n            return;\n          if( node_left.outputs[ link.origin_slot ].type == node.inputs[0].type && node.outputs[0].type == node_right.inputs[0].type )\n          {\n            node_left.connect( link.origin_slot, node, 0 );\n            node.connect( 0, node_right, link.target_slot );\n            node.pos[0] -= node.size[0] * 0.5;\n          }\n        });\n        break;\n              case \"Delete\":\n                  that.graph.removeLink(link.id);\n                  break;\n              default:\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onShowPropertyEditor = function(item, options, e, menu, node) {\n      var input_html = \"\";\n      var property = item.property || \"title\";\n      var value = node[property];\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog\";\n      dialog.innerHTML =\n          \"<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>\";\n      var title = dialog.querySelector(\".name\");\n      title.innerText = property;\n      var input = dialog.querySelector(\"input\");\n      if (input) {\n          input.value = value;\n          input.addEventListener(\"blur\", function(e) {\n              this.focus();\n          });\n          input.addEventListener(\"keydown\", function(e) {\n              if (e.keyCode != 13) {\n                  return;\n              }\n              inner();\n              e.preventDefault();\n              e.stopPropagation();\n          });\n      }\n\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n\n      var rect = canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", inner);\n      canvas.parentNode.appendChild(dialog);\n\n      function inner() {\n          setValue(input.value);\n      }\n\n      function setValue(value) {\n          if (item.type == \"Number\") {\n              value = Number(value);\n          } else if (item.type == \"Boolean\") {\n              value = Boolean(value);\n          }\n          node[property] = value;\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n          node.setDirtyCanvas(true, true);\n      }\n  };\n\n  LGraphCanvas.prototype.prompt = function(title, value, callback, event) {\n      var that = this;\n      var input_html = \"\";\n      title = title || \"\";\n\n      var modified = false;\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog rounded\";\n      dialog.innerHTML =\n          \"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>\";\n      dialog.close = function() {\n          that.prompt_box = null;\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n      };\n\n      if (this.ds.scale > 1) {\n          dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n      }\n\n      dialog.addEventListener(\"mouseleave\", function(e) {\n          if (!modified) {\n              dialog.close();\n          }\n      });\n\n      if (that.prompt_box) {\n          that.prompt_box.close();\n      }\n      that.prompt_box = dialog;\n\n      var first = null;\n      var timeout = null;\n      var selected = null;\n\n      var name_element = dialog.querySelector(\".name\");\n      name_element.innerText = title;\n      var value_element = dialog.querySelector(\".value\");\n      value_element.value = value;\n\n      var input = dialog.querySelector(\"input\");\n      input.addEventListener(\"keydown\", function(e) {\n          modified = true;\n          if (e.keyCode == 27) {\n              //ESC\n              dialog.close();\n          } else if (e.keyCode == 13) {\n              if (callback) {\n                  callback(this.value);\n              }\n              dialog.close();\n          } else {\n              return;\n          }\n          e.preventDefault();\n          e.stopPropagation();\n      });\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", function(e) {\n          if (callback) {\n              callback(input.value);\n          }\n          that.setDirty(true);\n          dialog.close();\n      });\n\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n\n      var rect = canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n\n      canvas.parentNode.appendChild(dialog);\n      setTimeout(function() {\n          input.focus();\n      }, 10);\n\n      return dialog;\n  };\n\n  LGraphCanvas.search_limit = -1;\n  LGraphCanvas.prototype.showSearchBox = function(event) {\n      var that = this;\n      var input_html = \"\";\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n      var root_document = canvas.ownerDocument || document;\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"litegraph litesearchbox graphdialog rounded\";\n      dialog.innerHTML =\n          \"<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>\";\n      dialog.close = function() {\n          that.search_box = null;\n          root_document.body.focus();\n    root_document.body.style.overflow = \"\";\n\n          setTimeout(function() {\n              that.canvas.focus();\n          }, 20); //important, if canvas loses focus keys wont be captured\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n      };\n\n      var timeout_close = null;\n\n      if (this.ds.scale > 1) {\n          dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n      }\n\n      dialog.addEventListener(\"mouseenter\", function(e) {\n          if (timeout_close) {\n              clearTimeout(timeout_close);\n              timeout_close = null;\n          }\n      });\n\n      dialog.addEventListener(\"mouseleave\", function(e) {\n          //dialog.close();\n          timeout_close = setTimeout(function() {\n              dialog.close();\n          }, 500);\n      });\n\n      if (that.search_box) {\n          that.search_box.close();\n      }\n      that.search_box = dialog;\n\n      var helper = dialog.querySelector(\".helper\");\n\n      var first = null;\n      var timeout = null;\n      var selected = null;\n\n      var input = dialog.querySelector(\"input\");\n      if (input) {\n          input.addEventListener(\"blur\", function(e) {\n              this.focus();\n          });\n          input.addEventListener(\"keydown\", function(e) {\n              if (e.keyCode == 38) {\n                  //UP\n                  changeSelection(false);\n              } else if (e.keyCode == 40) {\n                  //DOWN\n                  changeSelection(true);\n              } else if (e.keyCode == 27) {\n                  //ESC\n                  dialog.close();\n              } else if (e.keyCode == 13) {\n                  if (selected) {\n                      select(selected.innerHTML);\n                  } else if (first) {\n                      select(first);\n                  } else {\n                      dialog.close();\n                  }\n              } else {\n                  if (timeout) {\n                      clearInterval(timeout);\n                  }\n                  timeout = setTimeout(refreshHelper, 10);\n                  return;\n              }\n              e.preventDefault();\n              e.stopPropagation();\n      e.stopImmediatePropagation();\n      return true;\n          });\n      }\n\n  if( root_document.fullscreenElement )\n        root_document.fullscreenElement.appendChild(dialog);\n  else\n  {\n      root_document.body.appendChild(dialog);\n    root_document.body.style.overflow = \"hidden\";\n  }\n\n      //compute best position\n      var rect = canvas.getBoundingClientRect();\n\n      var left = ( event ? event.clientX : (rect.left + rect.width * 0.5) ) - 80;\n      var top = ( event ? event.clientY : (rect.top + rect.height * 0.5) ) - 20;\n      dialog.style.left = left + \"px\";\n      dialog.style.top = top + \"px\";\n\n  //To avoid out of screen problems\n  if(event.layerY > (rect.height - 200)) \n          helper.style.maxHeight = (rect.height - event.layerY - 20) + \"px\";\n\n  /*\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n      canvas.parentNode.appendChild(dialog);\n  */\n\n      input.focus();\n\n      function select(name) {\n          if (name) {\n              if (that.onSearchBoxSelection) {\n                  that.onSearchBoxSelection(name, event, graphcanvas);\n              } else {\n                  var extra = LiteGraph.searchbox_extras[name.toLowerCase()];\n                  if (extra) {\n                      name = extra.type;\n                  }\n\n                  var node = LiteGraph.createNode(name);\n                  if (node) {\n                      node.pos = graphcanvas.convertEventToCanvasOffset(\n                          event\n                      );\n                      graphcanvas.graph.add(node);\n                  }\n\n                  if (extra && extra.data) {\n                      if (extra.data.properties) {\n                          for (var i in extra.data.properties) {\n                              node.addProperty( i, extra.data.properties[i] );\n                          }\n                      }\n                      if (extra.data.inputs) {\n                          node.inputs = [];\n                          for (var i in extra.data.inputs) {\n                              node.addOutput(\n                                  extra.data.inputs[i][0],\n                                  extra.data.inputs[i][1]\n                              );\n                          }\n                      }\n                      if (extra.data.outputs) {\n                          node.outputs = [];\n                          for (var i in extra.data.outputs) {\n                              node.addOutput(\n                                  extra.data.outputs[i][0],\n                                  extra.data.outputs[i][1]\n                              );\n                          }\n                      }\n                      if (extra.data.title) {\n                          node.title = extra.data.title;\n                      }\n                      if (extra.data.json) {\n                          node.configure(extra.data.json);\n                      }\n                  }\n              }\n          }\n\n          dialog.close();\n      }\n\n      function changeSelection(forward) {\n          var prev = selected;\n          if (selected) {\n              selected.classList.remove(\"selected\");\n          }\n          if (!selected) {\n              selected = forward\n                  ? helper.childNodes[0]\n                  : helper.childNodes[helper.childNodes.length];\n          } else {\n              selected = forward\n                  ? selected.nextSibling\n                  : selected.previousSibling;\n              if (!selected) {\n                  selected = prev;\n              }\n          }\n          if (!selected) {\n              return;\n          }\n          selected.classList.add(\"selected\");\n          selected.scrollIntoView({block: \"end\", behavior: \"smooth\"});\n      }\n\n      function refreshHelper() {\n          timeout = null;\n          var str = input.value;\n          first = null;\n          helper.innerHTML = \"\";\n          if (!str) {\n              return;\n          }\n\n          if (that.onSearchBox) {\n              var list = that.onSearchBox(helper, str, graphcanvas);\n              if (list) {\n                  for (var i = 0; i < list.length; ++i) {\n                      addResult(list[i]);\n                  }\n              }\n          } else {\n              var c = 0;\n              str = str.toLowerCase();\n      var filter = graphcanvas.filter || graphcanvas.graph.filter;\n\n              //extras\n              for (var i in LiteGraph.searchbox_extras) {\n                  var extra = LiteGraph.searchbox_extras[i];\n                  if (extra.desc.toLowerCase().indexOf(str) === -1) {\n                      continue;\n                  }\n        var ctor = LiteGraph.registered_node_types[ extra.type ];\n        if( ctor && ctor.filter && ctor.filter != filter )\n          continue;\n                  addResult( extra.desc, \"searchbox_extra\" );\n                  if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                      break;\n                  }\n              }\n\n      var filtered = null;\n              if (Array.prototype.filter) { //filter supported\n                  var keys = Object.keys( LiteGraph.registered_node_types ); //types\n                  var filtered = keys.filter( inner_test_filter );\n              } else {\n        filtered = [];\n                  for (var i in LiteGraph.registered_node_types) {\n          if( inner_test_filter(i) )\n            filtered.push(i);\n                  }\n              }\n\n      for (var i = 0; i < filtered.length; i++) {\n        addResult(filtered[i]);\n        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n          break;\n        }\n      }\n\n      function inner_test_filter( type )\n      {\n        var ctor = LiteGraph.registered_node_types[ type ];\n        if(filter && ctor.filter != filter )\n          return false;\n        return type.toLowerCase().indexOf(str) !== -1;\n      }\n          }\n\n          function addResult(type, className) {\n              var help = document.createElement(\"div\");\n              if (!first) {\n                  first = type;\n              }\n              help.innerText = type;\n              help.dataset[\"type\"] = escape(type);\n              help.className = \"litegraph lite-search-item\";\n              if (className) {\n                  help.className += \" \" + className;\n              }\n              help.addEventListener(\"click\", function(e) {\n                  select(unescape(this.dataset[\"type\"]));\n              });\n              helper.appendChild(help);\n          }\n      }\n\n      return dialog;\n  };\n\n  LGraphCanvas.prototype.showEditPropertyValue = function(\n      node,\n      property,\n      options\n  ) {\n      if (!node || node.properties[property] === undefined) {\n          return;\n      }\n\n      options = options || {};\n      var that = this;\n\n      var type = \"string\";\n\n      if (node.properties[property] !== null) {\n          type = typeof node.properties[property];\n      }\n\n      var info = null;\n      if (node.getPropertyInfo) {\n          info = node.getPropertyInfo(property);\n      }\n      if (node.properties_info) {\n          for (var i = 0; i < node.properties_info.length; ++i) {\n              if (node.properties_info[i].name == property) {\n                  info = node.properties_info[i];\n                  break;\n              }\n          }\n      }\n\n      if (info !== undefined && info !== null && info.type) {\n          type = info.type;\n      }\n\n      var input_html = \"\";\n\n      if (type == \"string\" || type == \"number\" || type == \"array\" || type == \"object\") {\n          input_html = \"<input autofocus type='text' class='value'/>\";\n      } else if (type == \"enum\" && info.values) {\n          input_html = \"<select autofocus type='text' class='value'>\";\n          for (var i in info.values) {\n              var v = info.values.constructor === Array ? info.values[i] : i;\n              input_html +=\n                  \"<option value='\" +\n                  v +\n                  \"' \" +\n                  (v == node.properties[property] ? \"selected\" : \"\") +\n                  \">\" +\n                  info.values[i] +\n                  \"</option>\";\n          }\n          input_html += \"</select>\";\n      } else if (type == \"boolean\") {\n          input_html =\n              \"<input autofocus type='checkbox' class='value' \" +\n              (node.properties[property] ? \"checked\" : \"\") +\n              \"/>\";\n      } else {\n          console.warn(\"unknown type: \" + type);\n          return;\n      }\n\n      var dialog = this.createDialog(\n          \"<span class='name'>\" +\n              property +\n              \"</span>\" +\n              input_html +\n              \"<button>OK</button>\",\n          options\n      );\n\n      if (type == \"enum\" && info.values) {\n          var input = dialog.querySelector(\"select\");\n          input.addEventListener(\"change\", function(e) {\n              setValue(e.target.value);\n              //var index = e.target.value;\n              //setValue( e.options[e.selectedIndex].value );\n          });\n      } else if (type == \"boolean\") {\n          var input = dialog.querySelector(\"input\");\n          if (input) {\n              input.addEventListener(\"click\", function(e) {\n                  setValue(!!input.checked);\n              });\n          }\n      } else {\n          var input = dialog.querySelector(\"input\");\n          if (input) {\n              input.addEventListener(\"blur\", function(e) {\n                  this.focus();\n              });\n      var v = node.properties[property] !== undefined ? node.properties[property] : \"\";\n      v = JSON.stringify(v);\n              input.value = v;\n              input.addEventListener(\"keydown\", function(e) {\n                  if (e.keyCode != 13) {\n                      return;\n                  }\n                  inner();\n                  e.preventDefault();\n                  e.stopPropagation();\n              });\n          }\n      }\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", inner);\n\n      function inner() {\n          setValue(input.value);\n      }\n\n      function setValue(value) {\n          if (typeof node.properties[property] == \"number\") {\n              value = Number(value);\n          }\n          if (type == \"array\" || type == \"object\") {\n              value = JSON.parse(value);\n          }\n          node.properties[property] = value;\n          if (node._graph) {\n              node._graph._version++;\n          }\n          if (node.onPropertyChanged) {\n              node.onPropertyChanged(property, value);\n          }\n          dialog.close();\n          node.setDirtyCanvas(true, true);\n      }\n  };\n\n  LGraphCanvas.prototype.createDialog = function(html, options) {\n      options = options || {};\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog\";\n      dialog.innerHTML = html;\n\n      var rect = this.canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (options.position) {\n          offsetx += options.position[0];\n          offsety += options.position[1];\n      } else if (options.event) {\n          offsetx += options.event.clientX;\n          offsety += options.event.clientY;\n      } //centered\n      else {\n          offsetx += this.canvas.width * 0.5;\n          offsety += this.canvas.height * 0.5;\n      }\n\n      dialog.style.left = offsetx + \"px\";\n      dialog.style.top = offsety + \"px\";\n\n      this.canvas.parentNode.appendChild(dialog);\n\n      dialog.close = function() {\n          if (this.parentNode) {\n              this.parentNode.removeChild(this);\n          }\n      };\n\n      return dialog;\n  };\n\n  LGraphCanvas.onMenuNodeCollapse = function(value, options, e, menu, node) {\n      node.collapse();\n  };\n\n  LGraphCanvas.onMenuNodePin = function(value, options, e, menu, node) {\n      node.pin();\n  };\n\n  LGraphCanvas.onMenuNodeMode = function(value, options, e, menu, node) {\n      new LiteGraph.ContextMenu(\n          [\"Always\", \"On Event\", \"On Trigger\", \"Never\"],\n          { event: e, callback: inner_clicked, parentMenu: menu, node: node }\n      );\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n          switch (v) {\n              case \"On Event\":\n                  node.mode = LiteGraph.ON_EVENT;\n                  break;\n              case \"On Trigger\":\n                  node.mode = LiteGraph.ON_TRIGGER;\n                  break;\n              case \"Never\":\n                  node.mode = LiteGraph.NEVER;\n                  break;\n              case \"Always\":\n              default:\n                  node.mode = LiteGraph.ALWAYS;\n                  break;\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeColors = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node for color\";\n      }\n\n      var values = [];\n      values.push({\n          value: null,\n          content:\n              \"<span style='display: block; padding-left: 4px;'>No color</span>\"\n      });\n\n      for (var i in LGraphCanvas.node_colors) {\n          var color = LGraphCanvas.node_colors[i];\n          var value = {\n              value: i,\n              content:\n                  \"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid \" +\n                  color.color +\n                  \"; background-color:\" +\n                  color.bgcolor +\n                  \"'>\" +\n                  i +\n                  \"</span>\"\n          };\n          values.push(value);\n      }\n      new LiteGraph.ContextMenu(values, {\n          event: e,\n          callback: inner_clicked,\n          parentMenu: menu,\n          node: node\n      });\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n\n          var color = v.value ? LGraphCanvas.node_colors[v.value] : null;\n          if (color) {\n              if (node.constructor === LiteGraph.LGraphGroup) {\n                  node.color = color.groupcolor;\n              } else {\n                  node.color = color.color;\n                  node.bgcolor = color.bgcolor;\n              }\n          } else {\n              delete node.color;\n              delete node.bgcolor;\n          }\n          node.setDirtyCanvas(true, true);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeShapes = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node passed\";\n      }\n\n      new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES, {\n          event: e,\n          callback: inner_clicked,\n          parentMenu: menu,\n          node: node\n      });\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n          node.shape = v;\n          node.setDirtyCanvas(true);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeRemove = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node passed\";\n      }\n\n      if (node.removable === false) {\n          return;\n      }\n\n      node.graph.remove(node);\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.onMenuNodeClone = function(value, options, e, menu, node) {\n      if (node.clonable == false) {\n          return;\n      }\n      var newnode = node.clone();\n      if (!newnode) {\n          return;\n      }\n      newnode.pos = [node.pos[0] + 5, node.pos[1] + 5];\n      node.graph.add(newnode);\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.node_colors = {\n      red: { color: \"#322\", bgcolor: \"#533\", groupcolor: \"#A88\" },\n      brown: { color: \"#332922\", bgcolor: \"#593930\", groupcolor: \"#b06634\" },\n      green: { color: \"#232\", bgcolor: \"#353\", groupcolor: \"#8A8\" },\n      blue: { color: \"#223\", bgcolor: \"#335\", groupcolor: \"#88A\" },\n      pale_blue: {\n          color: \"#2a363b\",\n          bgcolor: \"#3f5159\",\n          groupcolor: \"#3f789e\"\n      },\n      cyan: { color: \"#233\", bgcolor: \"#355\", groupcolor: \"#8AA\" },\n      purple: { color: \"#323\", bgcolor: \"#535\", groupcolor: \"#a1309b\" },\n      yellow: { color: \"#432\", bgcolor: \"#653\", groupcolor: \"#b58b2a\" },\n      black: { color: \"#222\", bgcolor: \"#000\", groupcolor: \"#444\" }\n  };\n\n  LGraphCanvas.prototype.getCanvasMenuOptions = function() {\n      var options = null;\n      if (this.getMenuOptions) {\n          options = this.getMenuOptions();\n      } else {\n          options = [\n              {\n                  content: \"Add Node\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuAdd\n              },\n              { content: \"Add Group\", callback: LGraphCanvas.onGroupAdd }\n              //{content:\"Collapse All\", callback: LGraphCanvas.onMenuCollapseAll }\n          ];\n\n          if (this._graph_stack && this._graph_stack.length > 0) {\n              options.push(null, {\n                  content: \"Close subgraph\",\n                  callback: this.closeSubgraph.bind(this)\n              });\n          }\n      }\n\n      if (this.getExtraMenuOptions) {\n          var extra = this.getExtraMenuOptions(this, options);\n          if (extra) {\n              options = options.concat(extra);\n          }\n      }\n\n      return options;\n  };\n\n  //called by processContextMenu to extract the menu list\n  LGraphCanvas.prototype.getNodeMenuOptions = function(node) {\n      var options = null;\n\n      if (node.getMenuOptions) {\n          options = node.getMenuOptions(this);\n      } else {\n          options = [\n              {\n                  content: \"Inputs\",\n                  has_submenu: true,\n                  disabled: true,\n                  callback: LGraphCanvas.showMenuNodeOptionalInputs\n              },\n              {\n                  content: \"Outputs\",\n                  has_submenu: true,\n                  disabled: true,\n                  callback: LGraphCanvas.showMenuNodeOptionalOutputs\n              },\n              null,\n              {\n                  content: \"Properties\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onShowMenuNodeProperties\n              },\n              null,\n              {\n                  content: \"Title\",\n                  callback: LGraphCanvas.onShowPropertyEditor\n              },\n              {\n                  content: \"Mode\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeMode\n              },\n              { content: \"Resize\", callback: LGraphCanvas.onResizeNode },\n              {\n                  content: \"Collapse\",\n                  callback: LGraphCanvas.onMenuNodeCollapse\n              },\n              { content: \"Pin\", callback: LGraphCanvas.onMenuNodePin },\n              {\n                  content: \"Colors\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeColors\n              },\n              {\n                  content: \"Shapes\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeShapes\n              },\n              null\n          ];\n      }\n\n      if (node.onGetInputs) {\n          var inputs = node.onGetInputs();\n          if (inputs && inputs.length) {\n              options[0].disabled = false;\n          }\n      }\n\n      if (node.onGetOutputs) {\n          var outputs = node.onGetOutputs();\n          if (outputs && outputs.length) {\n              options[1].disabled = false;\n          }\n      }\n\n      if (node.getExtraMenuOptions) {\n          var extra = node.getExtraMenuOptions(this);\n          if (extra) {\n              extra.push(null);\n              options = extra.concat(options);\n          }\n      }\n\n      if (node.clonable !== false) {\n          options.push({\n              content: \"Clone\",\n              callback: LGraphCanvas.onMenuNodeClone\n          });\n      }\n      if (node.removable !== false) {\n          options.push(null, {\n              content: \"Remove\",\n              callback: LGraphCanvas.onMenuNodeRemove\n          });\n      }\n\n      if (node.graph && node.graph.onGetNodeMenuOptions) {\n          node.graph.onGetNodeMenuOptions(options, node);\n      }\n\n      return options;\n  };\n\n  LGraphCanvas.prototype.getGroupMenuOptions = function(node) {\n      var o = [\n          { content: \"Title\", callback: LGraphCanvas.onShowPropertyEditor },\n          {\n              content: \"Color\",\n              has_submenu: true,\n              callback: LGraphCanvas.onMenuNodeColors\n          },\n          {\n              content: \"Font size\",\n              property: \"font_size\",\n              type: \"Number\",\n              callback: LGraphCanvas.onShowPropertyEditor\n          },\n          null,\n          { content: \"Remove\", callback: LGraphCanvas.onMenuNodeRemove }\n      ];\n\n      return o;\n  };\n\n  LGraphCanvas.prototype.processContextMenu = function(node, event) {\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var menu_info = null;\n      var options = {\n          event: event,\n          callback: inner_option_clicked,\n          extra: node\n      };\n\n  if(node)\n    options.title = node.type;\n\n      //check if mouse is in input\n      var slot = null;\n      if (node) {\n          slot = node.getSlotInPosition(event.canvasX, event.canvasY);\n          LGraphCanvas.active_node = node;\n      }\n\n      if (slot) {\n          //on slot\n          menu_info = [];\n          if (\n              slot &&\n              slot.output &&\n              slot.output.links &&\n              slot.output.links.length\n          ) {\n              menu_info.push({ content: \"Disconnect Links\", slot: slot });\n          }\n          var _slot = slot.input || slot.output;\n          menu_info.push(\n              _slot.locked\n                  ? \"Cannot remove\"\n                  : { content: \"Remove Slot\", slot: slot }\n          );\n          menu_info.push(\n              _slot.nameLocked\n                  ? \"Cannot rename\"\n                  : { content: \"Rename Slot\", slot: slot }\n          );\n          options.title =\n              (slot.input ? slot.input.type : slot.output.type) || \"*\";\n          if (slot.input && slot.input.type == LiteGraph.ACTION) {\n              options.title = \"Action\";\n          }\n          if (slot.output && slot.output.type == LiteGraph.EVENT) {\n              options.title = \"Event\";\n          }\n      } else {\n          if (node) {\n              //on node\n              menu_info = this.getNodeMenuOptions(node);\n          } else {\n              menu_info = this.getCanvasMenuOptions();\n              var group = this.graph.getGroupOnPos(\n                  event.canvasX,\n                  event.canvasY\n              );\n              if (group) {\n                  //on group\n                  menu_info.push(null, {\n                      content: \"Edit Group\",\n                      has_submenu: true,\n                      submenu: {\n                          title: \"Group\",\n                          extra: group,\n                          options: this.getGroupMenuOptions(group)\n                      }\n                  });\n              }\n          }\n      }\n\n      //show menu\n      if (!menu_info) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(menu_info, options, ref_window);\n\n      function inner_option_clicked(v, options, e) {\n          if (!v) {\n              return;\n          }\n\n          if (v.content == \"Remove Slot\") {\n              var info = v.slot;\n              if (info.input) {\n                  node.removeInput(info.slot);\n              } else if (info.output) {\n                  node.removeOutput(info.slot);\n              }\n              return;\n          } else if (v.content == \"Disconnect Links\") {\n              var info = v.slot;\n              if (info.output) {\n                  node.disconnectOutput(info.slot);\n              } else if (info.input) {\n                  node.disconnectInput(info.slot);\n              }\n              return;\n          } else if (v.content == \"Rename Slot\") {\n              var info = v.slot;\n              var slot_info = info.input\n                  ? node.getInputInfo(info.slot)\n                  : node.getOutputInfo(info.slot);\n              var dialog = that.createDialog(\n                  \"<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>\",\n                  options\n              );\n              var input = dialog.querySelector(\"input\");\n              if (input && slot_info) {\n                  input.value = slot_info.label || \"\";\n              }\n              dialog\n                  .querySelector(\"button\")\n                  .addEventListener(\"click\", function(e) {\n                      if (input.value) {\n                          if (slot_info) {\n                              slot_info.label = input.value;\n                          }\n                          that.setDirty(true);\n                      }\n                      dialog.close();\n                  });\n          }\n\n          //if(v.callback)\n          //\treturn v.callback.call(that, node, options, e, menu, that, event );\n      }\n  };\n\n  //API *************************************************\n  //like rect but rounded corners\n  if (this.CanvasRenderingContext2D) {\n      CanvasRenderingContext2D.prototype.roundRect = function(\n          x,\n          y,\n          width,\n          height,\n          radius,\n          radius_low\n      ) {\n          if (radius === undefined) {\n              radius = 5;\n          }\n\n          if (radius_low === undefined) {\n              radius_low = radius;\n          }\n\n          this.moveTo(x + radius, y);\n          this.lineTo(x + width - radius, y);\n          this.quadraticCurveTo(x + width, y, x + width, y + radius);\n\n          this.lineTo(x + width, y + height - radius_low);\n          this.quadraticCurveTo(\n              x + width,\n              y + height,\n              x + width - radius_low,\n              y + height\n          );\n          this.lineTo(x + radius_low, y + height);\n          this.quadraticCurveTo(x, y + height, x, y + height - radius_low);\n          this.lineTo(x, y + radius);\n          this.quadraticCurveTo(x, y, x + radius, y);\n      };\n  }\n\n  function compareObjects(a, b) {\n      for (var i in a) {\n          if (a[i] != b[i]) {\n              return false;\n          }\n      }\n      return true;\n  }\n  LiteGraph.compareObjects = compareObjects;\n\n  function distance(a, b) {\n      return Math.sqrt(\n          (b[0] - a[0]) * (b[0] - a[0]) + (b[1] - a[1]) * (b[1] - a[1])\n      );\n  }\n  LiteGraph.distance = distance;\n\n  function colorToString(c) {\n      return (\n          \"rgba(\" +\n          Math.round(c[0] * 255).toFixed() +\n          \",\" +\n          Math.round(c[1] * 255).toFixed() +\n          \",\" +\n          Math.round(c[2] * 255).toFixed() +\n          \",\" +\n          (c.length == 4 ? c[3].toFixed(2) : \"1.0\") +\n          \")\"\n      );\n  }\n  LiteGraph.colorToString = colorToString;\n\n  function isInsideRectangle(x, y, left, top, width, height) {\n      if (left < x && left + width > x && top < y && top + height > y) {\n          return true;\n      }\n      return false;\n  }\n  LiteGraph.isInsideRectangle = isInsideRectangle;\n\n  //[minx,miny,maxx,maxy]\n  function growBounding(bounding, x, y) {\n      if (x < bounding[0]) {\n          bounding[0] = x;\n      } else if (x > bounding[2]) {\n          bounding[2] = x;\n      }\n\n      if (y < bounding[1]) {\n          bounding[1] = y;\n      } else if (y > bounding[3]) {\n          bounding[3] = y;\n      }\n  }\n  LiteGraph.growBounding = growBounding;\n\n  //point inside bounding box\n  function isInsideBounding(p, bb) {\n      if (\n          p[0] < bb[0][0] ||\n          p[1] < bb[0][1] ||\n          p[0] > bb[1][0] ||\n          p[1] > bb[1][1]\n      ) {\n          return false;\n      }\n      return true;\n  }\n  LiteGraph.isInsideBounding = isInsideBounding;\n\n  //bounding overlap, format: [ startx, starty, width, height ]\n  function overlapBounding(a, b) {\n      var A_end_x = a[0] + a[2];\n      var A_end_y = a[1] + a[3];\n      var B_end_x = b[0] + b[2];\n      var B_end_y = b[1] + b[3];\n\n      if (\n          a[0] > B_end_x ||\n          a[1] > B_end_y ||\n          A_end_x < b[0] ||\n          A_end_y < b[1]\n      ) {\n          return false;\n      }\n      return true;\n  }\n  LiteGraph.overlapBounding = overlapBounding;\n\n  //Convert a hex value to its decimal value - the inputted hex must be in the\n  //\tformat of a hex triplet - the kind we use for HTML colours. The function\n  //\twill return an array with three values.\n  function hex2num(hex) {\n      if (hex.charAt(0) == \"#\") {\n          hex = hex.slice(1);\n      } //Remove the '#' char - if there is one.\n      hex = hex.toUpperCase();\n      var hex_alphabets = \"0123456789ABCDEF\";\n      var value = new Array(3);\n      var k = 0;\n      var int1, int2;\n      for (var i = 0; i < 6; i += 2) {\n          int1 = hex_alphabets.indexOf(hex.charAt(i));\n          int2 = hex_alphabets.indexOf(hex.charAt(i + 1));\n          value[k] = int1 * 16 + int2;\n          k++;\n      }\n      return value;\n  }\n\n  LiteGraph.hex2num = hex2num;\n\n  //Give a array with three values as the argument and the function will return\n  //\tthe corresponding hex triplet.\n  function num2hex(triplet) {\n      var hex_alphabets = \"0123456789ABCDEF\";\n      var hex = \"#\";\n      var int1, int2;\n      for (var i = 0; i < 3; i++) {\n          int1 = triplet[i] / 16;\n          int2 = triplet[i] % 16;\n\n          hex += hex_alphabets.charAt(int1) + hex_alphabets.charAt(int2);\n      }\n      return hex;\n  }\n\n  LiteGraph.num2hex = num2hex;\n\n  /* LiteGraph GUI elements used for canvas editing *************************************/\n\n  /**\n   * ContextMenu from LiteGUI\n   *\n   * @class ContextMenu\n   * @constructor\n   * @param {Array} values (allows object { title: \"Nice text\", callback: function ... })\n   * @param {Object} options [optional] Some options:\\\n   * - title: title to show on top of the menu\n   * - callback: function to call when an option is clicked, it receives the item information\n   * - ignore_item_callbacks: ignores the callback inside the item, it just calls the options.callback\n   * - event: you can pass a MouseEvent, this way the ContextMenu appears in that position\n   */\n  function ContextMenu(values, options) {\n      options = options || {};\n      this.options = options;\n      var that = this;\n\n      //to link a menu with its parent\n      if (options.parentMenu) {\n          if (options.parentMenu.constructor !== this.constructor) {\n              console.error(\n                  \"parentMenu must be of class ContextMenu, ignoring it\"\n              );\n              options.parentMenu = null;\n          } else {\n              this.parentMenu = options.parentMenu;\n              this.parentMenu.lock = true;\n              this.parentMenu.current_submenu = this;\n          }\n      }\n\n      if (\n          options.event &&\n          options.event.constructor !== MouseEvent &&\n          options.event.constructor !== CustomEvent &&\n    options.event.constructor !== PointerEvent\n      ) {\n          console.error(\n              \"Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it.\"\n          );\n          options.event = null;\n      }\n\n      var root = document.createElement(\"div\");\n      root.className = \"litegraph litecontextmenu litemenubar-panel\";\n      if (options.className) {\n          root.className += \" \" + options.className;\n      }\n      root.style.minWidth = 100;\n      root.style.minHeight = 100;\n      root.style.pointerEvents = \"none\";\n      setTimeout(function() {\n          root.style.pointerEvents = \"auto\";\n      }, 100); //delay so the mouse up event is not caught by this element\n\n      //this prevents the default context browser menu to open in case this menu was created when pressing right button\n      root.addEventListener(\n          \"mouseup\",\n          function(e) {\n              e.preventDefault();\n              return true;\n          },\n          true\n      );\n      root.addEventListener(\n          \"contextmenu\",\n          function(e) {\n              if (e.button != 2) {\n                  //right button\n                  return false;\n              }\n              e.preventDefault();\n              return false;\n          },\n          true\n      );\n\n      root.addEventListener(\n          \"mousedown\",\n          function(e) {\n              if (e.button == 2) {\n                  that.close();\n                  e.preventDefault();\n                  return true;\n              }\n          },\n          true\n      );\n\n      function on_mouse_wheel(e) {\n          var pos = parseInt(root.style.top);\n          root.style.top =\n              (pos + e.deltaY * options.scroll_speed).toFixed() + \"px\";\n          e.preventDefault();\n          return true;\n      }\n\n      if (!options.scroll_speed) {\n          options.scroll_speed = 0.1;\n      }\n\n      root.addEventListener(\"wheel\", on_mouse_wheel, true);\n      root.addEventListener(\"mousewheel\", on_mouse_wheel, true);\n\n      this.root = root;\n\n      //title\n      if (options.title) {\n          var element = document.createElement(\"div\");\n          element.className = \"litemenu-title\";\n          element.innerHTML = options.title;\n          root.appendChild(element);\n      }\n\n      //entries\n      var num = 0;\n      for (var i in values) {\n          var name = values.constructor == Array ? values[i] : i;\n          if (name != null && name.constructor !== String) {\n              name = name.content === undefined ? String(name) : name.content;\n          }\n          var value = values[i];\n          this.addItem(name, value, options);\n          num++;\n      }\n\n      //close on leave\n      root.addEventListener(\"mouseleave\", function(e) {\n          if (that.lock) {\n              return;\n          }\n          if (root.closing_timer) {\n              clearTimeout(root.closing_timer);\n          }\n          root.closing_timer = setTimeout(that.close.bind(that, e), 500);\n          //that.close(e);\n      });\n\n      root.addEventListener(\"mouseenter\", function(e) {\n          if (root.closing_timer) {\n              clearTimeout(root.closing_timer);\n          }\n      });\n\n      //insert before checking position\n      var root_document = document;\n      if (options.event) {\n          root_document = options.event.target.ownerDocument;\n      }\n\n      if (!root_document) {\n          root_document = document;\n      }\n\n  if( root_document.fullscreenElement )\n        root_document.fullscreenElement.appendChild(root);\n  else\n      root_document.body.appendChild(root);\n\n      //compute best position\n      var left = options.left || 0;\n      var top = options.top || 0;\n      if (options.event) {\n          left = options.event.clientX - 10;\n          top = options.event.clientY - 10;\n          if (options.title) {\n              top -= 20;\n          }\n\n          if (options.parentMenu) {\n              var rect = options.parentMenu.root.getBoundingClientRect();\n              left = rect.left + rect.width;\n          }\n\n          var body_rect = document.body.getBoundingClientRect();\n          var root_rect = root.getBoundingClientRect();\n\n          if (left > body_rect.width - root_rect.width - 10) {\n              left = body_rect.width - root_rect.width - 10;\n          }\n          if (top > body_rect.height - root_rect.height - 10) {\n              top = body_rect.height - root_rect.height - 10;\n          }\n      }\n\n      root.style.left = left + \"px\";\n      root.style.top = top + \"px\";\n\n      if (options.scale) {\n          root.style.transform = \"scale(\" + options.scale + \")\";\n      }\n  }\n\n  ContextMenu.prototype.addItem = function(name, value, options) {\n      var that = this;\n      options = options || {};\n\n      var element = document.createElement(\"div\");\n      element.className = \"litemenu-entry submenu\";\n\n      var disabled = false;\n\n      if (value === null) {\n          element.classList.add(\"separator\");\n          //element.innerHTML = \"<hr/>\"\n          //continue;\n      } else {\n          element.innerHTML = value && value.title ? value.title : name;\n          element.value = value;\n\n          if (value) {\n              if (value.disabled) {\n                  disabled = true;\n                  element.classList.add(\"disabled\");\n              }\n              if (value.submenu || value.has_submenu) {\n                  element.classList.add(\"has_submenu\");\n              }\n          }\n\n          if (typeof value == \"function\") {\n              element.dataset[\"value\"] = name;\n              element.onclick_callback = value;\n          } else {\n              element.dataset[\"value\"] = value;\n          }\n\n          if (value.className) {\n              element.className += \" \" + value.className;\n          }\n      }\n\n      this.root.appendChild(element);\n      if (!disabled) {\n          element.addEventListener(\"click\", inner_onclick);\n      }\n      if (options.autoopen) {\n          element.addEventListener(\"mouseenter\", inner_over);\n      }\n\n      function inner_over(e) {\n          var value = this.value;\n          if (!value || !value.has_submenu) {\n              return;\n          }\n          //if it is a submenu, autoopen like the item was clicked\n          inner_onclick.call(this, e);\n      }\n\n      //menu option clicked\n      function inner_onclick(e) {\n          var value = this.value;\n          var close_parent = true;\n\n          if (that.current_submenu) {\n              that.current_submenu.close(e);\n          }\n\n          //global callback\n          if (options.callback) {\n              var r = options.callback.call(\n                  this,\n                  value,\n                  options,\n                  e,\n                  that,\n                  options.node\n              );\n              if (r === true) {\n                  close_parent = false;\n              }\n          }\n\n          //special cases\n          if (value) {\n              if (\n                  value.callback &&\n                  !options.ignore_item_callbacks &&\n                  value.disabled !== true\n              ) {\n                  //item callback\n                  var r = value.callback.call(\n                      this,\n                      value,\n                      options,\n                      e,\n                      that,\n                      options.extra\n                  );\n                  if (r === true) {\n                      close_parent = false;\n                  }\n              }\n              if (value.submenu) {\n                  if (!value.submenu.options) {\n                      throw \"ContextMenu submenu needs options\";\n                  }\n                  var submenu = new that.constructor(value.submenu.options, {\n                      callback: value.submenu.callback,\n                      event: e,\n                      parentMenu: that,\n                      ignore_item_callbacks:\n                          value.submenu.ignore_item_callbacks,\n                      title: value.submenu.title,\n                      extra: value.submenu.extra,\n                      autoopen: options.autoopen\n                  });\n                  close_parent = false;\n              }\n          }\n\n          if (close_parent && !that.lock) {\n              that.close();\n          }\n      }\n\n      return element;\n  };\n\n  ContextMenu.prototype.close = function(e, ignore_parent_menu) {\n      if (this.root.parentNode) {\n          this.root.parentNode.removeChild(this.root);\n      }\n      if (this.parentMenu && !ignore_parent_menu) {\n          this.parentMenu.lock = false;\n          this.parentMenu.current_submenu = null;\n          if (e === undefined) {\n              this.parentMenu.close();\n          } else if (\n              e &&\n              !ContextMenu.isCursorOverElement(e, this.parentMenu.root)\n          ) {\n              ContextMenu.trigger(this.parentMenu.root, \"mouseleave\", e);\n          }\n      }\n      if (this.current_submenu) {\n          this.current_submenu.close(e, true);\n      }\n\n      if (this.root.closing_timer) {\n          clearTimeout(this.root.closing_timer);\n      }\n  };\n\n  //this code is used to trigger events easily (used in the context menu mouseleave\n  ContextMenu.trigger = function(element, event_name, params, origin) {\n      var evt = document.createEvent(\"CustomEvent\");\n      evt.initCustomEvent(event_name, true, true, params); //canBubble, cancelable, detail\n      evt.srcElement = origin;\n      if (element.dispatchEvent) {\n          element.dispatchEvent(evt);\n      } else if (element.__events) {\n          element.__events.dispatchEvent(evt);\n      }\n      //else nothing seems binded here so nothing to do\n      return evt;\n  };\n\n  //returns the top most menu\n  ContextMenu.prototype.getTopMenu = function() {\n      if (this.options.parentMenu) {\n          return this.options.parentMenu.getTopMenu();\n      }\n      return this;\n  };\n\n  ContextMenu.prototype.getFirstEvent = function() {\n      if (this.options.parentMenu) {\n          return this.options.parentMenu.getFirstEvent();\n      }\n      return this.options.event;\n  };\n\n  ContextMenu.isCursorOverElement = function(event, element) {\n      var left = event.clientX;\n      var top = event.clientY;\n      var rect = element.getBoundingClientRect();\n      if (!rect) {\n          return false;\n      }\n      if (\n          top > rect.top &&\n          top < rect.top + rect.height &&\n          left > rect.left &&\n          left < rect.left + rect.width\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  LiteGraph.ContextMenu = ContextMenu;\n\n  LiteGraph.closeAllContextMenus = function(ref_window) {\n      ref_window = ref_window || window;\n\n      var elements = ref_window.document.querySelectorAll(\".litecontextmenu\");\n      if (!elements.length) {\n          return;\n      }\n\n      var result = [];\n      for (var i = 0; i < elements.length; i++) {\n          result.push(elements[i]);\n      }\n\n      for (var i in result) {\n          if (result[i].close) {\n              result[i].close();\n          } else if (result[i].parentNode) {\n              result[i].parentNode.removeChild(result[i]);\n          }\n      }\n  };\n\n  LiteGraph.extendClass = function(target, origin) {\n      for (var i in origin) {\n          //copy class properties\n          if (target.hasOwnProperty(i)) {\n              continue;\n          }\n          target[i] = origin[i];\n      }\n\n      if (origin.prototype) {\n          //copy prototype properties\n          for (var i in origin.prototype) {\n              //only enumerable\n              if (!origin.prototype.hasOwnProperty(i)) {\n                  continue;\n              }\n\n              if (target.prototype.hasOwnProperty(i)) {\n                  //avoid overwriting existing ones\n                  continue;\n              }\n\n              //copy getters\n              if (origin.prototype.__lookupGetter__(i)) {\n                  target.prototype.__defineGetter__(\n                      i,\n                      origin.prototype.__lookupGetter__(i)\n                  );\n              } else {\n                  target.prototype[i] = origin.prototype[i];\n              }\n\n              //and setters\n              if (origin.prototype.__lookupSetter__(i)) {\n                  target.prototype.__defineSetter__(\n                      i,\n                      origin.prototype.__lookupSetter__(i)\n                  );\n              }\n          }\n      }\n  };\n\n//used by some widgets to render a curve editor\nfunction CurveEditor( points )\n{\n  this.points = points;\n  this.selected = -1;\n  this.nearest = -1;\n  this.size = null; //stores last size used\n  this.must_update = true;\n  this.margin = 5;\n}\n\nCurveEditor.sampleCurve = function(f,points)\n{\n  if(!points)\n    return;\n  for(var i = 0; i < points.length - 1; ++i)\n  {\n    var p = points[i];\n    var pn = points[i+1];\n    if(pn[0] < f)\n      continue;\n    var r = (pn[0] - p[0]);\n    if( Math.abs(r) < 0.00001 )\n      return p[1];\n    var local_f = (f - p[0]) / r;\n    return p[1] * (1.0 - local_f) + pn[1] * local_f;\n  }\n  return 0;\n}\n\nCurveEditor.prototype.draw = function( ctx, size, graphcanvas, background_color, line_color, inactive )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  this.size = size;\n  var w = size[0] - this.margin * 2;\n  var h = size[1] - this.margin * 2;\n\n  line_color = line_color || \"#666\";\n\n  ctx.save();\n  ctx.translate(this.margin,this.margin);\n\n  if(background_color)\n  {\n    ctx.fillStyle = \"#111\";\n    ctx.fillRect(0,0,w,h);\n    ctx.fillStyle = \"#222\";\n    ctx.fillRect(w*0.5,0,1,h);\n    ctx.strokeStyle = \"#333\";\n    ctx.strokeRect(0,0,w,h);\n  }\n  ctx.strokeStyle = line_color;\n  if(inactive)\n    ctx.globalAlpha = 0.5;\n  ctx.beginPath();\n  for(var i = 0; i < points.length; ++i)\n  {\n    var p = points[i];\n    ctx.lineTo( p[0] * w, (1.0 - p[1]) * h );\n  }\n  ctx.stroke();\n  ctx.globalAlpha = 1;\n  if(!inactive)\n    for(var i = 0; i < points.length; ++i)\n    {\n      var p = points[i];\n      ctx.fillStyle = this.selected == i ? \"#FFF\" : (this.nearest == i ? \"#DDD\" : \"#AAA\");\n      ctx.beginPath();\n      ctx.arc( p[0] * w, (1.0 - p[1]) * h, 2, 0, Math.PI * 2 );\n      ctx.fill();\n    }\n  ctx.restore();\n}\n\n//localpos is mouse in curve editor space\nCurveEditor.prototype.onMouseDown = function( localpos, graphcanvas )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  if( localpos[1] < 0 )\n    return;\n\n  //this.captureInput(true);\n  var w = this.size[0] - this.margin * 2;\n  var h = this.size[1] - this.margin * 2;\n  var x = localpos[0] - this.margin;\n  var y = localpos[1] - this.margin;\n  var pos = [x,y];\n  var max_dist = 30 / graphcanvas.ds.scale;\n  //search closer one\n  this.selected = this.getCloserPoint(pos, max_dist);\n  //create one\n  if(this.selected == -1)\n  {\n    var point = [x / w, 1 - y / h];\n    points.push(point);\n    points.sort(function(a,b){ return a[0] - b[0]; });\n    this.selected = points.indexOf(point);\n    this.must_update = true;\n  }\n  if(this.selected != -1)\n    return true;\n}\n\nCurveEditor.prototype.onMouseMove = function( localpos, graphcanvas )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  var s = this.selected;\n  if(s < 0)\n    return;\n  var x = (localpos[0] - this.margin) / (this.size[0] - this.margin * 2 );\n  var y = (localpos[1] - this.margin) / (this.size[1] - this.margin * 2 );\n  var curvepos = [(localpos[0] - this.margin),(localpos[1] - this.margin)];\n  var max_dist = 30 / graphcanvas.ds.scale;\n  this._nearest = this.getCloserPoint(curvepos, max_dist);\n  var point = points[s];\n  if(point)\n  {\n    var is_edge_point = s == 0 || s == points.length - 1;\n    if( !is_edge_point && (localpos[0] < -10 || localpos[0] > this.size[0] + 10 || localpos[1] < -10 || localpos[1] > this.size[1] + 10) )\n    {\n      points.splice(s,1);\n      this.selected = -1;\n      return;\n    }\n    if( !is_edge_point ) //not edges\n      point[0] = Math.clamp(x,0,1);\n    else\n      point[0] = s == 0 ? 0 : 1;\n    point[1] = 1.0 - Math.clamp(y,0,1);\n    points.sort(function(a,b){ return a[0] - b[0]; });\n    this.selected = points.indexOf(point);\n    this.must_update = true;\n  }\n}\n\nCurveEditor.prototype.onMouseUp = function( localpos, graphcanvas )\n{\n  this.selected = -1;\n  return false;\n}\n\nCurveEditor.prototype.getCloserPoint = function(pos, max_dist)\n{\n  var points = this.points;\n  if(!points)\n    return -1;\n  max_dist = max_dist || 30;\n  var w = (this.size[0] - this.margin * 2);\n  var h = (this.size[1] - this.margin * 2);\n  var num = points.length;\n  var p2 = [0,0];\n  var min_dist = 1000000;\n  var closest = -1;\n  var last_valid = -1;\n  for(var i = 0; i < num; ++i)\n  {\n    var p = points[i];\n    p2[0] = p[0] * w;\n    p2[1] = (1.0 - p[1]) * h;\n    if(p2[0] < pos[0])\n      last_valid = i;\n    var dist = vec2.distance(pos,p2);\n    if(dist > min_dist || dist > max_dist)\n      continue;\n    closest = i;\n    min_dist = dist;\n  }\n  return closest;\n}\n\nLiteGraph.CurveEditor = CurveEditor;\n\n  //used to create nodes from wrapping functions\n  LiteGraph.getParameterNames = function(func) {\n      return (func + \"\")\n          .replace(/[/][/].*$/gm, \"\") // strip single-line comments\n          .replace(/\\s+/g, \"\") // strip white space\n          .replace(/[/][*][^/*]*[*][/]/g, \"\") // strip multi-line comments  /**/\n          .split(\"){\", 1)[0]\n          .replace(/^[^(]*[(]/, \"\") // extract the parameters\n          .replace(/=[^,]+/g, \"\") // strip any ES6 defaults\n          .split(\",\")\n          .filter(Boolean); // split & filter [\"\"]\n  };\n\n  Math.clamp = function(v, a, b) {\n      return a > v ? a : b < v ? b : v;\n  };\n\n  if (typeof window != \"undefined\" && !window[\"requestAnimationFrame\"]) {\n      window.requestAnimationFrame =\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame ||\n          function(callback) {\n              window.setTimeout(callback, 1000 / 60);\n          };\n  }\n})(this);\n\nif (typeof exports != \"undefined\") {\n  exports.LiteGraph = this.LiteGraph;\n}\n","import GoldenLayout from 'golden-layout';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n// import Markdown from 'react-markdown';\nimport './css/main.css';\nimport 'litegraph.js/css/litegraph.css'\nimport AceEditor from 'react-ace';\nimport 'brace/mode/glsl';\nimport 'brace/theme/tomorrow_night_eighties';\nimport 'brace/ext/language_tools';\n// import { JSONEditor } from 'react-json-editor-viewer';\nimport * as dat from 'dat.gui';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n// import { vec2, vec3, vec4, mat2, mat3, mat4, quat } from 'gl-matrix';\nimport { Modal, Button, FormControl, Dropdown, DropdownButton } from 'react-bootstrap';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils';\n// import { RoughnessMipmapper } from 'three/examples/jsm/utils/RoughnessMipmapper.js';\n\nvar LG = require('./3rdparty/litegraph');\nlet LGraph = LG.LGraph;\nlet LGraphCanvas = LG.LGraphCanvas;\nlet LiteGraph = LG.LiteGraph;\nlet LGraphNode = LG.LGraphNode;\n\nlet isSetsEqual = (a, b) => a.size === b.size && [...a].every(value => b.has(value));\nfunction assert(condition) {\n  if (!condition) {\n    var message = \"Assertion failed\";\n    if (typeof Error !== \"undefined\") {\n      throw new Error(message);\n    }\n    throw message; // Fallback\n  }\n}\n\n// Actually, lets make a global state object\nlet global_state = {};\n// Reference to the litegraph instance\nglobal_state.litegraph = new LGraph();\nfunction init_litegraph(json) {\n  global_state.litegraph.clear();\n  global_state.litegraph.configure(json, false);\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n}\n\nglobal_state.on_select = null;\nglobal_state.on_deselect = null;\nglobal_state.litegraph_canvas = null;\nglobal_state._after_table = {};\nglobal_state._onselect_table = [];\nglobal_state.exec_after = (cmd_type, fn) => {\n  if (!(cmd_type in global_state._after_table))\n    global_state._after_table[cmd_type] = [];\n  global_state._after_table[cmd_type].push(fn);\n};\nglobal_state.exec_on_select = (onselect, ondeselect) => {\n  global_state._onselect_table.push({ onselect: onselect, ondeselect: ondeselect });\n};\nglobal_state.exec_selected = (nodes) => {\n  for (let j in global_state._onselect_table) {\n    let callback = global_state._onselect_table[j];\n    for (let i in nodes) {\n      callback.onselect(nodes[i]);\n    }\n  }\n};\nglobal_state.exec_deselected = (nodes) => {\n  for (let j in global_state._onselect_table) {\n    let callback = global_state._onselect_table[j];\n    for (let i in nodes) {\n      callback.ondeselect(nodes[i]);\n    }\n  }\n};\nglobal_state.exec = (cmd) => {\n  switch (cmd.type) {\n    case 'add_src': {\n      let src_name = cmd.src_name;\n      assert(!(src_name in global_state.litegraph.config.srcs));\n      global_state.litegraph.config.srcs[src_name] = { code: \"\" };\n    }\n      break;\n    case 'remove_src': {\n      let src_name = cmd.src_name;\n      assert(src_name in global_state.litegraph.config.srcs);\n      delete global_state.litegraph.config.srcs[src_name];\n    }\n      break;\n    default:\n      throw Error(\"unrecognized command\");\n      break;\n  }\n\n  if (cmd.type in global_state._after_table) {\n    for (let i in global_state._after_table[cmd.type]) {\n      // console.log(global_state._after_table[cmd.type][i]);\n      global_state._after_table[cmd.type][i](cmd);\n    }\n  }\n};\nglobal_state.viewport = { width: 512, height: 512 };\nglobal_state._on_reset_table = [];\nglobal_state.on_reset = (fn) => {\n  global_state._on_reset_table.push(fn);\n};\nglobal_state.exec_reset = () => {\n  global_state.litegraph.clear();\n  global_state.litegraph.config.srcs = {};\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n};\nglobal_state.reload = () => {\n  let json = global_state.litegraph.serialize();\n  global_state.exec_reset();\n  global_state.litegraph.configure(json, false);\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n};\nglobal_state.get_src = (name) => {\n  assert(name in global_state.litegraph.config.srcs);\n  return global_state.litegraph.config.srcs[name].code;\n};\nglobal_state._scr_change_table = [];\n// Just notify everyone about any change to any source\nglobal_state.on_src_change = (fn) => {\n  // if (!(name in global_state._scr_change_table))\n  //   global_state._scr_change_table[name] = [];\n  // global_state._scr_change_table[name].push(fn);\n  global_state._scr_change_table.push(fn);\n};\nglobal_state.set_src = (name, text) => {\n  global_state.litegraph.config.srcs[name].code = text;\n  global_state._scr_change_table.forEach(fn => fn(name));\n};\nglobal_state.draw_triangle = (gl) => {\n  var pipeline = {\n    vs:\n      `#version 300 es\n      \n      layout (location=0) in vec4 position;\n      layout (location=1) in vec3 color;\n      \n      out vec3 vColor;\n\n      void main() {\n\n          vColor = color;\n          gl_Position = position;\n      }\n      `,\n    ps:\n      `#version 300 es\n      precision highp float;\n      in vec3 vColor;\n      out vec4 fragColor;\n\n      void main() {\n          fragColor = vec4(vColor, 1.0);\n      }`,\n\n  };\n  var vsSource = pipeline.vs;\n  var fsSource = pipeline.ps;\n\n  var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vsSource);\n  gl.compileShader(vertexShader);\n\n  if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(vertexShader));\n  }\n\n  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fsSource);\n  gl.compileShader(fragmentShader);\n\n  if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(fragmentShader));\n  }\n\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    console.error(gl.getProgramInfoLog(program));\n  }\n\n  gl.useProgram(program);\n\n  var triangleArray = gl.createVertexArray();\n  gl.bindVertexArray(triangleArray);\n\n  var positions = new Float32Array([\n    -0.5, -0.5, 0.0,\n    0.5, -0.5, 0.0,\n    0.0, 0.5, 0.0\n  ]);\n\n  var positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(0);\n\n  var colors = new Float32Array([\n    1.0, 0.0, 0.0,\n    0.0, 1.0, 0.0,\n    1.0, 0.0, 0.0\n  ]);\n\n  var colorBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, colors, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(1);\n\n  gl.disable(gl.CULL_FACE);\n  gl.frontFace(gl.CW);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  gl.depthFunc(gl.LEQUAL);\n  gl.disable(gl.BLEND);\n  gl.blendFunc(gl.ONE, gl.ONE);\n  gl.drawArrays(gl.TRIANGLES, 0, 3);\n\n  gl.deleteBuffer(positionBuffer);\n  gl.deleteBuffer(colorBuffer);\n  gl.deleteShader(vertexShader);\n  gl.deleteShader(fragmentShader);\n  gl.deleteProgram(program);\n};\nglobal_state.render_texture = (tex, format, flipy) => {\n  let gl = global_state.gl;\n  flipy = flipy || false;\n  var pipeline = {\n    vs:\n      `#version 300 es\n      precision highp float;\n      in vec2 position;\n      out vec2 uv;\n      void main() {\n        uv = 0.5 * (position + 1.0);\n        uv.y = 1.0 - uv.y;\n        gl_Position = vec4(position, 0, 1);\n      }\n      `,\n    ps:\n      `#version 300 es\n      precision highp float;\n      precision highp int;\n      precision highp usampler2D;\n      precision highp isampler2D;\n      in vec2 uv;\n      uniform sampler2D in_tex;\n      out vec4 fragColor;\n      void main() {\n        fragColor = vec4(vec3(texture(in_tex, uv).xyz), 1.0);\n      }`,\n\n  };\n  if (flipy) {\n    pipeline.vs = pipeline.vs.replace(\"uv.y = 1.0 - uv.y;\", \"uv.y = uv.y;\");\n  }\n  if (format) {\n    switch (format) {\n      case \"RGBA32UI\": {\n        pipeline.ps = pipeline.ps.replace(\"uniform sampler2D\", \"uniform usampler2D\");\n      }\n        break;\n      case \"RGBA32F\": {\n      }\n        break;\n      default:\n        throw Error(\"unknown format\");\n    }\n  }\n  var vsSource = pipeline.vs;\n  var fsSource = pipeline.ps;\n\n  var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vsSource);\n  gl.compileShader(vertexShader);\n\n  if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(vertexShader));\n  }\n\n  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fsSource);\n  gl.compileShader(fragmentShader);\n\n  if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(fragmentShader));\n  }\n\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    console.error(gl.getProgramInfoLog(program));\n  }\n\n  gl.useProgram(program);\n\n  var triangleArray = gl.createVertexArray();\n  gl.bindVertexArray(triangleArray);\n\n  var positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-4, -4, 4, -4, 0, 4]), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(0);\n  gl.activeTexture(gl.TEXTURE0 + 0);\n  gl.bindTexture(gl.TEXTURE_2D, tex);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.uniform1i(gl.getUniformLocation(program, \"in_tex\"), 0);\n  gl.drawArrays(gl.TRIANGLES, 0, 3);\n\n  gl.deleteBuffer(positionBuffer);\n  gl.deleteShader(vertexShader);\n  gl.deleteShader(fragmentShader);\n  gl.deleteProgram(program);\n  gl.deleteVertexArray(triangleArray);\n};\nglobal_state.get_texture_data = (tex, format, width, height) => {\n  let gl = global_state.gl;\n  // create to render to\n  const targetTextureWidth = Math.floor(width) || 256;\n  const targetTextureHeight = Math.floor(height) || 256;\n  const targetTexture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, targetTexture);\n\n  {\n    // define size and format of level 0\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const border = 0;\n    const format = gl.RGBA;\n    const type = gl.UNSIGNED_BYTE;\n    const data = null;\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n      targetTextureWidth, targetTextureHeight, border,\n      format, type, data);\n\n    // set the filtering so we don't need mips\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  }\n  // Create and bind the framebuffer\n  const fb = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, targetTexture, 0);\n\n\n\n  gl.disable(gl.CULL_FACE);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  gl.depthFunc(gl.LEQUAL);\n  gl.blendFunc(gl.ONE, gl.ONE);\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n  gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\n  gl.viewport(0, 0, targetTextureWidth, targetTextureHeight);\n  gl.clearColor(0, 0, 1, 1);\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  global_state.render_texture(tex, format);\n\n  var data = new Uint8Array(targetTextureWidth * targetTextureHeight * 4);\n  gl.readPixels(0, 0, targetTextureWidth, targetTextureHeight, gl.RGBA, gl.UNSIGNED_BYTE, data);\n\n\n  gl.deleteFramebuffer(fb);\n  gl.deleteTexture(targetTexture);\n  // console.log(targetTextureWidth);\n  // console.log(targetTextureHeight);\n  // console.log(targetTextureWidth * targetTextureHeight * 4);\n  let array = new Uint8ClampedArray(data);\n  let image = new ImageData(array, targetTextureWidth, targetTextureHeight);\n  return image;\n};\nglobal_state._dirty_set = new Set();\nglobal_state._dirty_deferred_set = new Set();\nglobal_state.set_dirty = (node) => {\n  // console.log(node + \" is dirty!\");\n  if (node.is_recursive && node.is_recursive())\n    global_state._dirty_deferred_set.add(node);\n  else\n    global_state._dirty_set.add(node);\n};\nglobal_state.update = () => {\n  let set_to_check = new Set(global_state._dirty_set);\n  while (true) {\n    let new_set = new Set();\n    set_to_check.forEach(node => {\n      if (node.outputs)\n        node.outputs.forEach(output => {\n          if (!output.links)\n            return;\n          output.links.forEach(link_id => {\n            let link = global_state.litegraph.links[link_id];\n            // console.log(\"visiting link: \" + link);\n            let target = global_state.litegraph.getNodeById(link.target_id);\n            if (target && !global_state._dirty_set.has(target)) {\n              global_state._dirty_set.add(target);\n              new_set.add(target);\n            }\n          });\n\n\n        });\n    });\n    if (new_set.size == 0)\n      break;\n    set_to_check = new_set;\n  }\n  // console.log(global_state._dirty_set);\n  let sorted_list = [];\n  let backlog = new Set();\n  var loop_counter = 0;\n  while (true) {\n    let to_remove = new Set();\n    global_state._dirty_set.forEach(node => {\n      let has_dirty_input = false;\n      if (node.inputs)\n        node.inputs.forEach(input => {\n          if (input.link) {\n            var input_node = global_state.litegraph.getNodeById(input.link.input_id);\n            if (global_state._dirty_set.has(input_node))\n              has_dirty_input = true;\n          }\n        });\n      if (!has_dirty_input) {\n        backlog.add(node);\n        sorted_list.push(node);\n      }\n    });\n    backlog.forEach(node => global_state._dirty_set.delete(node));\n    backlog.clear();\n    if (global_state._dirty_set.size == 0)\n      break;\n    loop_counter += 1;\n    if (loop_counter > 1000)\n      throw Error(\"[Error] Recursion detected. Exiting loop\");\n  }\n  sorted_list.forEach(node => { if (node.update) node.update(); node.notify(); });\n  global_state._dirty_deferred_set.forEach(node => { if (node.update) node.update(); });\n  global_state._dirty_deferred_set.clear();\n};\nglobal_state.periodic_update = setInterval(global_state.update, 200);\nglobal_state.toposort = () => {\n  let sorted = [];\n  let sorted_set = new Set();\n  let unsorted_set = new Set();\n  let unsorted = [];\n  global_state.litegraph._nodes.forEach(node => {\n    if (!node.is_recursive || !node.is_recursive()) {\n      unsorted_set.add(node);\n      unsorted.push(node);\n    }\n  });\n\n\n  while (unsorted.length) {\n    let node = unsorted.shift();\n    var is_ready = true;\n    for (let i in node.inputs) {\n      let link_id = node.inputs[i].link;\n      if (link_id) {\n        var link_info = global_state.litegraph.links[link_id];\n        if (link_info) {\n          let target_node = global_state.litegraph.getNodeById(link_info.origin_id);\n          if (unsorted_set.has(target_node)) {\n            is_ready = false;\n            break;\n          }\n        }\n      }\n    }\n    if (is_ready) {\n      sorted.push(node);\n      sorted_set.add(node);\n      unsorted_set.delete(node);\n    } else {\n      unsorted.push(node);\n    }\n  }\n  global_state.litegraph._nodes.forEach(node => {\n    if (node.is_recursive && node.is_recursive()) {\n      // console.log(node);\n      sorted.push(node);\n    }\n  });\n  return sorted;\n};\nglobal_state.frame_count = 0;\nglobal_state.draw = () => {\n  let sorted_nodes = global_state.toposort();\n  // console.log(sorted_nodes);\n  sorted_nodes.forEach(node => { if (node.gl_init) node.gl_init(global_state.gl) });\n  sorted_nodes.forEach(node => { if (node.gl_render) node.gl_render(global_state.gl) });\n  Array.from(sorted_nodes).reverse().forEach(node => { if (node.gl_release) node.gl_release(global_state.gl) });\n  global_state.litegraph_canvas.setDirty(true);\n  global_state.frame_count += 1;\n  // global_state.periodic_draw = setTimeout(global_state.draw, 100);\n};\nglobal_state.update_thumbnails = () => {\n  global_state.litegraph_canvas.setDirty(true);\n};\n// TODO:\n// * drawcall node\n//   * input attribute stream\n//      * per vertex/instance\n//   * input uniform hvalues(matrices, vector, float, ints, textures+texture sizes)\n// * value nodes\n//   * camera node(generates look,up,left vectors and view/projection/inverse matrices)\n// * update propagation?\n\nlet graph_list = ['default_graph.json', 'ltc.json', 'feedback_test.json'];\n\nclass LoadGraphButton extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { visible: false };\n    this.myInput = { value: \"\" };\n  }\n  setShow = (vis) => {\n    this.setState({ visible: vis });\n  }\n  handleClose = () => this.setShow(false);\n  handleShow = () => this.setShow(true);\n  handleApply = () => {\n    // console.log(this.myInput.value);\n    this.props.on_submit(this.myInput.value);\n    this.setShow(false);\n  }\n  render() {\n    return (\n      <>\n        <Button variant=\"primary\" onClick={this.handleShow}>\n          Load Graph\n      </Button>\n\n        <Modal show={this.state.visible} onHide={this.handleClose}>\n          <Modal.Header closeButton>\n            <Modal.Title>Choose source</Modal.Title>\n          </Modal.Header>\n          <Modal.Footer>\n            <Button variant=\"secondary\" onClick={this.handleClose}>\n              Cancel\n          </Button>\n            <DropdownButton id=\"dropdown-item-button\" title=\"Dropdown button\">\n              {graph_list.map(\n                variant => (\n                  <Dropdown.Item key={variant} onClick={() => {\n                    fetch(variant)\n                      .then(response => response.text())\n                      .then(text => {\n                        init_litegraph(JSON.parse(text));\n                      });\n\n                  }}>{variant}</Dropdown.Item>\n                ),\n              )}\n\n            </DropdownButton>\n          </Modal.Footer>\n        </Modal>\n      </>\n    );\n  }\n}\n\nvar gltf_loader = new GLTFLoader();\n\nclass MyLGraphNode extends LGraphNode {\n  constructor() {\n    super();\n    this.subscribers = new Set();\n  }\n  is_recursive = () => false;\n  subscribe = (node) => { this.subscribers.add(node) }\n  unsubscribe = (node) => { this.subscribers.delete(node) }\n  notify = () => { this.subscribers.forEach(node => { if (node.set_dirty) node.set_dirty() }) }\n  set_dirty = () => { global_state.set_dirty(this); }\n  onConfigure = () => { if (this.update) this.set_dirty(); }\n  clean_inputs = () => {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  }\n  clean_outputs = () => {\n    let len = this.outputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeOutput(i);\n    }\n  }\n  onRemoved = () => {\n    global_state._dirty_set.delete(this);\n  }\n  set_inputs = (new_outputs) => {\n    let last_attributes = new Set();\n    this.inputs.forEach(input => last_attributes.add(input.type + \" \" + input.name));\n    if (!isSetsEqual(last_attributes, new_outputs)) {\n      last_attributes.forEach(attr => { if (!new_outputs.has(attr)) { this.removeInputByName(attr.split(\" \")[1]) } });\n      new_outputs.forEach(attr => {\n        if (!last_attributes.has(attr)) {\n          this.addInput(attr.split(\" \")[1], attr.split(\" \")[0])\n        }\n      });\n    }\n  }\n  set_outputs = (new_outputs) => {\n    let last_attributes = new Set();\n    this.outputs.forEach(input => last_attributes.add(input.type + \" \" + input.name));\n    if (!isSetsEqual(last_attributes, new_outputs)) {\n      last_attributes.forEach(attr => { if (!new_outputs.has(attr)) { this.removeOutputByName(attr.split(\" \")[1]) } });\n      new_outputs.forEach(attr => {\n        if (!last_attributes.has(attr)) {\n          this.addOutput(attr.split(\" \")[1], attr.split(\" \")[0])\n        }\n      });\n    }\n  }\n}\n\nclass FrameCountNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Frame count\";\n\n    this.addWidget(\"button\", \"reset\", null, (v) => { global_state.frame_count = 0; }, {});\n    this.addOutput(\"0\", \"uniform_t\");\n  }\n  get_value = (slot) => {\n    return global_state.frame_count;\n  }\n  onDrawBackground = (ctx) => {\n    if (global_state.frame_count == 0)\n      this.outputs[0].label = \"0\";\n    else\n      this.outputs[0].label = global_state.frame_count;\n  }\n}\n\nclass Mesh {\n  init = (attributes, indices) => {\n    this.attributes = attributes;\n    this.indices = indices;\n  }\n\n  init_gltf = (mesh) => {\n    assert(mesh.type == \"Mesh\");\n    BufferGeometryUtils.computeTangents(mesh.geometry);\n    this.attributes = {};\n    Object.keys(mesh.geometry.attributes).forEach(attr_name => {\n      let raw_attr = mesh.geometry.attributes[attr_name];\n      let attr = {};\n      attr.data = raw_attr.array;\n      assert(raw_attr.normalized == false);\n      switch (raw_attr.itemSize) {\n        case 1: attr.type = \"float\"; break;\n        case 2: attr.type = \"vec2\"; break;\n        case 3: attr.type = \"vec3\"; break;\n        case 4: attr.type = \"vec4\"; break;\n        default: throw Error();\n      }\n      this.attributes[attr_name] = attr;\n    });\n    this.indices = {};\n    this.indices.data = mesh.geometry.index.array;\n    this.indices.type = \"uint16\";\n    this.pbr_material = mesh.material;\n    this.images = [];\n    Object.keys(this.pbr_material).forEach(field => {\n      if (\n        this.pbr_material[field] &&\n        typeof (this.pbr_material[field]) == \"object\" &&\n        \"image\" in this.pbr_material[field]) {\n        this.images.push({ name: field, img: this.pbr_material[field].image });\n      }\n    });\n\n    // console.log(mesh.geometry);\n  }\n\n  get_attrib_data = (name) => {\n    return this.attributes[name];\n  }\n\n  get_index_data = () => {\n    return this.indices;\n  }\n}\n\nclass ModelNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Model\";\n    this.properties = {\n      fileurl: null,\n    };\n    this.onPropertyChange = (prop, val) => {\n      if (prop == \"fileurl\") {\n\n      }\n    };\n    this.addOutput(\"mesh\", \"mesh_t\");\n    this.meshes = [];\n    // let url = 'models/gltf/dieselpunk_hovercraft/scene.gltf';\n    let url = 'models/LeePerrySmith/LeePerrySmith.gltf';\n    gltf_loader.load(url, (gltf) => {\n      console.log(gltf);\n      this.gltf = gltf;\n      this.traverse(gltf.scene);\n    });\n    this.yoffset = 0;\n  }\n\n  traverse = (node) => {\n    if (node.type == \"Mesh\") {\n      let mesh = new Mesh();\n      mesh.init_gltf(node);\n      this.meshes.push(mesh);\n    } else {\n      node.children.forEach(child => this.traverse(child));\n    }\n  }\n\n  get_meshes = () => {\n    return this.meshes;\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n  }\n\n  display = (propnode) => {\n    var canvas1 = document.createElement(\"canvas\");\n    var canvas2 = document.createElement(\"canvas\");\n    var div = document.createElement(\"div\");\n    div.appendChild(canvas1);\n    div.style.cssText = \"margin-top: 16px;\";\n    {\n      var context = canvas1.getContext('webgl2', { alpha: false });\n      var renderer = new THREE.WebGLRenderer({ canvas: canvas1, context: context });\n      var controls;\n      var camera, scene;\n      camera = new THREE.PerspectiveCamera(45, 1.0, 0.25, 20);\n      camera.position.set(- 1.8, 0.6, 2.7);\n\n      scene = new THREE.Scene();\n      var render = function () {\n        let parent = propnode.datgui.domElement.parentNode;\n        if (parent) {\n          canvas1.classList.add('margin_16');\n          renderer.setSize(parent.offsetWidth - 32, parent.offsetWidth - 32);\n        }\n        else\n          renderer.setSize(512, 512);\n        renderer.render(scene, camera);\n      };\n      var pmremGenerator = new THREE.PMREMGenerator(renderer);\n      pmremGenerator.compileEquirectangularShader();\n      new RGBELoader()\n        .setDataType(THREE.UnsignedByteType)\n        .setPath('textures/equirectangular/')\n        .load('venice_sunset_1k.hdr', (texture) => {\n\n          var envMap = pmremGenerator.fromEquirectangular(texture).texture;\n\n          scene.background = envMap;\n          scene.environment = envMap;\n\n          texture.dispose();\n          pmremGenerator.dispose();\n          scene.add(this.gltf.scene);\n\n          render();\n\n        });\n\n      renderer.setPixelRatio(1.0);\n\n      renderer.outputEncoding = THREE.sRGBEncoding;\n\n      let offset = 1.25;\n      const boundingBox = new THREE.Box3();\n      boundingBox.setFromObject(this.gltf.scene);\n      const size = boundingBox.getSize();\n      const maxDim = Math.max(size.x, size.y, size.z);\n      const fov = camera.fov * (Math.PI / 180);\n      let cameraZ = Math.abs(maxDim / 4 * Math.tan(fov * 2));\n      cameraZ *= offset;\n      // camera.position.z = cameraZ;\n      const minZ = boundingBox.min.z;\n      const cameraToFarEdge = (minZ < 0) ? -minZ + cameraZ : cameraZ - minZ;\n\n      controls = new OrbitControls(camera, renderer.domElement);\n      controls.addEventListener('change', render);\n      controls.minDistance = maxDim;\n      controls.maxDistance = 1000;\n      controls.target.set(0, 0, 0);\n      controls.update();\n\n      camera.aspect = 1.0;\n      camera.far = 1000;\n      camera.far = cameraToFarEdge * 3;\n\n      camera.updateProjectionMatrix();\n\n\n      renderer.render(scene, camera);\n    }\n    div.appendChild(canvas2);\n\n    // let folder = propnode.datgui.addFolder(\"Attributes\");\n    // for (let i in this.attributes) {\n    //   let tmp = {\n    //     prop: () => { },\n    //   };\n    //   folder.add(tmp, \"prop\").name(i);\n    // }\n    // folder.open();\n    propnode.datgui.domElement.appendChild(div);\n    div.width = 512;\n    // {\n    //   let ctx = canvas2.getContext(\"2d\");\n    //   var yoffset = 0;\n    //   var xoffset = 64;\n    //   var border = 16;\n    //   var size = 256;\n    //   canvas2.width = xoffset + size;\n    //   var height = 0;\n    //   var images = [];\n    //   Object.keys(this.pbr_material).forEach(field => {\n    //     if (\n    //       this.pbr_material[field] &&\n    //       typeof (this.pbr_material[field]) == \"object\" &&\n    //       \"image\" in this.pbr_material[field]) {\n    //       images.push({ name: field, img: this.pbr_material[field].image });\n    //       height += size + border;\n    //     }\n    //   });\n    //   canvas2.height = height;\n    //   div.height = height + 256;\n\n    //   images.forEach(img => {\n    //     ctx.fillStyle = \"white\";\n    //     ctx.fillText(img.name, 0, yoffset + 16);\n    //     ctx.drawImage(\n    //       img.img\n    //       , xoffset, yoffset, size, size);\n    //     yoffset += size + border;\n    //   });\n    // }\n  }\n}\n\nclass GLComponent extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.graph = new LGraph();\n    this.canvas = null;\n  }\n\n  componentDidMount() {\n    this.canvas = document.getElementById(\"myglcanvas\");\n    this.gl = this.canvas.getContext('webgl2', { alpha: false });\n\n    // return;\n    let gl = this.gl;\n    const ext = gl.getExtension('EXT_color_buffer_float');\n    if (!ext) {\n      return alert('need EXT_color_buffer_float');\n    }\n    // console.log(ext);\n    global_state.glcanvas = this.canvas;\n    global_state.gl = gl;\n    global_state.draw_triangle(gl);\n  }\n\n  exec_graph = () => {\n\n  }\n\n  onResize = () => {\n    this.canvas.width = this.canvas.parentNode.offsetWidth;\n    this.canvas.height = this.canvas.parentNode.offsetHeight;\n    // this.canvas.resize();\n  }\n\n  render() {\n\n    return (\n      <canvas id='myglcanvas' style={{ width: '100%', height: '100%' }}></canvas>\n\n    );\n  }\n}\n\nclass BackBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.addInput(\"in\", \"uniform_t\");\n    this.properties = {};\n    this.title = \"Back Buffer\";\n    let list = global_state.litegraph.findNodesByType(\"gfx/BackBufferNode\");\n    // Remove all backbuffer nodes\n    // This enforces only one backbuffer node per graph\n    if (list.length > 0) {\n      for (let i = 0; i < list.length; i++) {\n        global_state.litegraph.remove(list[i]);\n      }\n    }\n    this.thumbnail = null;\n    this.viewport = { width: 128, height: 128 };\n    // this.button = this.addWidget(\"button\", \"draw\", null, (v) => { this.draw(); }, {});\n  }\n  gl_render = (gl) => {\n    let in_node = this.getInputNodeByName(\"in\");\n    if (!in_node)\n      return;\n    let input_link = this.getInputLinkByName(\"in\");\n    let tex = in_node.get_texture(input_link.origin_slot);\n    this.update_thumbnails();\n    let canvas = global_state.glcanvas;\n    var displayWidth = canvas.clientWidth;\n    var displayHeight = canvas.clientHeight;\n\n    if (displayWidth && displayHeight) {\n      if (canvas.width != displayWidth ||\n        canvas.height != displayHeight) {\n        canvas.width = displayWidth;\n        canvas.height = displayHeight;\n      }\n    }\n    gl.disable(gl.CULL_FACE);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.blendFunc(gl.ONE, gl.ONE);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.drawBuffers([gl.BACK]);\n    gl.viewport(0, 0, canvas.width, canvas.height);\n    gl.clearColor(0, 0, 1, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    global_state.render_texture(tex, \"RGBA32F\", true);\n  }\n\n  update_thumbnails = () => {\n    let in_node = this.getInputNodeByName(\"in\");\n    if (!in_node)\n      return;\n    let input_link = this.getInputLinkByName(\"in\");\n    let tex = in_node.get_texture(input_link.origin_slot);\n    this.thumbnail = null;\n    let image_data = global_state.get_texture_data(tex, \"RGBA32F\",\n      this.viewport.width, this.viewport.height);\n    let tmp_canvas = document.createElement(\"canvas\");\n    let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n    tmp_canvas.width = image_data.width;\n    tmp_canvas.height = image_data.height;\n    tmp_canvasContext.putImageData(image_data, 0, 0);\n    var img = document.createElement(\"img\");\n    img.src = tmp_canvas.toDataURL(\"image/png\");\n    this.thumbnail = img;\n    global_state.update_thumbnails();\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n    var yoffset = 16;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;\n    this.viewport.width = size;\n    this.viewport.height = size;\n\n    if (this.thumbnail) {\n      ctx.drawImage(this.thumbnail, xoffset, yoffset, size, size);\n    } else {\n      ctx.fillRect(xoffset, yoffset, size, size);\n    }\n    this.size[1] = size + border * 2;\n\n  }\n}\n\nclass PipelineNode extends MyLGraphNode {\n  constructor() {\n    super();\n\n    this.properties = {\n      vs: null,\n      ps: null,\n      attributes: null,\n      uniforms: null\n    };\n    this.addOutput(\"out\", \"pipeline_t\");\n    this.title = \"Pipeline\";\n    this.valid = false;\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.vs) {\n        this.set_vs(null);\n      }\n      if (cmd.src_name == this.ps) {\n        this.set_ps(null);\n      }\n    });\n    global_state.on_src_change((src_name) => {\n      // console.log(\"pipeline has received an update on \" + src_name);\n      if (src_name == this.properties.vs) {\n        this.set_dirty();\n      }\n      if (src_name == this.properties.ps) {\n        this.set_dirty();\n      }\n    });\n  }\n\n  set_vs = (vs) => {\n    this.properties.vs = vs;\n  }\n\n  set_ps = (ps) => {\n    this.properties.ps = ps;\n  }\n\n  clean_inputs = () => {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  }\n\n  is_valid = () => {\n    return this.valid;\n  }\n\n  get_uniform_location = (gl, name) => {\n    return gl.getUniformLocation(this.gl.program, name);\n  }\n\n  gl_init = (gl) => {\n    if (!this.is_valid)\n      return false;\n    assert(!(\"gl\" in this));\n    this.gl = { vs: null, ps: null, program: null };\n    let vs_source = global_state.get_src(this.properties.vs);\n    this.gl.vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(this.gl.vs, vs_source);\n    gl.compileShader(this.gl.vs);\n\n    if (!gl.getShaderParameter(this.gl.vs, gl.COMPILE_STATUS)) {\n      console.error(gl.getShaderInfoLog(this.gl.vs));\n      this.gl_release(gl);\n      return false;\n    }\n\n    let ps_source = global_state.get_src(this.properties.ps);\n    this.gl.ps = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(this.gl.ps, ps_source);\n    gl.compileShader(this.gl.ps);\n\n    if (!gl.getShaderParameter(this.gl.ps, gl.COMPILE_STATUS)) {\n      console.error(gl.getShaderInfoLog(this.gl.ps));\n      this.gl_release(gl);\n      return false;\n    }\n\n    this.gl.program = gl.createProgram();\n    gl.attachShader(this.gl.program, this.gl.ps);\n    gl.attachShader(this.gl.program, this.gl.vs);\n    gl.linkProgram(this.gl.program);\n\n    if (!gl.getProgramParameter(this.gl.program, gl.LINK_STATUS)) {\n      console.error(gl.getProgramInfoLog(this.gl.program));\n      this.gl_release(gl);\n      return false;\n    }\n  }\n\n  bind = (gl) => {\n    gl.useProgram(this.gl.program);\n    gl.disable(gl.CULL_FACE);\n    gl.frontFace(gl.CW);\n    gl.depthMask(true);\n    gl.enable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.disable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE);\n    return true;\n  }\n\n  get_attrib_location = (gl, name) => {\n    if (!this.gl || !this.gl.program)\n      return null;\n    return gl.getAttribLocation(this.gl.program, name);\n  }\n\n  gl_release = (gl) => {\n    if (!(\"gl\" in this))\n      return;\n    if (this.gl.vs != null) gl.deleteShader(this.gl.vs);\n    if (this.gl.ps != null) gl.deleteShader(this.gl.ps);\n    if (this.gl.program != null) gl.deleteProgram(this.gl.program);\n    delete this.gl;\n  }\n\n  display = (propnode) => {\n\n    let src_list = [];\n    // console.log(pipeline);\n    let datgui_state = {\n      select_vs: this.properties.vs,\n      select_ps: this.properties.ps,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'select_vs', src_list)\n      .onChange((v) => this.set_vs(v));\n    propnode.datgui.add(datgui_state, 'select_ps', src_list)\n      .onChange((v) => this.set_ps(v));\n  }\n\n  update = () => {\n    this.parse_shaders();\n  }\n\n  get_info = () => {\n    if (!this.valid)\n      this.parse_shaders();\n    return { attributes: this.properties.attributes, uniforms: this.properties.uniforms, valid: this.valid };\n  }\n\n  parse_shaders = () => {\n    // this.clean_inputs();\n    this.valid = false;\n    let uniform_set = new Set();\n\n    this.properties.attributes = [];\n    this.properties.uniforms = [];\n    if (this.properties.vs != null) {\n      try {\n        // Parse vertex shader for attributes\n        if (typeof window.glslang == \"undefined\")\n          throw Error(\"glslang is not ready\");\n        let str = window.glslang.parse_attributes(global_state.get_src(this.properties.vs), \"vertex\");\n        let json = JSON.parse(str);\n        // console.log(str);\n        for (var i = 0; i < json.attributes.length - 1; i++) {\n          let attrib = json.attributes[i];\n          this.properties.attributes.push({ name: attrib.name, type: attrib.type });\n        }\n        for (var i = 0; i < json.uniforms.length - 1; i++) {\n          let uniform = json.uniforms[i];\n          if (uniform_set.has(uniform.name))\n            continue;\n          // names starting with '_' are builtins\n          if (uniform.name[0] == \"_\")\n            continue;\n          uniform_set.add(uniform.name);\n          this.properties.uniforms.push({ name: uniform.name, type: uniform.type });\n        }\n        // ps uniform parsing\n        {\n          let str = window.glslang.parse_attributes(global_state.get_src(this.properties.ps), \"fragment\");\n          let json = JSON.parse(str);\n          // console.log(str);\n          for (var i = 0; i < json.uniforms.length - 1; i++) {\n            let uniform = json.uniforms[i];\n            if (uniform_set.has(uniform.name))\n              continue;\n            // names starting with '_' are builtins\n            if (uniform.name[0] == \"_\")\n              continue;\n            uniform_set.add(uniform.name);\n            this.properties.uniforms.push({ name: uniform.name, type: uniform.type });\n          }\n        }\n        this.valid = true;\n      } catch (e) {\n        console.log(e);\n        return null;\n      }\n    }\n  }\n\n  onSelected() {\n  }\n\n  onDeselected() {\n  }\n\n}\n\nclass VertexBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Vertex Buffer\";\n    this.properties = {\n      src: null\n    };\n    global_state.on_src_change((src_name) => {\n      if (src_name == this.properties.src) {\n        this.set_dirty();\n      }\n    });\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.properties.src) {\n        this.set_src(null);\n      }\n    });\n    this.buf = { attributes: {} };\n    this.set_dirty();\n    this.addOutput(\"mesh\", \"mesh_t\");\n  }\n\n  display = (propnode) => {\n    let src_list = [];\n    let datgui_state = {\n      src: this.properties.src,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'src', src_list)\n      .onChange((v) => this.set_src(v));\n    let folder = propnode.datgui.addFolder(\"Attributes\");\n    if (this.buf) {\n      for (let i in this.buf.attributes) {\n        let tmp = {\n          prop: () => { },\n        };\n        folder.add(tmp, \"prop\").name(i);\n      }\n    }\n    folder.open();\n  }\n\n  set_src = (name) => {\n    this.properties.src = name;\n    this.set_dirty();\n  }\n\n  get_meshes = () => {\n    return [this.mesh];\n  }\n\n  parse_src = () => {\n    if (!this.properties.src) {\n      return;\n    }\n    let text = global_state.get_src(this.properties.src);\n    if (!text) {\n      this.properties.src = null;\n      return;\n    }\n    try {\n      let json = JSON.parse(text);\n      assert(json);\n      assert(json.attributes);\n      let mesh = new Mesh();\n      mesh.init(json.attributes, json.indices);\n      this.mesh = mesh;\n    } catch (e) {\n      console.log(e);\n      this.mesh = null;\n    }\n  }\n\n  update = () => {\n    this.parse_src();\n  }\n}\n\nclass TextureBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Texture Buffer\";\n    this.properties = {\n      src: null\n    };\n    this.properties = {\n      src: null\n    };\n    global_state.on_src_change((src_name) => {\n      if (src_name == this.properties.src) {\n        this.set_dirty();\n      }\n    });\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.properties.src) {\n        this.set_src(null);\n      }\n    });\n    this.buf = {};\n    this.thumbnail = null;\n    this.set_dirty();\n  }\n\n  display = (propnode) => {\n    let src_list = [];\n    let datgui_state = {\n      src: this.properties.src,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'src', src_list)\n      .onChange((v) => this.set_src(v));\n  }\n\n  set_src = (name) => {\n    this.properties.src = name;\n    this.set_dirty();\n  }\n\n  get_buffer = (slot) => {\n    return this.buf;\n  }\n\n  parse_src = () => {\n    if (!this.properties.src) {\n      this.clean_outputs();\n      return;\n    }\n    let text = global_state.get_src(this.properties.src);\n    if (!text) {\n      this.properties.src = null;\n      this.clean_outputs();\n      return;\n    }\n    try {\n      let json = JSON.parse(text);\n      assert(json);\n      assert(json.data && json.format && json.width && json.height);\n      let new_outputs = new Set();\n      new_outputs.add(\"uniform_t texture\");\n      this.set_outputs(new_outputs);\n      this.buf = json;\n    } catch (e) {\n      console.error(\"Error while parsing json\");\n      console.error(e);\n    }\n  }\n\n  get_texture = (loc) => {\n    return this.gl.texture;\n  }\n\n  gl_init = (gl) => {\n    var texture = gl.createTexture();\n    this.gl = {};\n    this.gl.texture = texture;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    const level = 0;\n    var internalFormat = gl.RGBA32F;\n    const width = this.buf.width;\n    const height = this.buf.height;\n    const border = 0;\n    var format = gl.RGBA;\n    var type = gl.FLOAT;\n    var data = null;\n    switch (this.buf.format) {\n      case \"RGBA32F\": {\n        type = gl.FLOAT;\n        internalFormat = gl.RGBA32F;\n        format = gl.RGBA;\n        data = new Float32Array(this.buf.data);\n      }\n        break;\n      case \"RGBA32UI\": {\n        type = gl.UNSIGNED_INT;\n        internalFormat = gl.RGBA32UI;\n        format = gl.RGBA_INTEGER;\n        data = new Uint32Array(this.buf.data);\n      }\n        break;\n      default: throw Error('Unsupported format. Please add!');\n    };\n    // console.log(data);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border,\n      format, type, data);\n\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_BASE_LEVEL, 0);\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAX_LEVEL, Math.log2(width));\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    // gl.generateMipmap(gl.TEXTURE_2D);\n\n  }\n\n  gl_release = (gl) => {\n    if (this.gl && this.gl.texture)\n      gl.deleteTexture(this.gl.texture);\n    delete this.gl;\n  }\n\n  update = () => {\n    this.parse_src();\n    this.update_thumbnails(global_state.gl);\n  }\n\n  update_thumbnails = (gl) => {\n    this.thumbnail = null;\n    if (!this.buf.data)\n      return;\n    this.gl_init(gl);\n    let image_data = global_state.get_texture_data(this.gl.texture, this.buf.format);\n    this.gl_release(gl);\n    let tmp_canvas = document.createElement(\"canvas\");\n    let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n    tmp_canvas.width = image_data.width;\n    tmp_canvas.height = image_data.height;\n    tmp_canvasContext.putImageData(image_data, 0, 0);\n    var img = document.createElement(\"img\");\n    img.src = tmp_canvas.toDataURL(\"image/png\");\n    this.thumbnail = img;\n    global_state.update_thumbnails();\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n    var yoffset = 16;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;\n    if (this.thumbnail) {\n      ctx.drawImage(this.thumbnail, xoffset, yoffset, size, size);\n    } else {\n      ctx.fillRect(xoffset, yoffset, size, size);\n    }\n    this.size[1] = size + border * 2;\n  }\n\n}\n\nclass DrawCallNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.addOutput(\"out\", \"drawcall_t\");\n    this.addInput(\"pipeline\", \"pipeline_t\");\n    this.addInput(\"mesh\", \"mesh_t\");\n    this.title = \"Draw Call\";\n    this.attributes = [];\n    this.uniforms = [];\n    this.onConnectionsChange = (c_type, target_slot, flag, link_info, input) => {\n      // if (input.type == \"pipeline_t\") {\n      this.set_dirty();\n      // } else {\n      // return false;\n      // }\n    };\n    // this.onConnectInput = (target_slot, output_type, output) => {\n    //   if (output_type == \"pipeline_t\") {\n    //     return true;\n    //   } else {\n    //     if ()\n    //     return false;\n    //   }\n    // };\n  }\n\n  update_inputs = () => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    var sat = new Set();\n\n    if (pipeline) {\n      let pipeline_info = pipeline.get_info();\n      if (!pipeline_info.valid)\n        return;\n      this.attributes = pipeline_info.attributes;\n      this.uniforms = pipeline_info.uniforms;\n      this.uniforms.forEach(a => sat.add(\"uniform_t \" + a.name));\n      if (this.properties.default_uniforms) {\n        let to_remove = [];\n        Object.keys(this.properties.default_uniforms).forEach(uni_name => {\n          if (!sat.has(\"uniform_t \" + uni_name))\n            to_remove.push(uni_name);\n        });\n        to_remove.forEach(uni_name => {\n          console.log(\"[INFO] Found stale default value for \" + uni_name);\n          delete this.properties.default_uniforms[uni_name]\n        }\n        );\n      }\n    }\n    sat.add(\"pipeline_t pipeline\");\n    sat.add(\"mesh_t mesh\");\n    this.set_inputs(sat);\n  }\n\n  gl_init = (gl) => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    if (pipeline == null)\n      return;\n    let mesh_input = this.getInputNodeByName(\"mesh\");\n    if (!mesh_input)\n      return;\n    this.gl = {};\n    this.gl.arrays = [];\n    this.gl.buffers = [];\n    let meshes = mesh_input.get_meshes();\n    meshes.forEach(mesh => {\n      let arr = gl.createVertexArray();\n      this.gl.arrays.push(arr);\n      gl.bindVertexArray(arr);\n\n      for (let i in this.attributes) {\n        let attrib = this.attributes[i];\n        let out_attrib = mesh.get_attrib_data(attrib.name);\n        if (!out_attrib)\n          continue;\n        assert(out_attrib.type == attrib.type);\n        let data = out_attrib.data;\n        var gl_buffer = gl.createBuffer();\n        this.gl.buffers.push(gl_buffer);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl_buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n        let loc = pipeline.get_attrib_location(gl, attrib.name);\n        if (loc < 0)\n          continue;\n        var comps = -1;\n        switch (attrib.type) {\n          case \"vec2\":\n            comps = 2;\n            break;\n          case \"vec3\":\n            comps = 3;\n            break;\n          default:\n            throw Error(\"unrecognized type\");\n        };\n        gl.vertexAttribPointer(loc, comps, gl.FLOAT, false, 0, 0);\n        gl.enableVertexAttribArray(loc);\n      }\n      arr.draw_size = 3;\n      {\n        let buf = mesh.get_index_data();\n        assert(\"data\" in buf);\n        const indexBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n        this.gl.buffers.push(indexBuffer);\n        assert(buf.type == \"uint16\");\n        gl.bufferData(\n          gl.ELEMENT_ARRAY_BUFFER,\n          new Uint16Array(buf.data),\n          gl.STATIC_DRAW\n        );\n        arr.draw_size = buf.data.length;\n\n      }\n      arr.index_type = gl.UNSIGNED_SHORT;\n    });\n  }\n\n  display = (propnode) => {\n    if (this.uniforms) {\n      let datgui_state = {\n      };\n      let new_rt = propnode.datgui.addFolder(\"Uniforms\");\n      let add_vec = (name, comps) => {\n        let strs = [\".x\", \".y\", \".z\", \".w\"];\n        if (!(\"default_uniforms\" in this.properties)) {\n          this.properties[\"default_uniforms\"] = {};\n        }\n        if (!(name in this.properties.default_uniforms)) {\n          this.properties.default_uniforms[name] = [];\n        }\n        if (this.properties.default_uniforms[name].length != comps) {\n          this.properties.default_uniforms[name] = new Array(comps).fill(0.0);;\n        }\n        for (var i = 0; i < comps; i++) {\n          let id = i;\n          datgui_state[name + strs[i]] = this.properties.default_uniforms[name][i];\n          new_rt.add(datgui_state, name + strs[i]).step(0.05)\n            .onChange(v => this.properties.default_uniforms[name][id] = v);\n        }\n      };\n      this.uniforms.forEach(uni => {\n        switch (uni.type) {\n          case \"float\":\n            add_vec(uni.name, 1);\n            break;\n          case \"vec2\":\n            add_vec(uni.name, 2);\n            break;\n          case \"vec3\":\n            add_vec(uni.name, 3);\n            break;\n        };\n      });\n\n      new_rt.open();\n    }\n  }\n\n  gl_draw = (gl) => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    if (pipeline == null)\n      return;\n    pipeline.bind(gl);\n    var tu_cnt = 0;\n    // builtins\n    {\n      let loc = pipeline.get_uniform_location(gl, \"_resolution\");\n\n      if (loc) {\n        let viewport = gl.getParameter(gl.VIEWPORT);\n        gl.uniform2fv(loc, [viewport[2] - viewport[0], viewport[3] - viewport[1]]);\n      }\n    }\n    for (let i in this.uniforms) {\n      let uni = this.uniforms[i];\n      let loc = pipeline.get_uniform_location(gl, uni.name);\n      if (!loc)\n        continue;\n      let tu = tu_cnt;\n      if (uni.type == \"texture\") {\n        gl.activeTexture(gl.TEXTURE0 + tu);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        gl.uniform1i(loc, tu);\n        tu_cnt += 1;\n      }\n      let input = this.getInputNodeByName(uni.name);\n      if (!input)\n        continue;\n      let input_link = this.getInputLinkByName(uni.name);\n      if (uni.type == \"texture\") {\n        let texture = input.get_texture(input_link.origin_slot);\n        gl.activeTexture(gl.TEXTURE0 + tu);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.uniform1i(loc, tu);\n      } else {\n        let val = input.get_value(input_link.origin_slot);\n        switch (uni.type) {\n          case \"int\":\n            gl.uniform1i(loc, val);\n            break;\n          default:\n            throw Error(\"Unimplemented\");\n        };\n      }\n    }\n    this.gl.arrays.forEach(arr => {\n      gl.bindVertexArray(arr);\n\n      gl.drawElements(gl.TRIANGLES, arr.draw_size, arr.index_type, 0);\n    });\n\n\n  }\n\n  gl_release = (gl) => {\n    this.gl.buffers.forEach(buf => gl.deleteBuffer(buf));\n    this.gl.arrays.forEach(buf => gl.deleteVertexArray(buf));\n    delete this.gl;\n  }\n\n  update = () => {\n    this.update_inputs();\n  }\n\n  onSelected() {\n  }\n\n  onDeselected() {\n  }\n\n}\n\nclass FeedbackNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Feedback\";\n    this.addInput(\"in\", \"uniform_t\");\n    this.addOutput(\"out\", \"uniform_t\");\n    this.gl = { tex: null };\n    this.addWidget(\"button\", \"reset\", null, (v) => { this.reset(); }, {});\n  }\n  reset = () => {\n    let gl = global_state.gl;\n    if (this.gl.tex)\n      gl.deleteTexture(this.gl.tex);\n    this.gl.tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.gl.tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, 1, 1);\n  }\n  is_recursive = () => true;\n  get_texture = () => {\n    if (!this.gl.tex) {\n      this.reset();\n    }\n    return this.gl.tex;\n  }\n  gl_render = (gl) => {\n    if (this.gl.tex)\n      gl.deleteTexture(this.gl.tex);\n    this.gl = { tex: null };\n    let input_link = this.getInputLinkByName(\"in\");\n    if (!input_link)\n      return;\n    this.gl.tex = this.getInputNodeByName(\"in\").clone_texture(input_link.origin_slot);\n  }\n}\n\nclass PassNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.button = this.addWidget(\"button\", \"Add DC\", null, (v) => { this.addDC(); }, {});\n    this.title = \"Pass\";\n    this.properties = {\n      viewport: { width: 512, height: 512 },\n      rts: [],\n      depth: null,\n      dc_cnt: 0,\n    };\n    this.yoffset = 100;\n    this.onPropertyChange = (prop, val) => {\n      this.update_outputs();\n    };\n  }\n\n  gl_render = (gl) => {\n    this.bind(gl);\n    this.inputs.forEach(input => {\n\n      if (input.type == \"drawcall_t\") {\n        let link = global_state.litegraph.links[input.link];\n        if (!link)\n          return;\n        let dc = global_state.litegraph.getNodeById(link.origin_id);\n        // console.log(dc);\n        dc.gl_draw(gl);\n      }\n    });\n    this.update_thumbnails(gl);\n  }\n\n  clear_outputs = () => {\n    let len = this.outputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeOutput(i);\n    }\n    this.properties.dc_cnt = 0;\n  }\n\n  update_outputs = () => {\n    this.clear_outputs();\n    for (let i = 0; i < this.properties.rts.length; ++i) {\n      this.addOutput(\"rt#\" + i, \"uniform_t\");\n    }\n    if (this.properties.depth != null) {\n      this.addOutput(\"depth\", \"uniform_t\");\n    }\n  }\n\n  push_rt = (params) => {\n    let rt_params = {};\n    rt_params.format = params.format;\n    this.properties.rts.push(rt_params)\n    this.update_outputs();\n  }\n\n  pop_rt = () => {\n    // for (let i = this.properties.rts.length - 1; i >= 0; i--) {\n    //   delete this.properties.rts[i];\n    //   break;\n    // }\n    if (this.properties.rts.length == 0)\n      return;\n    this.properties.rts.pop();\n    this.update_outputs();\n  }\n\n  add_depth = (params) => {\n    if (this.properties.depth != null)\n      return;\n    let d_params = {};\n    d_params.format = params.format;\n    this.properties.depth = d_params;\n    this.update_outputs();\n  }\n\n  remove_depth = () => {\n    if (this.properties.depth == null)\n      return;\n    this.properties.depth = null;\n    this.update_outputs();\n  }\n\n  set_width = (width) => {\n    this.properties.viewport.width = width;\n  }\n\n  set_height = (height) => {\n    this.properties.viewport.height = height;\n  }\n\n  onExecute() {\n    // var A = this.getInputData(0);\n    // if (A === undefined)\n    //   A = 0;\n    // var B = this.getInputData(1);\n    // if (B === undefined)\n    //   B = 0;\n    // this.setOutputData(0, \"texture_0\");\n  }\n\n  gl_init = (gl) => {\n    this.gl = { fb: null, rts: [] };\n    this.gl.fb = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.gl.fb);\n    assert(this.properties.rts.length != 0 || this.properties.depth != null);\n    this.draw_buffers = [];\n    this.gl.rts = [];\n    for (let i = 0; i < this.properties.rts.length; ++i) {\n      const tex = this.gen_texture(gl, i);\n      this.gl.rts.push(tex);\n      this.draw_buffers.push(gl.COLOR_ATTACHMENT0 + i);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i, gl.TEXTURE_2D, tex, 0);\n    }\n\n    if (this.properties.depth != null) {\n      const tex = this.gen_texture(gl, this.properties.rts.length);\n      this.gl.depth = tex;\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, tex, 0);\n    }\n    var status = gl.checkFramebufferStatus(gl.DRAW_FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) {\n      throw Error('fb status: ' + status.toString(16));\n    }\n  }\n\n  clone_texture = (id) => {\n    let gl = global_state.gl;\n    // create to render to\n    const targetTextureWidth = this.properties.viewport.width;\n    const targetTextureHeight = this.properties.viewport.height;\n    const targetTexture = this.gen_texture(gl, id);\n    const srcTexture = this.get_texture(id);\n    // Create and bind the framebuffer\n    const fb = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, targetTexture, 0);\n\n    gl.disable(gl.CULL_FACE);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.blendFunc(gl.ONE, gl.ONE);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n    gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\n    gl.viewport(0, 0, targetTextureWidth, targetTextureHeight);\n    gl.clearColor(0, 0, 1, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    global_state.render_texture(srcTexture);\n\n    gl.deleteFramebuffer(fb);\n    return targetTexture;\n  }\n\n  gen_texture = (gl, id) => {\n    if (id >= this.properties.rts.length) {\n      let rt = this.properties.depth;\n      const tex = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, tex);\n      var format = null;\n\n      switch (rt.format) {\n        case \"D16\": {\n          format = gl.DEPTH_COMPONENT16;\n        }\n          break;\n        case \"D32\": {\n          format = gl.DEPTH_COMPONENT32F;\n        }\n          break;\n        default:\n          throw Error(\"unknown format\");\n      }\n      // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n      gl.texStorage2D(gl.TEXTURE_2D, 1, format,\n        this.properties.viewport.width, this.properties.viewport.height);\n      return tex;\n    } else {\n      let rt = this.properties.rts[id];\n      const tex = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, tex);\n      var format = null;\n      switch (rt.format) {\n        case \"RGBA8\": {\n          format = gl.RGBA8;\n        }\n          break;\n        case \"RGBA32F\": {\n          format = gl.RGBA32F;\n        }\n          break;\n        default:\n          throw Error(\"unknown format\");\n      }\n      // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n      gl.texStorage2D(gl.TEXTURE_2D, 1, format,\n        this.properties.viewport.width, this.properties.viewport.height);\n      return tex;\n    }\n  }\n\n  get_texture = (id) => {\n    if (id >= this.properties.rts.length)\n      return this.gl.depth;\n    return this.gl.rts[id];\n  }\n\n  bind = (gl) => {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.gl.fb);\n    gl.drawBuffers(this.draw_buffers);\n    gl.viewport(0, 0, this.properties.viewport.width, this.properties.viewport.height);\n    gl.clearColor(0, 0, 0, 1);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  }\n\n  update_thumbnails = (gl) => {\n    this.thumbnails = [];\n    let rts = [...this.gl.rts];\n    if (this.gl.depth)\n      rts.push(this.gl.depth);\n    for (let i in rts) {\n      let image_data = global_state.get_texture_data(rts[i]);\n\n      let tmp_canvas = document.createElement(\"canvas\");\n      let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n      tmp_canvas.width = image_data.width;\n      tmp_canvas.height = image_data.height;\n      tmp_canvasContext.putImageData(image_data, 0, 0);\n      var img = document.createElement(\"img\");\n      img.src = tmp_canvas.toDataURL(\"image/png\");\n      img.onload = () => { global_state.update_thumbnails() };\n      this.thumbnails.push(img);\n    }\n    if (this.gl.depth)\n      this.depth_thumbnail = this.thumbnails[this.thumbnails.length - 1];\n    global_state.update_thumbnails();\n  }\n\n  gl_release = (gl) => {\n    if (!(\"gl\" in this))\n      return;\n    if (this.gl.vfbs != null) gl.deleteFramebuffer(this.gl.fb);\n    for (let i = 0; i < this.gl.rts.length; ++i) {\n      let tex = this.gl.rts[i];\n      gl.deleteTexture(tex);\n    }\n    if (this.gl.depth)\n      gl.deleteTexture(this.gl.depth);\n    delete this.gl;\n  }\n\n  display = (propnode) => {\n\n    let tmp_rt_state = {\n      format: \"RGBA8\",\n    };\n    let tmp_d_state = {\n      format: \"D16\",\n    };\n    let datgui_state = {\n      width: this.properties.viewport.width,\n      height: this.properties.viewport.height,\n      push: () => {\n        this.push_rt(tmp_rt_state);\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      pop: () => {\n        this.pop_rt();\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      add_depth: () => {\n        this.add_depth(tmp_d_state);\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      remove_depth: () => {\n        this.remove_depth();\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n    };\n    let rts = propnode.datgui.addFolder(\"Render targets\");\n    for (let i in this.properties.rts) {\n      let rt = this.properties.rts[i];\n      let rt_state = {\n        format: rt.format,\n      };\n      rts.add(rt_state, 'format');\n    }\n    if (this.properties.depth != null) {\n      let rt_state = {\n        format: this.properties.depth.format,\n      };\n      rts.add(rt_state, 'format');\n    }\n    rts.open();\n    let new_rt = propnode.datgui.addFolder(\"Add render target\");\n    new_rt.add(tmp_rt_state, 'format', [\"RGBA8\", \"RGBA32F\"]);\n    new_rt.add(datgui_state, 'push');\n    new_rt.add(datgui_state, 'pop');\n    new_rt.open();\n    let new_d = propnode.datgui.addFolder(\"Add depth target\");\n    new_d.add(tmp_d_state, 'format', [\"D16\", \"D32\"]);\n    new_d.add(datgui_state, 'add_depth');\n    new_d.add(datgui_state, 'remove_depth');\n    new_d.open();\n    let vp = propnode.datgui.addFolder(\"Viewport\");\n    vp.add(datgui_state, 'width', 128, 1024 * 2, 16).onChange((v) => this.set_width(v));;\n    vp.add(datgui_state, 'height', 128, 1024 * 2, 16).onChange((v) => this.set_height(v));;\n    vp.open();\n\n    // this.datgui.add(this.datgui_state, 'select_vs', this.src_list)\n    //   .onChange((v) => pipeline.set_vs(v));\n    // this.datgui.add(this.datgui_state, 'select_ps', this.src_list)\n    //   .onChange((v) => pipeline.set_ps(v));\n\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n\n    ctx.fillStyle = \"#000\";\n    var yoffset = 32 + this.inputs.length * 20;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;;\n    for (let i in this.properties.rts) {\n      if (\"thumbnails\" in this && i < this.thumbnails.length) {\n        ctx.drawImage(this.thumbnails[i], xoffset, yoffset, size, size);\n\n      } else {\n        ctx.fillRect(xoffset, yoffset, size, size);\n      }\n      yoffset += size + border;\n    }\n    if (this.properties.depth != null) {\n      if (\"depth_thumbnail\" in this) {\n        ctx.drawImage(this.depth_thumbnail, xoffset, yoffset, size, size);\n\n      } else {\n        ctx.fillRect(xoffset, yoffset, size, size);\n      }\n      yoffset += size + border;\n    }\n    // this.size[0] = xoffset + size + border;\n    this.size[1] = yoffset;\n    // ctx.fillRect(0, 0, size[0], size[1]);\n    ctx.strokeStyle = \"#555\";\n\n\n  }\n\n\n\n  addDC() {\n    this.addInput(\"DC#\" + this.properties.dc_cnt, \"drawcall_t\");\n    this.properties.dc_cnt += 1;\n  }\n\n  onMouseDown(e, local_pos) {\n\n    // this.addOutput(\"A-B\", \"number\");\n  }\n\n}\n\nclass GraphNodeComponent extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.graph = global_state.litegraph;\n    this.onResize = this.onResize.bind(this);\n    this.dumpJson = this.dumpJson.bind(this);\n  }\n\n  componentDidMount() {\n\n    global_state.litegraph_canvas = new LGraphCanvas(\"#tmp_canvas\", this.graph);\n    global_state._selected_nodes = {};\n    global_state.litegraph_canvas.onSelectionChange = (\n      nodes\n    ) => {\n      // console.log(\"selection changed to\"); console.log(nodes);\n      let new_selected = [];\n      let new_deselected = [];\n      for (let i in nodes) {\n        let node = nodes[i];\n        if (!(node.id in global_state._selected_nodes)) {\n          new_selected.push(node);\n        }\n      }\n      for (let i in global_state._selected_nodes) {\n        let node = global_state._selected_nodes[i];\n        if (!(node.id in nodes)) {\n          new_deselected.push(node);\n        }\n      }\n      global_state._selected_nodes = { ...nodes };\n      // console.log(\"new_selected\"); console.log(new_selected);\n      // console.log(\"new_deselected\"); console.log(new_deselected);\n      global_state.exec_selected(new_selected);\n      global_state.exec_deselected(new_deselected);\n    };\n    // global_state.litegraph_canvas.onNodeSelected = (\n    //   node\n    // ) => {\n    //   console.log(\"selected\" + node);\n    //   global_state.exec_selected([node]);\n    // };\n\n    // global_state.litegraph_canvas.onNodeDeselected = (\n    //   node\n    // ) => {\n    //   console.log(\"deselected\" + node);\n    //   global_state.exec_deselected([node]);\n    // };\n\n\n    this.graph.start();\n\n    this.props.glContainer.on('resize', this.onResize);\n    global_state.litegraph_canvas.resize();\n\n    // Register nodesw\n    LiteGraph.registerNodeType(\"gfx/PassNode\", PassNode);\n    LiteGraph.registerNodeType(\"gfx/BackBufferNode\", BackBufferNode);\n    LiteGraph.registerNodeType(\"gfx/DrawCallNode\", DrawCallNode);\n    LiteGraph.registerNodeType(\"gfx/PipelineNode\", PipelineNode);\n    LiteGraph.registerNodeType(\"gfx/VertexBufferNode\", VertexBufferNode);\n    LiteGraph.registerNodeType(\"gfx/ModelNode\", ModelNode);\n    LiteGraph.registerNodeType(\"gfx/TextureBufferNode\", TextureBufferNode);\n    LiteGraph.registerNodeType(\"gfx/FeedbackNode\", FeedbackNode);\n    LiteGraph.registerNodeType(\"gfx/FrameCountNode\", FrameCountNode);\n    // Load default json scene\n    fetch('default_graph.json')\n      .then(response => response.text())\n      .then(text => {\n        init_litegraph(JSON.parse(text));\n      });\n    this.onResize();\n    window.addEventListener('message', event => {\n      try {\n        let json = JSON.parse(event.data);\n        if (\"type\" in json) {\n          if (json.type == \"set(graph.json)\") {\n            let graph_json =  JSON.parse(json.data);\n            init_litegraph(graph_json);\n          } else if (json.type == \"get(graph.json)\") {\n            let json = this.graph.serialize();\n            let str = JSON.stringify(json)\n            let msg = {};\n            msg.data = str;\n            msg.type = \"graph.json\";\n            if (window.parent != window)\n              window.parent.postMessage(JSON.stringify(msg), '*');\n          } else\n            console.log(\"unrecoginez command type: \" + json.type);\n        } else\n          console.log(\"unrecoginez command: \" + event);\n      } catch (e) {\n\n      }\n\n    });\n  }\n\n  onResize = () => {\n    let parent = document.getElementById(\"tmp_canvas_container\");\n    global_state.litegraph_canvas.resize(parent.offsetWidth, parent.offsetHeight - 70);\n  }\n\n  dumpJson() {\n   \n    // console.log();\n    // https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript?page=1&tab=votes#tab-top\n    function copyTextToClipboard(text) {\n      var textArea = document.createElement(\"textarea\");\n      textArea.style.position = 'fixed';\n      textArea.style.top = 0;\n      textArea.style.left = 0;\n      textArea.style.width = '2em';\n      textArea.style.height = '2em';\n      textArea.style.padding = 0;\n      textArea.style.border = 'none';\n      textArea.style.outline = 'none';\n      textArea.style.boxShadow = 'none';\n      textArea.style.background = 'transparent';\n      textArea.value = text;\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n      try {\n        var successful = document.execCommand('copy');\n        var msg = successful ? 'successful' : 'unsuccessful';\n        console.log('Copying text command was ' + msg);\n      } catch (err) {\n        console.log('Oops, unable to copy');\n      }\n\n      document.body.removeChild(textArea);\n    }\n    let json = this.graph.serialize();\n    let str = JSON.stringify(json)\n    // let msg = {};\n    // msg.data = str;\n    // msg.type = \"graph.json\";\n    // if (window.parent != window)\n    //   window.parent.postMessage(JSON.stringify(msg), '*');\n    copyTextToClipboard(str);\n\n  }\n\n  render() {\n\n    return (\n      <div style={{ width: '100%', height: '100%' }} id=\"tmp_canvas_container\">\n        <Button style={{ margin: 10 }} onClick={this.dumpJson}>\n          Copy to clipboard\n                </Button>\n        <Button style={{ margin: 10 }} onClick={() => { console.log(global_state.litegraph_canvas.selected_nodes); }}>\n          Dump Selected\n                </Button>\n        <Button variant=\"danger\" style={{ margin: 10 }} onClick={() => { global_state.exec_reset(); }}>\n          Clear\n                </Button>\n\n        <Button style={{ margin: 10 }} onClick={() => {\n          // console.log(global_state.toposort());\n          global_state.draw();\n        }} variant=\"success\" >\n          Next Frame\n                </Button>\n        <LoadGraphButton />\n        <canvas id='tmp_canvas' style={{ border: '1px solid' }}></canvas>\n      </div>\n    );\n  }\n}\n\n{/* <Button style={{ margin: 10 }} onClick={() => { global_state.update(); }}>\nforce update\n      </Button>\n<Button style={{ margin: 10 }} onClick={() => { global_state.reload(); }}>\nforce reload\n      </Button> */}\n\n// A button that spawns a modal window with text input and submit button\n// @TODO: validation\nclass CreateSrc extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { visible: false };\n    this.myInput = { value: \"\" };\n  }\n  setShow = (vis) => {\n    this.setState({ visible: vis });\n  }\n  handleClose = () => this.setShow(false);\n  handleShow = () => this.setShow(true);\n  handleApply = () => {\n    // console.log(this.myInput.value);\n    this.props.on_submit(this.myInput.value);\n    this.setShow(false);\n  }\n  render() {\n    return (\n      <>\n        <Button variant=\"primary\" onClick={this.handleShow}>\n          New Source\n      </Button>\n\n        <Modal show={this.state.visible} onHide={this.handleClose}>\n          <Modal.Header closeButton>\n            <Modal.Title>Enter name</Modal.Title>\n          </Modal.Header>\n          <FormControl type=\"text\" placeholder=\"source name\" onChange={e => this.myInput.value = e.target.value} />\n          <Modal.Footer>\n            <Button variant=\"secondary\" onClick={this.handleClose}>\n              Cancel\n          </Button>\n            <Button variant=\"primary\" onClick={() => this.handleApply()}>\n              Create\n          </Button>\n          </Modal.Footer>\n        </Modal>\n      </>\n    );\n  }\n}\n\nclass TextEditorComponent extends React.Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.onChange = this.onChange.bind(this);\n    this.onResize = this.onResize.bind(this);\n    this.selected_src = null;\n    global_state.exec_after('remove_src', (cmd) => {\n      // console.log(cmd);\n      if (cmd.src_name == this.selected_src) {\n        this.edit_src(null);\n        this.rebuildGui();\n      }\n    });\n    global_state.on_reset(() => {\n      this.edit_src(null);\n      this.rebuildGui();\n    });\n\n  }\n\n  rebuildGui = () => {\n    this.datgui = new dat.GUI({ autoPlace: false });\n    this.src_list = [];\n    this.datgui_state = {\n      select_src: this.selected_src,\n      remove_src: () => { this.remove_src(); },\n    };\n    if (\"srcs\" in global_state.litegraph.config)\n      Object.keys(global_state.litegraph.config.srcs).forEach(e => this.src_list.push(e));\n    this.datgui.src_list = this.datgui.add(this.datgui_state, 'select_src', this.src_list)\n      .onChange((v) => this.edit_src(v));\n    this.datgui.add(this.datgui_state, 'remove_src');\n\n    var customContainer = document.getElementById('teditor_gui_container');\n    var child = customContainer.lastElementChild;\n    while (child) {\n      customContainer.removeChild(child);\n      child = customContainer.lastElementChild;\n    }\n    customContainer.appendChild(this.datgui.domElement);\n  }\n\n  componentDidMount() {\n    this.props.glContainer.on('resize', this.onResize);\n    this.edit_src(null);\n    this.rebuildGui();\n    // ace.require(\"ace/ext/language_tools\");\n\n  }\n\n  edit_src = (name) => {\n    if (name == null) {\n      this.selected_src = null;\n      this.refs.editor.editor.setValue(\"\");\n      return;\n    }\n    assert(name in global_state.litegraph.config.srcs);\n    this.selected_src = name;\n    this.refs.editor.editor.setValue(global_state.litegraph.config.srcs[name].code);\n    this.refs.editor.editor.setOptions({\n      // fontFamily: \"Consolas\",\n      // enableSnippets: true,\n      // enableBasicAutocompletion: true,\n      // enableLiveAutocompletion: true,\n      fontSize: \"8pt\"\n    });\n    this.refs.editor.editor.setAutoScrollEditorIntoView(true);\n    this.refs.editor.editor.getSession().setOptions({\n      tabSize: 2,\n      useSoftTabs: true,\n      navigateWithinSoftTabs: true\n\n    });\n  }\n\n  add_src = (name) => {\n    global_state.exec({ type: 'add_src', src_name: name });\n    this.edit_src(name);\n    this.rebuildGui();\n\n  }\n\n  remove_src = () => {\n    if (this.selected_src == null)\n      return;\n    global_state.exec({ type: 'remove_src', src_name: this.selected_src });\n\n  }\n\n  onChange(newValue) {\n    if (this.selected_src == null)\n      return;\n    global_state.set_src(this.selected_src, newValue);\n  }\n\n  onResize() {\n    this.refs.editor.editor.resize();\n  }\n\n  render() {\n\n    return (\n      <div className=\"ace_editor_container\">\n        <CreateSrc on_submit={(name) => this.add_src(name)} />\n        <div id=\"teditor_gui_container\">\n\n        </div>\n        <AceEditor\n          value={this.text}\n          ref=\"editor\"\n          mode=\"glsl\"\n          theme=\"tomorrow_night_eighties\"\n          onChange={this.onChange}\n          name=\"UNIQUE_ID_OF_DIV\"\n          editorProps={{\n            $blockScrolling: true\n          }}\n          enableBasicAutocompletion={true}\n          enableLiveAutocompletion={true}\n          autoScrollEditorIntoView={false}\n          wrapEnabled={false}\n          height=\"calc(100% - 100px)\"\n          width=\"calc(100%)\"\n        />\n      </div>\n    );\n  }\n}\n\nclass PropertiesNode extends React.Component {\n\n  constructor(props, context) {\n    super(props, context);\n    this.selected_node = null;\n    global_state.exec_on_select((selected_node) => {\n      this.selected_node = selected_node;\n      this.display_node(selected_node);\n      selected_node.subscribe(this);\n    },\n      (deselected_node) => {\n        if (this.selected_node == deselected_node) {\n          this.selected_node = null;\n          this.clear_gui();\n          deselected_node.unsubscribe(this);\n        }\n      });\n    global_state.exec_after('remove_src', (cmd) => {\n      this.clear_gui();\n      this.display_node(this.selected_node);\n    });\n    global_state.exec_after('add_src', (cmd) => {\n      this.clear_gui();\n      this.display_node(this.selected_node);\n    });\n    global_state.on_reset(() => {\n      this.clear_gui();\n    });\n    this.subscribers = new Set();\n  }\n\n  subscribe = (node) => { this.subscribers.add(node) }\n  unsubscribe = (node) => { this.subscribers.delete(node) }\n  notify = () => { this.subscribers.forEach(node => { if (node.set_dirty) node.set_dirty() }) }\n  set_dirty = () => { global_state.set_dirty(this); }\n\n  update = () => {\n    this.clear_gui();\n    this.display_node(this.selected_node);\n  }\n\n  clear_gui = () => {\n    var customContainer = document.getElementById('PropertiesNodeWrapper');\n    var child = customContainer.lastElementChild;\n    while (child) {\n      customContainer.removeChild(child);\n      child = customContainer.lastElementChild;\n    }\n  }\n\n  display_node = (node) => {\n    if (node == null)\n      return;\n    this.datgui = new dat.GUI({ autoPlace: false });\n    if (\"display\" in node) {\n      node.display(this);\n    }\n    var customContainer = document.getElementById('PropertiesNodeWrapper');\n    customContainer.appendChild(this.datgui.domElement);\n    // if (this.selected_node != null) {\n    //   if (this.selected_node.type == \"gfx/PipelineNode\") {\n    //     this.display_pipeline(node);\n    //   } else if (this.selected_node.type == \"gfx/PassNode\") {\n    //     this.display_pass(node);\n    //   }\n    // }\n  }\n\n  componentDidMount() {\n\n  }\n\n  render() {\n\n    return (\n      <div id='PropertiesNodeWrapper'>\n      </div>\n    );\n  }\n}\n\nclass GoldenLayoutWrapper extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n\n  }\n\n  componentDidMount() {\n    this.globals = {};\n    // Build basic golden-layout config\n    const config = {\n      content: [{\n        type: 'row',\n        content: [\n          {\n            type: 'column',\n            content: [\n              {\n                type: 'react-component',\n                isClosable: false,\n                component: 'TextEditor',\n                title: 'Text Editor',\n\n                props: { globals: () => this.globals }\n\n\n              },\n              {\n                type: 'stack',\n                width: 84,\n                height: 40,\n                content: [\n                  {\n                    type: 'react-component',\n                    isClosable: false,\n                    component: 'PropertiesNode',\n                    title: 'Properties',\n                    props: { globals: () => this.globals }\n\n                  },\n                  {\n\n                    type: 'react-component',\n                    isClosable: false,\n                    component: 'GLW',\n                    title: 'Back Buffer',\n                    props: { globals: () => this.globals }\n\n                  },\n                ]\n              }\n            ]\n          },\n          {\n            type: 'react-component',\n            isClosable: false,\n            component: 'Graphs',\n            title: 'Graphs',\n            props: { globals: () => this.globals },\n            width: 145\n\n          },\n\n\n        ]\n      }]\n    };\n\n    var layout = new GoldenLayout(config, this.layout);\n    this.layout = layout;\n    layout.registerComponent('Graphs', GraphNodeComponent\n    );\n    layout.registerComponent('GLW', GLComponent\n    );\n    layout.registerComponent('TextEditor',\n      TextEditorComponent\n    );\n    layout.registerComponent('PropertiesNode',\n      PropertiesNode\n    );\n\n    layout.init();\n    window.React = React;\n    window.ReactDOM = ReactDOM;\n    window.addEventListener('resize', () => {\n      layout.updateSize();\n    });\n\n  }\n\n  render() {\n\n    return (\n      <div className='goldenLayout'\n        ref={input => this.layout = input} >\n      </div>\n    );\n  }\n}\n\n\nexport default GoldenLayoutWrapper;","import GoldenLayoutWrapper from './app';\nimport React, { useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <GoldenLayoutWrapper />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}