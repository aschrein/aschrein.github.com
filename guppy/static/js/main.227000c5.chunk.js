(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{190:function(t,e,n){},200:function(t,e,n){"use strict";n.r(e);var a=n(19),i=n(20),s=n(22),r=n(21),o=n(23),l=n(5),c=n(93),h=n.n(c),u=n(2),p=n.n(u),g=n(35),f=n.n(g),m=(n(190),n(94)),d=n.n(m),y=(n(198),n(199),n(54));var x=n.e(3).then(n.bind(null,202)),b=function(t){function e(t,n){var i;return Object(a.a)(this,e),(i=Object(s.a)(this,Object(r.a)(e).call(this,t,n))).onChange=i.onChange.bind(Object(l.a)(Object(l.a)(i))),i.Execute=i.Execute.bind(Object(l.a)(Object(l.a)(i))),i.PauseResume=i.PauseResume.bind(Object(l.a)(Object(l.a)(i))),i.onResize=i.onResize.bind(Object(l.a)(Object(l.a)(i))),i}return Object(o.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){this.props.glContainer.on("resize",this.onResize)}},{key:"onChange",value:function(t){this.text=t}},{key:"onResize",value:function(){}},{key:"PauseResume",value:function(){this.props.globals().wasm&&(this.props.globals().run=!this.props.globals().run)}},{key:"Execute",value:function(){var t=this.props.globals();if(this.props.globals().wasm){this.props.globals().resetGPU();for(var e=this.props.globals().dispatchConfig,n=0;n<t.r_images.length;n++)t.wasm.guppy_put_image(t.r_images[n]);t.wasm.guppy_init_framebuffer(256,256),this.props.globals().wasm.guppy_dispatch(this.text,e.group_size,e.groups_count),this.props.globals().run=!0}else console.log("[WARNING] wasm in null")}},{key:"render",value:function(){var t="jmp ENTRY\n\n; Distance function\n; In   : r32.xyz\n; Uses : r33.xyzw, r32.xyzw\n; Out  : r32.w\nDIST_FN:\n\n; Sphere_0\nsub.f32 r33.xyz, r32.xyz, f3(0.0 0.0 5.0)\nlen r33.w, r33.xyz\nsub.f32 r33.w, r33.w, f(5.0)\n\n; Sphere_1\nsub.f32 r34.xyz, r32.xyz, f3(0.0 0.0 -5.0)\nlen r34.w, r34.xyz\nsub.f32 r34.w, r34.w, f(5.0)\n\n; Smooth min\nsub.f32 r34.x, r33.w, r34.w\nmul.f32 r34.x, r34.x, f(0.2)\nmad.f32 r34.x, r34.x, f(0.5), f(0.5)\nclamp r34.x, r34.x\n; mul.f32 r34.x, r34.x, r34.x\nlerp r32.w, r34.w, r33.w, r34.x\n\nsub.f32 r34.w, r34.x, f(1.0)\nmul.f32 r34.w, r34.w, f(5.)\nmad.f32 r32.w, r34.x, r34.w, r32.w\n\n\npop_mask\n\nENTRY:\n; Figure out where we are in the screen space\nmov r0.xy, thread_id\nand r0.x, r0.x, u(255)\ndiv.u32 r0.y, r0.y, u(256)\nmov r0.zw, r0.xy\n\n; put the red color as an indiacation of ongoing work\nst u0.xyzw, r0.zw, f4(1.0 0.0 0.0 1.0)\n\n; Normalize screen coordiantes\nutof r0.xy, r0.xy\n; add 0.5 to fit the center of the texel\nadd.f32 r0.xy, r0.xy, f2(0.5 0.5)\n; normalize coordinates\ndiv.f32 r0.xy, r0.xy, f2(256.0 256.0)\n; tx * 2.0 - 1.0\nmul.f32 r0.xy, r0.xy, f2(2.0 -2.0)\nsub.f32 r0.xy, r0.xy, f2(1.0 -1.0)\n\n; Setup a simple pinhole camera\n; Camera position\nmov r1.xyz, f3(10.0 10.0 0.0)\n; Camera look vector\nmov r2.xyz, f3(-0.7071 -0.7071 0.0)\n; Camera right vector\nmov r3.xyz, f3(-0.7071 0.7071 0.0)\n; Camera up vector\nmov r4.xyz, f3(0.0 0.0 1.0)\n; Setup ray direction\nmov r5.xyz, r2.xyz\nmad.f32 r5.xyz, r0.xxx, r3.xyz, r5.xyz\nmad.f32 r5.xyz, r0.yyy, r4.xyz, r5.xyz\nnorm r5.xyz, r5.xyz\n\n; Now solve the scene\n\nmov r15.xyz, r5.xyz\nmul.f32 r15.xyz, r15.xyz, f3(0.01 0.01 0.01)\nadd.f32 r15.xyz, r15.xyz, r1.xyz\n\n;jmp LOOP_END\n\npush_mask LOOP_END\nLOOP_BEGIN:\n; if (r16.y < 16)\nlt.u32 r16.x, r16.y, u(16)\nmask_nz r16.x\n; Loop body begin\nmov r32.xyz, r15.xyz\npush_mask RET\njmp DIST_FN\nRET:\ngt.f32 r14.x, r32.w, f(0.001)\nsub.u32 r13.x, u(1), r14.x\nutof r13.x, r13.x\nmask_nz r14.x\nmad.f32 r15.xyz, r5.xyz, r32.www, r15.xyz\n\n; Loop body end\n; Increment iteration counter\nadd.u32 r16.y, r16.y, u(1)\n\njmp LOOP_BEGIN\n\nLOOP_END:\n\nmov r10.w, f(1.0)\nabs.f32 r10.xyz, r5.www\n\npush_mask L1\nmask_nz r13.x\nnorm r15.xyz, r15.xyz\nsample r10.xyzw, t0.xyzw, s0, r15.xy\npop_mask\nL1:\n; mov r5.xyz, r32.www\n; mov r16.y, u(1)\n; utof r14.x, r16.y\n; div.f32 r14.x, r14.x, f(4.0)\n\nst u0.xyzw, r0.zw, r10.xyzw\nret";return this.text=t,p.a.createElement("div",{className:"ace_editor_container"},p.a.createElement("button",{style:{margin:10},onClick:this.Execute},"Execute"),p.a.createElement("button",{style:{margin:10},onClick:this.PauseResume},"Pause/Resume"),p.a.createElement(d.a,{value:t,ref:"editor",mode:"assembly_x86",theme:"tomorrow_night_eighties",onChange:this.onChange,name:"UNIQUE_ID_OF_DIV",editorProps:{$blockScrolling:!0},autoScrollEditorIntoView:!1,wrapEnabled:!1,height:"700px",width:"512px"}))}}]),e}(p.a.Component),_=function(t){function e(t,n){var i;return Object(a.a)(this,e),(i=Object(s.a)(this,Object(r.a)(e).call(this,t,n))).onChange=i.onChange.bind(Object(l.a)(Object(l.a)(i))),i.onChangeDispatch=i.onChangeDispatch.bind(Object(l.a)(Object(l.a)(i))),i}return Object(o.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){}},{key:"onChange",value:function(t,e,n,a){console.log("onchange",t,e),this.props.globals().gpuConfig[t]=e}},{key:"onChangeDispatch",value:function(t,e,n,a){console.log("onChangeDispatch",t,e),this.props.globals().dispatchConfig[t]=e}},{key:"render",value:function(){return p.a.createElement("div",null,p.a.createElement("p",{style:{color:"white",margin:10}},"GPU Config"),p.a.createElement(y.JSONEditor,{data:this.props.globals().gpuConfig,onChange:this.onChange}),p.a.createElement("p",{style:{color:"white",margin:10}},"Dispatch config"),p.a.createElement(y.JSONEditor,{data:this.props.globals().dispatchConfig,onChange:this.onChangeDispatch}))}}]),e}(p.a.Component),v=function(t){function e(t,n){var i;return Object(a.a)(this,e),(i=Object(s.a)(this,Object(r.a)(e).call(this,t,n))).updateMemory=i.updateMemory.bind(Object(l.a)(Object(l.a)(i))),i}return Object(o.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.props.globals().updateMemory=this.updateMemory,this.ctx=this.refs.canvas.getContext("2d");var e=this.refs.img;e.onload=function(){t.refs.canvas.width=e.width,t.refs.canvas.height=e.height,t.ctx.drawImage(e,0,0);var n=t.ctx.getImageData(0,0,1,1).data;("000000"+function(t,e,n){if(t>255||e>255||n>255)throw"Invalid color component";return(t<<16|e<<8|n).toString(16)}(n[0],n[1],n[2])).slice(-6);var a=t.refs.canvas.toDataURL("image/png");t.props.globals().r_images.push(a)}}},{key:"updateMemory",value:function(){var t=this.refs.canvas.getContext("2d"),e=new Image,n=this.refs.canvas,a=this.props.globals();e.onload=function(){n.width=e.width,n.height=e.height,t.drawImage(e,0,0)};var i="data:image/png;base64,"+a.wasm.guppy_get_image(0,!1);e.src=i}},{key:"render",value:function(){return p.a.createElement("div",null,p.a.createElement("canvas",{ref:"canvas"}),p.a.createElement("img",{style:{display:"none"},ref:"img",src:"img/lenna.png"}))}}]),e}(p.a.Component),w=function(t){function e(t,n){var i;return Object(a.a)(this,e),(i=Object(s.a)(this,Object(r.a)(e).call(this,t,n))).neededWidth=4096,i.neededHeight=1024,i.updateCanvas=i.updateCanvas.bind(Object(l.a)(Object(l.a)(i))),i.onResize=i.onResize.bind(Object(l.a)(Object(l.a)(i))),i.scheduleDraw=i.scheduleDraw.bind(Object(l.a)(Object(l.a)(i))),i}return Object(o.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){this.draw=!0,this.ctx=this.refs.canvas.getContext("2d"),this.canvas=this.refs.canvas,this.lastClock=0,this.props.glContainer.on("resize",this.onResize),this.globals=this.props.globals,this.globals().updateCanvas=this.updateCanvas,this.updateCanvas()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateCanvas)}},{key:"onResize",value:function(){this.updateCanvas()}},{key:"scheduleDraw",value:function(){this.draw=!0,this.updateCanvas()}},{key:"updateCanvas",value:function(){if(this.draw){this.globals().active_mask_history&&(this.neededWidth=this.globals().active_mask_history.length+512,this.neededHeight=(this.globals().gpuConfig.wave_size+1)*this.globals().gpuConfig.CU_count*this.globals().gpuConfig.waves_per_cu+1536),this.draw=!1,this.canvas.width=this.neededWidth,this.canvas.height=this.neededHeight,this.ctx.fillStyle="#222222",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var t=0,e=0;(y=this.ctx).font="14px Monaco, monospace";var n="(white, black, grey, blue, red) = (active, inactive, disabled, stalled, not enough resources)";if(y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,t,e),e+=16,this.globals().active_mask_history){var a=this.globals().active_mask_history;if(a.length>0){(y=this.ctx).font="14px Monaco, monospace";n="exec mask history";y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,t,e);for(var i=e+16,s=0;s<a.length;s++){this.neededHeight=Math.max(this.neededHeight,e),e=i;for(var r=0;r<a[0].length;r++)r%32==0&&(e+=4),1==a[s][r]?this.ctx.fillStyle="white":0==a[s][r]?this.ctx.fillStyle="black":2==a[s][r]?this.ctx.fillStyle="grey":3==a[s][r]?this.ctx.fillStyle="blue":4==a[s][r]&&(this.ctx.fillStyle="red"),this.ctx.fillRect(t,e,1,1),e+=1;t+=1}this.neededWidth=Math.max(this.neededWidth,t)}}if(this.globals().alu_active_history){var o=this.globals().alu_active_history;if(o.length>0){(y=this.ctx).font="14px Monaco, monospace";n="ALU Active history";y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,0,e+16);i=e+32;t=0;for(s=0;s<o.length;s++){this.neededHeight=Math.max(this.neededHeight,e),e=i;for(r=100;r>=0;r--)r<=o[s]?this.ctx.fillStyle="white":this.ctx.fillStyle="black",this.ctx.fillRect(t,e,1,1),e+=1;t+=1}this.neededWidth=Math.max(this.neededWidth,t)}}(y=this.ctx).font="14px Monaco, monospace";n="(r, g, b) = (hits, misses, evictions)";if(y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,0,e+16),e+=16,this.globals().l2_metric_history){var l=this.globals().l2_metric_history;if(l.length>0){(y=this.ctx).font="14px Monaco, monospace";n="L2$";y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,0,e+16);i=e+32;t=0;var c=0;for(s=0;s<l.length;s++)c=Math.max(c,l[s][0],l[s][1],l[s][2]);for(s=0;s<l.length;s++){this.neededHeight=Math.max(this.neededHeight,e),e=i;var h=100*l[s][0]/c,u=100*l[s][1]/c,p=100*l[s][2]/c;for(r=100;r>=0;r--){var g=0,f=0,m=0;r<=h&&(g=255),r<=u&&(f=255),r<=p&&(m=255),this.ctx.fillStyle="rgb("+Math.floor(g)+", "+Math.floor(f)+", "+Math.floor(m)+")",this.ctx.fillRect(t,e,1,1),e+=1}t+=1}this.neededWidth=Math.max(this.neededWidth,t)}}if(this.globals().samplers_metric_history){var d=this.globals().samplers_metric_history;if(d.length>0){var y;(y=this.ctx).font="14px Monaco, monospace";n="Samplers $";y.textAlign="start",y.textBaseline="top",y.fillStyle="#ffffff",y.fillText(n,0,e+16);i=e+32;t=0;for(c=0,s=0;s<d.length;s++)c=Math.max(c,d[s][0],d[s][1],d[s][2]);for(s=0;s<d.length;s++){this.neededHeight=Math.max(this.neededHeight,e),e=i;var x=100*d[s][0]/c,b=100*d[s][1]/c,_=100*d[s][2]/c;for(r=100;r>=0;r--){g=0,f=0,m=0;r<=x&&(g=255),r<=b&&(f=255),r<=_&&(m=255),this.ctx.fillStyle="rgb("+Math.floor(g)+", "+Math.floor(f)+", "+Math.floor(m)+")",this.ctx.fillRect(t,e,1,1),e+=1}t+=1}this.neededWidth=Math.max(this.neededWidth,t)}}}}},{key:"render",value:function(){return p.a.createElement("div",null,p.a.createElement("button",{style:{margin:10},onClick:this.scheduleDraw},"Draw"),p.a.createElement("canvas",{ref:"canvas"})," ")}}]),e}(p.a.Component),z=function(t){function e(){return Object(a.a)(this,e),Object(s.a)(this,Object(r.a)(e).apply(this,arguments))}return Object(o.a)(e,t),Object(i.a)(e,[{key:"timer",value:function(){if(this.globals.wasm&&this.globals.run)for(var t=0;t<this.globals.dispatchConfig.cycles_per_iter;t++)this.globals.wasm.guppy_clock()?(this.globals.active_mask_history.push(this.globals.wasm.guppy_get_active_mask()),this.globals.alu_active_history.push(this.globals.wasm.guppy_get_gpu_metric("ALU active")),this.globals.samplers_metric_history.push([this.globals.wasm.guppy_get_gpu_metric("Samplers cache hit"),this.globals.wasm.guppy_get_gpu_metric("Samplers cache miss"),this.globals.wasm.guppy_get_gpu_metric("Samplers cache evict")]),this.globals.l2_metric_history.push([this.globals.wasm.guppy_get_gpu_metric("L2 hit"),this.globals.wasm.guppy_get_gpu_metric("L2 miss"),this.globals.wasm.guppy_get_gpu_metric("L2 evict")]),this.globals.updateMemory()):this.globals.run=!1}},{key:"componentDidMount",value:function(){var t=this;this.globals={},this.globals.dispatchConfig={group_size:32,groups_count:2048,cycles_per_iter:1},this.globals.gpuConfig={DRAM_latency:32,DRAM_bandwidth:768,L1_size:1024,L1_latency:4,L2_size:1024,L2_latency:16,sampler_cache_size:1024,sampler_latency:16,VGPRF_per_pe:128,wave_size:32,CU_count:16,ALU_per_cu:1,waves_per_cu:4,fd_per_cu:1,ALU_pipe_len:4},this.globals.wasm=null,this.globals.r_images=[],this.globals.active_mask_history=null,this.globals.samplers_metric_history=null,this.globals.l2_metric_history=null,this.globals.alu_active_history=null,this.intervalId=setInterval(this.timer.bind(this),1);var e={content:[{type:"row",content:[{type:"column",content:[{type:"react-component",component:"TextEditor",title:"TextEditor",props:{globals:function(){return t.globals}}},{type:"row",content:[{type:"react-component",component:"Parameters",title:"Parameters",props:{globals:function(){return t.globals}}},{type:"react-component",component:"Memory",title:"Memory",props:{globals:function(){return t.globals}}}]}]},{type:"react-component",component:"Canvas",title:"Canvas",props:{globals:function(){return t.globals}}}]}]},n=new h.a(e,this.layout);this.layout=n;var a=this.globals;this.globals.resetGPU=function(){a.run=!1,a.wasm.guppy_create_gpu_state(JSON.stringify(a.gpuConfig)),a.active_mask_history=[],a.alu_active_history=[],a.samplers_metric_history=[],a.l2_metric_history=[]},x.then(function(e){n.updateSize(),t.globals.wasm=e,t.globals.resetGPU()}),n.registerComponent("Canvas",w),n.registerComponent("TextEditor",b),n.registerComponent("Parameters",_),n.registerComponent("Memory",v),n.init(),window.React=p.a,window.ReactDOM=f.a,window.addEventListener("resize",function(){n.updateSize()})}},{key:"render",value:function(){var t=this;return p.a.createElement("div",{className:"goldenLayout",ref:function(e){return t.layout=e}})}}]),e}(p.a.Component);n(95);f.a.render(p.a.createElement(z,null),document.getElementById("root"))},96:function(t,e,n){t.exports=n(200)}},[[96,1,2]]]);
//# sourceMappingURL=main.227000c5.chunk.js.map